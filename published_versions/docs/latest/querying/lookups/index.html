<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-querying/lookups" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Lookups | Apache® Druid</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://druid.apache.org/img/druid_nav.png"><meta data-rh="true" name="twitter:image" content="https://druid.apache.org/img/druid_nav.png"><meta data-rh="true" property="og:url" content="https://druid.apache.org/docs/latest/querying/lookups"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Lookups | Apache® Druid"><meta data-rh="true" name="description" content="&lt;!--"><meta data-rh="true" property="og:description" content="&lt;!--"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://druid.apache.org/docs/latest/querying/lookups"><link data-rh="true" rel="alternate" href="https://druid.apache.org/docs/latest/querying/lookups" hreflang="en"><link data-rh="true" rel="alternate" href="https://druid.apache.org/docs/latest/querying/lookups" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-131010415-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-131010415-1",{})</script>





<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js"></script><link rel="stylesheet" href="/assets/css/styles.60a7f877.css">
<link rel="preload" href="/assets/js/runtime~main.0af847c9.js" as="script">
<link rel="preload" href="/assets/js/main.d0f3a16d.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/druid_nav.png" alt="Apache® Druid" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/druid_nav.png" alt="Apache® Druid" class="themedImage_ToTc themedImage--dark_i4oU"></div></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/technology">Technology</a><a class="navbar__item navbar__link" href="/use-cases">Use Cases</a><a class="navbar__item navbar__link" href="/druid-powered">Powered By</a><a class="navbar__item navbar__link" href="/docs/latest/design/">Docs</a><a class="navbar__item navbar__link" href="/community/">Community</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Apache®</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Foundation<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://apachecon.com/?ref=druid.apache.org" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a class="navbar__item navbar__link" href="/downloads/">Download</a><div class="searchBox_ZlJk"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/latest/design/">Introduction to Apache Druid</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/latest/tutorials/">Getting started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting started&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/latest/design/architecture">Design</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/latest/ingestion/">Ingestion</a><button aria-label="Toggle the collapsible sidebar category &#x27;Ingestion&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/latest/data-management/">Data management</a><button aria-label="Toggle the collapsible sidebar category &#x27;Data management&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/latest/querying/sql">Querying</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/latest/querying/sql">Druid SQL</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/querying/">Native queries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/querying/query-processing">Query processing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/querying/query-execution">Query execution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/querying/troubleshooting">Troubleshooting</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/latest/querying/datasource">Concepts</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/querying/datasource">Datasources</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/querying/joins">Joins</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible menu__list-item-collapsible--active"><a class="menu__link menu__link--sublist menu__link--active" aria-current="page" aria-expanded="true" tabindex="0" href="/docs/latest/querying/lookups">Lookups</a><button aria-label="Toggle the collapsible sidebar category &#x27;Lookups&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/querying/lookups-cached-global">Globally Cached Lookups</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/querying/kafka-extraction-namespace">Apache Kafka Lookups</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/querying/multi-value-dimensions">Multi-value dimensions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/querying/arrays">Arrays</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/querying/nested-columns">Nested columns</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/querying/multitenancy">Multitenancy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/querying/caching">Query caching</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/querying/using-caching">Using query caching</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/latest/querying/query-context">Query context</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/latest/querying/timeseriesquery">Native query types</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/latest/querying/filters">Native query components</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/latest/api-reference/">API reference</a><button aria-label="Toggle the collapsible sidebar category &#x27;API reference&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/latest/configuration/">Configuration</a><button aria-label="Toggle the collapsible sidebar category &#x27;Configuration&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/latest/api-reference/automatic-compaction-api">Operations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/latest/development/overview">Development</a><button aria-label="Toggle the collapsible sidebar category &#x27;Development&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/latest/release-info/release-notes">Release info</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/latest/misc/papers-and-talks">Papers</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Querying</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Concepts</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Lookups</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Lookups</h1></header><p>Lookups are a concept in Apache Druid where dimension values are (optionally) replaced with new values, allowing join-like
functionality. Applying lookups in Druid is similar to joining a dimension table in a data warehouse. See
<a href="/docs/latest/querying/dimensionspecs">dimension specs</a> for more information. For the purpose of these documents, a &quot;key&quot;
refers to a dimension value to match, and a &quot;value&quot; refers to its replacement. So if you wanted to map
<code>appid-12345</code> to <code>Super Mega Awesome App</code> then the key would be <code>appid-12345</code> and the value would be
<code>Super Mega Awesome App</code>.</p><p>It is worth noting that lookups support not just use cases where keys map one-to-one to unique values, such as country
code and country name, but also support use cases where multiple IDs map to the same value, e.g. multiple app-ids
mapping to a single account manager. When lookups are one-to-one, Druid is able to apply additional
<a href="#query-rewrites">query rewrites</a>; see below for more details.</p><p>Lookups do not have history. They always use the current data. This means that if the chief account manager for a
particular app-id changes, and you issue a query with a lookup to store the app-id to account manager relationship,
it will return the current account manager for that app-id REGARDLESS of the time range over which you query.</p><p>If you require data time range sensitive lookups, such a use case is not currently supported dynamically at query time,
and such data belongs in the raw denormalized data for use in Druid.</p><p>Lookups are generally preloaded in-memory on all servers. But very small lookups (on the order of a few dozen to a few
hundred entries) can also be passed inline in native queries time using the &quot;map&quot; lookup type. Refer to the
<a href="/docs/latest/querying/dimensionspecs">dimension specs</a> documentation for details.</p><p>Other lookup types are available as extensions, including:</p><ul><li>Globally cached lookups from local files, remote URIs, or JDBC through <a href="/docs/latest/querying/lookups-cached-global">lookups-cached-global</a>.</li><li>Globally cached lookups from a Kafka topic through <a href="/docs/latest/querying/kafka-extraction-namespace">kafka-extraction-namespace</a>.</li></ul><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p><a href="/docs/latest/querying/multi-value-dimensions">Multi-value dimensions</a> (MVDs) are not supported as keys in lookups. For example, to map the MVD <code>[&quot;A&quot;, &quot;B&quot;, &quot;C&quot;]</code> to the value <code>x</code> in your lookup, flatten the MVD and map each element of the MVD to the value. Your lookup will have separate key-value pairs for each element of the MVD: <code>&quot;A&quot;: &quot;x&quot;</code>, <code>&quot;B&quot;: &quot;x&quot;</code>, and <code>&quot;C&quot;: &quot;x&quot;</code>.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="query-syntax">Query Syntax<a href="#query-syntax" class="hash-link" aria-label="Direct link to Query Syntax" title="Direct link to Query Syntax">​</a></h2><p>In <a href="/docs/latest/querying/sql">Druid SQL</a>, lookups can be queried using the <a href="/docs/latest/querying/sql-scalar#string-functions"><code>LOOKUP</code> function</a>, for example:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  LOOKUP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">store</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;store_to_country&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> country</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">SUM</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">revenue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> sales</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">BY</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>LOOKUP</code> function also accepts a third argument called <code>replaceMissingValueWith</code> as a constant string. If the lookup
does not contain a value for the provided key, then the <code>LOOKUP</code> function returns this <code>replaceMissingValueWith</code> value
rather than <code>NULL</code>, just like <code>COALESCE</code>. For example, <code>LOOKUP(store, &#x27;store_to_country&#x27;, &#x27;NA&#x27;)</code> is equivalent to
<code>COALESCE(LOOKUP(store, &#x27;store_to_country&#x27;), &#x27;NA&#x27;)</code>.</p><p>Lookups can be queried using the <a href="/docs/latest/querying/datasource#join">JOIN operator</a>:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  store_to_country</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">v </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> country</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">SUM</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sales</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">revenue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> country_revenue</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  sales</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">INNER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">JOIN</span><span class="token plain"> lookup</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">store_to_country </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> sales</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">store </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> store_to_country</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">k</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">BY</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>The <code>LOOKUP</code> function has automatic <a href="#query-rewrites">query rewrites</a> available that the <code>JOIN</code> approach does not,
including <a href="#reverse-lookup">reverse lookups</a> and <a href="#pull-up">pulling up through <code>GROUP BY</code></a>. If these rewrites are
important for you, consider using the <code>LOOKUP</code> function instead of <code>JOIN</code>.</p></div></div><p>In native queries, lookups can be queried with <a href="/docs/latest/querying/dimensionspecs">dimension specs or extraction functions</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="query-rewrites">Query Rewrites<a href="#query-rewrites" class="hash-link" aria-label="Direct link to Query Rewrites" title="Direct link to Query Rewrites">​</a></h2><p>Druid can perform two automatic query rewrites when using the <code>LOOKUP</code> function: <a href="#reverse-lookup">reverse lookups</a> and
<a href="#pull-up">pulling up through <code>GROUP BY</code></a>. These rewrites and their requirements are described in the following
sections.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="reverse-lookup">Reverse lookup<a href="#reverse-lookup" class="hash-link" aria-label="Direct link to Reverse lookup" title="Direct link to Reverse lookup">​</a></h3><p>When <code>LOOKUP</code> function calls appear in the <code>WHERE</code> clause of a query, Druid reverses them <a href="#table">when possible</a>.
For example, if the lookup table <code>sku_to_name</code> contains the mapping <code>&#x27;WB00013&#x27; =&gt; &#x27;WhizBang Sprocket&#x27;</code>, then Druid
automatically rewrites this query:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  LOOKUP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sku</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;sku_to_name&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">SUM</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">revenue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> sales</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> LOOKUP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sku</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;sku_to_name&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;WhizBang Sprocket&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">BY</span><span class="token plain"> LOOKUP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sku</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;sku_to_name&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Into this:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  LOOKUP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sku</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;sku_to_name&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">SUM</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">revenue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> sales</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> sku </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;WB00013&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">BY</span><span class="token plain"> LOOKUP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sku</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;sku_to_name&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The difference is that in the latter case, data servers do not need to apply the <code>LOOKUP</code> function while filtering, and
can make more efficient use of indexes for <code>sku</code>.</p><a name="table">The following table</a> contains examples of when it is possible to reverse calls to `LOOKUP` while in Druid&#x27;s default null handling mode. The list of examples is illustrative, albeit not exhaustive.<table><thead><tr><th>SQL</th><th>Reversible?</th></tr></thead><tbody><tr><td><code>LOOKUP(sku, &#x27;sku_to_name&#x27;) = &#x27;WhizBang Sprocket&#x27;</code></td><td>Yes</td></tr><tr><td><code>LOOKUP(sku, &#x27;sku_to_name&#x27;) IS NOT DISTINCT FROM &#x27;WhizBang Sprocket&#x27;</code></td><td>Yes, for non-null literals</td></tr><tr><td><code>LOOKUP(sku, &#x27;sku_to_name&#x27;) &lt;&gt; &#x27;WhizBang Sprocket&#x27;</code></td><td>No, unless <code>sku_to_name</code> is <a href="#injective-lookups">injective</a></td></tr><tr><td><code>LOOKUP(sku, &#x27;sku_to_name&#x27;) IS DISTINCT FROM &#x27;WhizBang Sprocket&#x27;</code></td><td>Yes, for non-null literals</td></tr><tr><td><code>LOOKUP(sku, &#x27;sku_to_name&#x27;) = &#x27;WhizBang Sprocket&#x27; IS NOT TRUE</code></td><td>Yes</td></tr><tr><td><code>LOOKUP(sku, &#x27;sku_to_name&#x27;) IN (&#x27;WhizBang Sprocket&#x27;, &#x27;WhizBang Chain&#x27;)</code></td><td>Yes</td></tr><tr><td><code>LOOKUP(sku, &#x27;sku_to_name&#x27;) NOT IN (&#x27;WhizBang Sprocket&#x27;, &#x27;WhizBang Chain&#x27;)</code></td><td>No, unless <code>sku_to_name</code> is <a href="#injective-lookups">injective</a></td></tr><tr><td><code>LOOKUP(sku, &#x27;sku_to_name&#x27;) IN (&#x27;WhizBang Sprocket&#x27;, &#x27;WhizBang Chain&#x27;) IS NOT TRUE</code></td><td>Yes</td></tr><tr><td><code>LOOKUP(sku, &#x27;sku_to_name&#x27;) IS NULL</code></td><td>No</td></tr><tr><td><code>LOOKUP(sku, &#x27;sku_to_name&#x27;) IS NOT NULL</code></td><td>No</td></tr><tr><td><code>LOOKUP(UPPER(sku), &#x27;sku_to_name&#x27;) = &#x27;WhizBang Sprocket&#x27;</code></td><td>Yes, to <code>UPPER(sku) = [key for &#x27;WhizBang Sprocket&#x27;]</code> (the <code>UPPER</code> function remains)</td></tr><tr><td><code>COALESCE(LOOKUP(sku, &#x27;sku_to_name&#x27;), &#x27;N/A&#x27;) = &#x27;WhizBang Sprocket&#x27;</code></td><td>Yes, but see next item for <code>= &#x27;N/A&#x27;</code></td></tr><tr><td><code>COALESCE(LOOKUP(sku, &#x27;sku_to_name&#x27;), &#x27;N/A&#x27;) = &#x27;N/A&#x27;</code></td><td>No, unless <code>sku_to_name</code> is <a href="#injective-lookups">injective</a>, which allows Druid to ignore the <code>COALESCE</code></td></tr><tr><td><code>COALESCE(LOOKUP(sku, &#x27;sku_to_name&#x27;), &#x27;N/A&#x27;) = &#x27;WhizBang Sprocket&#x27; IS NOT TRUE</code></td><td>Yes</td></tr><tr><td><code>COALESCE(LOOKUP(sku, &#x27;sku_to_name&#x27;), &#x27;N/A&#x27;) &lt;&gt; &#x27;WhizBang Sprocket&#x27;</code></td><td>Yes, but see next item for <code>&lt;&gt; &#x27;N/A&#x27;</code></td></tr><tr><td><code>COALESCE(LOOKUP(sku, &#x27;sku_to_name&#x27;), &#x27;N/A&#x27;) &lt;&gt; &#x27;N/A&#x27;</code></td><td>No, unless <code>sku_to_name</code> is <a href="#injective-lookups">injective</a>, which allows Druid to ignore the <code>COALESCE</code></td></tr><tr><td><code>COALESCE(LOOKUP(sku, &#x27;sku_to_name&#x27;), sku) = &#x27;WhizBang Sprocket&#x27;</code></td><td>No, <code>COALESCE</code> is only reversible when the second argument is a constant</td></tr><tr><td><code>LOWER(LOOKUP(sku, &#x27;sku_to_name&#x27;)) = &#x27;whizbang sprocket&#x27;</code></td><td>No, functions other than <code>COALESCE</code> are not reversible</td></tr><tr><td><code>MV_CONTAINS(LOOKUP(sku, &#x27;sku_to_name&#x27;), &#x27;WhizBang Sprocket&#x27;)</code></td><td>Yes</td></tr><tr><td><code>NOT MV_CONTAINS(LOOKUP(sku, &#x27;sku_to_name&#x27;), &#x27;WhizBang Sprocket&#x27;)</code></td><td>No, unless <code>sku_to_name</code> is <a href="#injective-lookups">injective</a></td></tr><tr><td><code>MV_OVERLAP(LOOKUP(sku, &#x27;sku_to_name&#x27;), ARRAY[&#x27;WhizBang Sprocket&#x27;])</code></td><td>Yes</td></tr><tr><td><code>NOT MV_OVERLAP(LOOKUP(sku, &#x27;sku_to_name&#x27;), ARRAY[&#x27;WhizBang Sprocket&#x27;])</code></td><td>No, unless <code>sku_to_name</code> is <a href="#injective-lookups">injective</a></td></tr></tbody></table><p>You can see the difference in the native query that is generated during SQL planning, which you
can retrieve with <a href="/docs/latest/querying/sql#explain-plan"><code>EXPLAIN PLAN FOR</code></a>. When a lookup is reversed in this way, the <code>lookup</code>
function disappears and is replaced by a simpler filter, typically of type <code>equals</code> or <code>in</code>.</p><p>Lookups are not reversed if the number of matching keys exceeds the <a href="/docs/latest/querying/sql-query-context"><code>sqlReverseLookupThreshold</code></a>
or <a href="/docs/latest/querying/sql-query-context"><code>inSubQueryThreshold</code></a> for the query.</p><p>This rewrite adds some planning time that may become noticeable for larger lookups, especially if many keys map to the
same value. You can see the impact on planning time in the <code>sqlQuery/planningTimeMs</code> metric. You can also measure the
time taken by <code>EXPLAIN PLAN FOR</code>, which plans the query but does not execute it.</p><p>This rewrite can be disabled by setting <a href="/docs/latest/querying/sql-query-context"><code>sqlReverseLookup: false</code></a> in your query context.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pull-up">Pull up<a href="#pull-up" class="hash-link" aria-label="Direct link to Pull up" title="Direct link to Pull up">​</a></h3><p>Lookups marked as <a href="#injective-lookups"><em>injective</em></a> can be pulled up through a <code>GROUP BY</code>. For example, if the lookup
<code>sku_to_name</code> is injective, Druid automatically rewrites this query:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  LOOKUP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sku</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;sku_to_name&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">SUM</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">revenue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> sales</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">BY</span><span class="token plain"> LOOKUP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sku</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;sku_to_name&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Into this:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  LOOKUP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sku</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;sku_to_name&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">SUM</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">revenue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> sales</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">GROUP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">BY</span><span class="token plain"> sku</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The difference is that the <code>LOOKUP</code> function is not applied until after the <code>GROUP BY</code> is finished, which speeds up
the <code>GROUP BY</code>.</p><p>You can see the difference in the native query that is generated during SQL planning, which you
can retrieve with <a href="/docs/latest/querying/sql#explain-plan"><code>EXPLAIN PLAN FOR</code></a>. When a lookup is pulled up in this way, the <code>lookup</code>
function call typically moves from the <code>virtualColumns</code> or <code>dimensions</code> section of a native query into the
<code>postAggregations</code>.</p><p>This rewrite can be disabled by setting <a href="/docs/latest/querying/sql-query-context"><code>sqlPullUpLookup: false</code></a> in your query context.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="injective-lookups">Injective lookups<a href="#injective-lookups" class="hash-link" aria-label="Direct link to Injective lookups" title="Direct link to Injective lookups">​</a></h3><p>Injective lookups are eligible for the largest set of query rewrites. Injective lookups must satisfy the following
&quot;one-to-one lookup&quot; properties:</p><ul><li>All values in the lookup table must be unique. That is, no two keys can map to the same value.</li><li>The lookup table must have a key-value pair defined for every input that the <code>LOOKUP</code> function call may
encounter. For example, when calling <code>LOOKUP(sku, &#x27;sku_to_name&#x27;)</code>, the <code>sku_to_name</code> lookup table must have a key
for all possible <code>sku</code>.</li><li>In SQL-compatible null handling mode (when <code>druid.generic.useDefaultValueForNull = false</code>, the default) injective
lookup tables are not required to have keys for <code>null</code>, since <code>LOOKUP</code> of <code>null</code> is always <code>null</code> itself.</li><li>When <code>druid.generic.useDefaultValueForNull = true</code>, a <code>LOOKUP</code> of <code>null</code> retrieves the value mapped to the
empty-string key (<code>&quot;&quot;</code>). In this mode, injective lookup tables must have an empty-string key if the <code>LOOKUP</code>
function may encounter null input values.</li></ul><p>To determine whether a lookup is injective, Druid relies on an <code>injective</code> property that you can set in the
<a href="/docs/latest/querying/lookups-cached-global">lookup definition</a>. In general, you should set
<code>injective: true</code> for any lookup that satisfies the required properties, to allow Druid to run your queries as fast as
possible.</p><p>Druid does not verify whether lookups satisfy these required properties. Druid may return incorrect query results
if you set <code>injective: true</code> for a lookup table that is not actually a one-to-one lookup.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="dynamic-configuration">Dynamic Configuration<a href="#dynamic-configuration" class="hash-link" aria-label="Direct link to Dynamic Configuration" title="Direct link to Dynamic Configuration">​</a></h2><p>The following documents the behavior of the cluster-wide config which is accessible through the Coordinator.
The configuration is propagated through the concept of &quot;tier&quot; of servers.
A &quot;tier&quot; is defined as a group of services which should receive a set of lookups.
For example, you might have all Historicals be part of <code>__default</code>, and Peons be part of individual tiers for the datasources they are tasked with.
The tiers for lookups are completely independent of Historical tiers.</p><p>These configs are accessed using JSON through the following URI template</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">http://&lt;COORDINATOR_IP&gt;:&lt;PORT&gt;/druid/coordinator/v1/lookups/config/{tier}/{id}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>All URIs below are assumed to have <code>http://&lt;COORDINATOR_IP&gt;:&lt;PORT&gt;</code> prepended.</p><p>If you have NEVER configured lookups before, you MUST post an empty json object <code>{}</code> to <code>/druid/coordinator/v1/lookups/config</code> to initialize the configuration.</p><p>These endpoints will return one of the following results:</p><ul><li>404 if the resource is not found</li><li>400 if there is a problem in the formatting of the request</li><li>202 if the request was accepted asynchronously (<code>POST</code> and <code>DELETE</code>)</li><li>200 if the request succeeded (<code>GET</code> only)</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-propagation-behavior">Configuration propagation behavior<a href="#configuration-propagation-behavior" class="hash-link" aria-label="Direct link to Configuration propagation behavior" title="Direct link to Configuration propagation behavior">​</a></h2><p>The configuration is propagated to the query serving processes (Broker / Router / Peon / Historical) by the Coordinator.
The query serving processes have an internal API for managing lookups on the process and those are used by the Coordinator.
The Coordinator periodically checks if any of the processes need to load/drop lookups and updates them appropriately.</p><p>Please note that only 2 simultaneous lookup configuration propagation requests can be concurrently handled by a single query serving process. This limit is applied to prevent lookup handling from consuming too many server HTTP connections.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="api">API<a href="#api" class="hash-link" aria-label="Direct link to API" title="Direct link to API">​</a></h2><p>See <a href="/docs/latest/api-reference/lookups-api">Lookups API</a> for reference on configuring lookups and lookup status. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">Configuration<a href="#configuration" class="hash-link" aria-label="Direct link to Configuration" title="Direct link to Configuration">​</a></h2><p>See <a href="/docs/latest/configuration/#lookups-dynamic-configuration">Lookups Dynamic Configuration</a> for Coordinator configuration.</p><p>To configure a Broker / Router / Historical / Peon to announce itself as part of a lookup tier, use following properties.</p><table><thead><tr><th>Property</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>druid.lookup.lookupTier</code></td><td>The tier for <strong>lookups</strong> for this process. This is independent of other tiers.</td><td><code>__default</code></td></tr><tr><td><code>druid.lookup.lookupTierIsDatasource</code></td><td>For some things like indexing service tasks, the datasource is passed in the runtime properties of a task. This option fetches the tierName from the same value as the datasource for the task. It is suggested to only use this as Peon options for the indexing service, if at all. If true, <code>druid.lookup.lookupTier</code> MUST NOT be specified</td><td><code>&quot;false&quot;</code></td></tr></tbody></table><p>To configure the behavior of the dynamic configuration manager, use the following properties on the Coordinator:</p><table><thead><tr><th>Property</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>druid.manager.lookups.hostTimeout</code></td><td>Timeout (in ms) PER HOST for processing request</td><td><code>2000</code>(2 seconds)</td></tr><tr><td><code>druid.manager.lookups.allHostTimeout</code></td><td>Timeout (in ms) to finish lookup management on all the processes.</td><td><code>900000</code>(15 mins)</td></tr><tr><td><code>druid.manager.lookups.period</code></td><td>How long to pause between management cycles</td><td><code>120000</code>(2 mins)</td></tr><tr><td><code>druid.manager.lookups.threadPoolSize</code></td><td>Number of service processes that can be managed concurrently</td><td><code>10</code></td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="saving-configuration-across-restarts">Saving configuration across restarts<a href="#saving-configuration-across-restarts" class="hash-link" aria-label="Direct link to Saving configuration across restarts" title="Direct link to Saving configuration across restarts">​</a></h2><p>It is possible to save the configuration across restarts such that a process will not have to wait for Coordinator action to re-populate its lookups. To do this the following property is set:</p><table><thead><tr><th>Property</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>druid.lookup.snapshotWorkingDir</code></td><td>Working path used to store snapshot of current lookup configuration, leaving this property null will disable snapshot/bootstrap utility</td><td>null</td></tr><tr><td><code>druid.lookup.enableLookupSyncOnStartup</code></td><td>Enable the lookup synchronization process with Coordinator on startup. The queryable processes will fetch and load the lookups from the Coordinator instead of waiting for the Coordinator to load the lookups for them. Users may opt to disable this option if there are no lookups configured in the cluster.</td><td>true</td></tr><tr><td><code>druid.lookup.numLookupLoadingThreads</code></td><td>Number of threads for loading the lookups in parallel on startup. This thread pool is destroyed once startup is done. It is not kept during the lifetime of the JVM</td><td>Available Processors / 2</td></tr><tr><td><code>druid.lookup.coordinatorFetchRetries</code></td><td>How many times to retry to fetch the lookup bean list from Coordinator, during the sync on startup.</td><td>3</td></tr><tr><td><code>druid.lookup.lookupStartRetries</code></td><td>How many times to retry to start each lookup, either during the sync on startup, or during the runtime.</td><td>3</td></tr><tr><td><code>druid.lookup.coordinatorRetryDelay</code></td><td>How long to delay (in millis) between retries to fetch lookup list from the Coordinator during the sync on startup.</td><td>60_000</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introspect-a-lookup">Introspect a Lookup<a href="#introspect-a-lookup" class="hash-link" aria-label="Direct link to Introspect a Lookup" title="Direct link to Introspect a Lookup">​</a></h2><p>The Broker provides an API for lookup introspection if the lookup type implements a <code>LookupIntrospectHandler</code>.</p><p>A <code>GET</code> request to <code>/druid/v1/lookups/introspect/{lookupId}</code> will return the map of complete values.</p><p>ex: <code>GET /druid/v1/lookups/introspect/nato-phonetic</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;A&quot;: &quot;Alfa&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;B&quot;: &quot;Bravo&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;C&quot;: &quot;Charlie&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;Y&quot;: &quot;Yankee&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;Z&quot;: &quot;Zulu&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;-&quot;: &quot;Dash&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The list of keys can be retrieved via <code>GET</code> to <code>/druid/v1/lookups/introspect/{lookupId}/keys&quot;</code></p><p>ex: <code>GET /druid/v1/lookups/introspect/nato-phonetic/keys</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;A&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;B&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;C&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;Y&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;Z&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;-&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A <code>GET</code> request to <code>/druid/v1/lookups/introspect/{lookupId}/values&quot;</code> will return the list of values.</p><p>ex: <code>GET /druid/v1/lookups/introspect/nato-phonetic/values</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;Alfa&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;Bravo&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;Charlie&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;Yankee&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;Zulu&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;Dash&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/latest/querying/joins"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Joins</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/latest/querying/lookups-cached-global"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Globally Cached Lookups</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#query-syntax" class="table-of-contents__link toc-highlight">Query Syntax</a></li><li><a href="#query-rewrites" class="table-of-contents__link toc-highlight">Query Rewrites</a><ul><li><a href="#reverse-lookup" class="table-of-contents__link toc-highlight">Reverse lookup</a></li><li><a href="#pull-up" class="table-of-contents__link toc-highlight">Pull up</a></li><li><a href="#injective-lookups" class="table-of-contents__link toc-highlight">Injective lookups</a></li></ul></li><li><a href="#dynamic-configuration" class="table-of-contents__link toc-highlight">Dynamic Configuration</a></li><li><a href="#configuration-propagation-behavior" class="table-of-contents__link toc-highlight">Configuration propagation behavior</a></li><li><a href="#api" class="table-of-contents__link toc-highlight">API</a></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a></li><li><a href="#saving-configuration-across-restarts" class="table-of-contents__link toc-highlight">Saving configuration across restarts</a></li><li><a href="#introspect-a-lookup" class="table-of-contents__link toc-highlight">Introspect a Lookup</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/img/favicon.png" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/img/favicon.png" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></div><div class="footer__copyright">Copyright © 2023 Apache Software Foundation. Except where otherwise noted, licensed under CC BY-SA 4.0. Apache Druid, Druid, and the Druid logo are either registered trademarks or trademarks of The Apache Software Foundation in the United States and other countries.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.0af847c9.js"></script>
<script src="/assets/js/main.d0f3a16d.js"></script>
</body>
</html>