<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-release-info/release-notes" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Release notes | Apache® Druid</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://druid.apache.org/img/druid_nav.png"><meta data-rh="true" name="twitter:image" content="https://druid.apache.org/img/druid_nav.png"><meta data-rh="true" property="og:url" content="https://druid.apache.org/docs/31.0.0/release-info/release-notes"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Release notes | Apache® Druid"><meta data-rh="true" name="description" content="&lt;!--"><meta data-rh="true" property="og:description" content="&lt;!--"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://druid.apache.org/docs/31.0.0/release-info/release-notes"><link data-rh="true" rel="alternate" href="https://druid.apache.org/docs/31.0.0/release-info/release-notes" hreflang="en"><link data-rh="true" rel="alternate" href="https://druid.apache.org/docs/31.0.0/release-info/release-notes" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-131010415-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-131010415-1",{})</script>





<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js"></script><link rel="stylesheet" href="/assets/css/styles.60a7f877.css">
<link rel="preload" href="/assets/js/runtime~main.2c2acc8f.js" as="script">
<link rel="preload" href="/assets/js/main.f8032a27.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/druid_nav.png" alt="Apache® Druid" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/druid_nav.png" alt="Apache® Druid" class="themedImage_ToTc themedImage--dark_i4oU"></div></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/technology">Technology</a><a class="navbar__item navbar__link" href="/use-cases">Use Cases</a><a class="navbar__item navbar__link" href="/druid-powered">Powered By</a><a class="navbar__item navbar__link" href="/docs/31.0.0/design/">Docs</a><a class="navbar__item navbar__link" href="/community/">Community</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Apache®</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Foundation<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://apachecon.com/?ref=druid.apache.org" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a class="navbar__item navbar__link" href="/downloads/">Download</a><div class="searchBox_ZlJk"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/31.0.0/design/">Introduction to Apache Druid</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/31.0.0/tutorials/">Getting started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting started&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/31.0.0/design/architecture">Design</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/31.0.0/ingestion/">Ingestion</a><button aria-label="Toggle the collapsible sidebar category &#x27;Ingestion&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/31.0.0/data-management/">Data management</a><button aria-label="Toggle the collapsible sidebar category &#x27;Data management&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/31.0.0/querying/sql">Querying</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/31.0.0/api-reference/">API reference</a><button aria-label="Toggle the collapsible sidebar category &#x27;API reference&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/31.0.0/configuration/">Configuration</a><button aria-label="Toggle the collapsible sidebar category &#x27;Configuration&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/31.0.0/api-reference/automatic-compaction-api">Operations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/31.0.0/development/overview">Development</a><button aria-label="Toggle the collapsible sidebar category &#x27;Development&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/31.0.0/release-info/release-notes">Release info</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/31.0.0/release-info/release-notes">Release notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/31.0.0/release-info/upgrade-notes">Upgrade notes</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/31.0.0/release-info/migration-guide">Migration guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Migration guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/31.0.0/misc/papers-and-talks">Papers</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Release info</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Release notes</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Release notes</h1></header><p>Apache Druid 31.0.0 contains over 589 new features, bug fixes, performance enhancements, documentation improvements, and additional test coverage from 64 contributors.</p><p>See the <a href="https://github.com/apache/druid/issues?q=is%3Aclosed+milestone%3A31.0.0+sort%3Aupdated-desc+" target="_blank" rel="noopener noreferrer">complete set of changes</a> for additional details, including bug fixes.</p><p>Review the <a href="#upgrade-notes">upgrade notes</a> and <a href="#incompatible-changes">incompatible changes</a> before you upgrade to Druid 31.0.0.
If you are upgrading across multiple versions, see the <a href="https://druid.apache.org/docs/latest/release-info/upgrade-notes" target="_blank" rel="noopener noreferrer">Upgrade notes</a> page, which lists upgrade notes for the most recent Druid versions.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="important-features-changes-and-deprecations">Important features, changes, and deprecations<a href="#important-features-changes-and-deprecations" class="hash-link" aria-label="Direct link to Important features, changes, and deprecations" title="Direct link to Important features, changes, and deprecations">​</a></h2><p>This section contains important information about new and existing features.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="compaction-features">Compaction features<a href="#compaction-features" class="hash-link" aria-label="Direct link to Compaction features" title="Direct link to Compaction features">​</a></h3><p>Druid now supports the following features:</p><ul><li>Compaction scheduler with greater flexibility and control over when and what to compact.</li><li>MSQ task engine-based auto-compaction for more performant compaction jobs.</li></ul><p>For more information, see <a href="#compaction-supervisors-experimental">Compaction supervisors</a>.</p><p><a href="https://github.com/apache/druid/pull/16291" target="_blank" rel="noopener noreferrer">#16291</a> <a href="https://github.com/apache/druid/pull/16768" target="_blank" rel="noopener noreferrer">#16768</a></p><p>Additionally, compaction tasks that take advantage of concurrent append and replace is now generally available as part of concurrent append and replace becoming GA.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="window-functions-are-ga">Window functions are GA<a href="#window-functions-are-ga" class="hash-link" aria-label="Direct link to Window functions are GA" title="Direct link to Window functions are GA">​</a></h3><p><a href="https://druid.apache.org/docs/latest/querying/sql-window-functions" target="_blank" rel="noopener noreferrer">Window functions</a> are now generally available in Druid&#x27;s native engine and in the MSQ task engine.</p><ul><li>You no longer need to use the query context <code>enableWindowing</code> to use window functions. <a href="https://github.com/apache/druid/pull/17087" target="_blank" rel="noopener noreferrer">#17087</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="concurrent-append-and-replace-ga">Concurrent append and replace GA<a href="#concurrent-append-and-replace-ga" class="hash-link" aria-label="Direct link to Concurrent append and replace GA" title="Direct link to Concurrent append and replace GA">​</a></h3><p>Concurrent append and replace is now GA. The feature safely replaces the existing data in an interval of a datasource while new data is being appended to that interval. One of the most common applications of this feature is appending new data (such as with streaming ingestion) to an interval while compaction of that interval is already in progress. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="delta-lake-improvements">Delta Lake improvements<a href="#delta-lake-improvements" class="hash-link" aria-label="Direct link to Delta Lake improvements" title="Direct link to Delta Lake improvements">​</a></h3><p>The community extension for Delta Lake has been improved to support <a href="#delta-lake-complex-types">complex types</a> and <a href="#delta-lake-snapshot-versions">snapshot versions</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="iceberg-improvements">Iceberg improvements<a href="#iceberg-improvements" class="hash-link" aria-label="Direct link to Iceberg improvements" title="Direct link to Iceberg improvements">​</a></h3><p>The community extension for Iceberg has been improved. For more information, see <a href="#iceberg-improvements">Iceberg improvements</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="projections-experimental">Projections (experimental)<a href="#projections-experimental" class="hash-link" aria-label="Direct link to Projections (experimental)" title="Direct link to Projections (experimental)">​</a></h3><p>Druid 31.0.0 includes experimental support for new feature called projections. Projections are grouped pre-aggregates of a segment that are automatically used at query time to optimize execution for any queries which &#x27;fit&#x27; the shape of the projection by reducing both computation and i/o cost by reducing the number of rows which need to be processed. Projections are contained within segments of a datasource and do increase the segment size. But they can share data, such as value dictionaries of dictionary encoded columns, with the columns of the base segment.</p><p>Projections currently only support JSON-based ingestion, but they can be used by queries that use the MSQ task engine or the new Dart engine. Future development will allow projections to be created as part of SQL-based ingestion.</p><p>We have a lot of plans to continue to improve this feature in the coming releases, but are excited to get it out there so users can begin experimentation since projections can dramatically improve query performance.</p><p>For more information, see <a href="#projections">Projections</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="low-latency-high-complexity-queries-using-dart-experimental">Low latency high complexity queries using Dart (experimental)<a href="#low-latency-high-complexity-queries-using-dart-experimental" class="hash-link" aria-label="Direct link to Low latency high complexity queries using Dart (experimental)" title="Direct link to Low latency high complexity queries using Dart (experimental)">​</a></h3><p>Distributed Asynchronous Runtime Topology (Dart) is designed to support high complexity queries, such as large joins, high cardinality group by, subqueries and common table expressions, commonly found in ad-hoc, data warehouse workloads. Instead of using data warehouse engines like Spark or Presto to execute high-complexity queries, you can use Dart, alleviating the need for additional infrastructure.</p><p>For more information, see <a href="#dart">Dart</a>.</p><p><a href="https://github.com/apache/druid/pull/17140" target="_blank" rel="noopener noreferrer">#17140</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="storage-improvements">Storage improvements<a href="#storage-improvements" class="hash-link" aria-label="Direct link to Storage improvements" title="Direct link to Storage improvements">​</a></h3><p>Druid 31.0.0 includes several improvements to how data is stored by Druid, including compressed columns and flexible segment sorting. For more information, see <a href="#storage-improvements-1">Storage improvements</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="upgrade-related-changes">Upgrade-related changes<a href="#upgrade-related-changes" class="hash-link" aria-label="Direct link to Upgrade-related changes" title="Direct link to Upgrade-related changes">​</a></h3><p>See the <a href="#upgrade-notes">Upgrade notes</a> for more information about the following upgrade-related changes:</p><ul><li><a href="#array-ingest-mode-now-defaults-to-array">Array ingest mode now defaults to array</a></li><li><a href="#zk-based-segment-loading">Disabled ZK-based segment loading</a></li><li><a href="#removed-task-action-audit-logging">Removed task action audit logging</a></li><li><a href="#removed-firehose-and-firehosefactory">Removed Firehose and FirehoseFactory</a></li><li><a href="#removed-the-scan-query-legacy-mode">Removed the scan query legacy mode</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="deprecations">Deprecations<a href="#deprecations" class="hash-link" aria-label="Direct link to Deprecations" title="Direct link to Deprecations">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="java-8-support">Java 8 support<a href="#java-8-support" class="hash-link" aria-label="Direct link to Java 8 support" title="Direct link to Java 8 support">​</a></h4><p>Java 8 support is now deprecated and will be removed in 32.0.0. </p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="other-deprecations">Other deprecations<a href="#other-deprecations" class="hash-link" aria-label="Direct link to Other deprecations" title="Direct link to Other deprecations">​</a></h4><ul><li>Deprecated API <code>/lockedIntervals</code> is now removed <a href="https://github.com/apache/druid/pull/16799" target="_blank" rel="noopener noreferrer">#16799</a></li><li><a href="#api-for-cluster-level-compaction-configuration">Cluster-level compaction API</a> deprecates task slots compaction API <a href="https://github.com/apache/druid/pull/16803" target="_blank" rel="noopener noreferrer">#16803</a></li><li>The <code>arrayIngestMode</code> context parameter is deprecated and will be removed. For more information, see <a href="#array-ingest-mode-now-defaults-to-array">Array ingest mode now defaults to array</a>.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="functional-areas-and-related-changes">Functional areas and related changes<a href="#functional-areas-and-related-changes" class="hash-link" aria-label="Direct link to Functional areas and related changes" title="Direct link to Functional areas and related changes">​</a></h2><p>This section contains detailed release notes separated by areas.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="web-console">Web console<a href="#web-console" class="hash-link" aria-label="Direct link to Web console" title="Direct link to Web console">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="improvements-to-the-stages-display">Improvements to the stages display<a href="#improvements-to-the-stages-display" class="hash-link" aria-label="Direct link to Improvements to the stages display" title="Direct link to Improvements to the stages display">​</a></h4><p>A number of improvements have been made to the query stages visualization
<img loading="lazy" alt="new_stages.png" src="/assets/images/web-console-31-rn-new_stages-94e447f2bdefa86c8733e946fa830014.png" width="2500" height="1280" class="img_ev3q">
These changes include:</p><ul><li>Added a graph visualization to illustrate the flow of query stages <a href="https://github.com/apache/druid/pull/17135" target="_blank" rel="noopener noreferrer">#17135</a></li><li>Added a column for CPU counters in the query stages detail view when they are present. Also added tool tips to expose potentially hidden data like CPU time <a href="https://github.com/apache/druid/pull/17132" target="_blank" rel="noopener noreferrer">#17132</a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="dart">Dart<a href="#dart" class="hash-link" aria-label="Direct link to Dart" title="Direct link to Dart">​</a></h4><p>Added the ability to detect the presence of the Dart engine and to run Dart queries from the console as well as to see currently running Dart queries.
<img loading="lazy" alt="dart.png" src="/assets/images/web-console-31-rn-dart-d6333d95a185b478c337655be773239b.png" width="2500" height="1280" class="img_ev3q">
<a href="https://github.com/apache/druid/pull/17147" target="_blank" rel="noopener noreferrer">#17147</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="copy-query-results-as-sql">Copy query results as SQL<a href="#copy-query-results-as-sql" class="hash-link" aria-label="Direct link to Copy query results as SQL" title="Direct link to Copy query results as SQL">​</a></h4><p>You can now copy the results of a query as a Druid SQL statement:
<img loading="lazy" src="/assets/images/web-console-31-rn-copy-results-as-sql-bab61feeacecc96592d9dd5273ad2d33.png" width="1636" height="1292" class="img_ev3q">
When you copy the results of the pictured query, you get the following query:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  CAST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;c1&quot;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;channel&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  CAST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;c2&quot;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VARCHAR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;cityName&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  DECODE_BASE64_COMPLEX</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;thetaSketch&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;c3&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;user_theta&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">VALUES</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ca&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;AQMDAAA6zJOcUskA1pEMGA==&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;de&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;AQMDAAA6zJP43ITYexvoEw==&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;de&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;AQMDAAA6zJNtue8WOvrJdA==&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;en&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;AQMDAAA6zJMruSUUqmzufg==&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;en&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;AQMDAAA6zJM6dC5sW2sTEg==&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;en&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;AQMDAAA6zJM6dC5sW2sTEg==&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;en&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;AQMDAAA6zJPqjEoIBIGtDw==&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;en&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Caulfield&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;AQMDAAA6zJOOtGipKE6KIA==&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;fa&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;AQMDAAA6zJM8nxZkoGPlLw==&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;vi&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;AQMDAAA6zJMk4ZadSFqHJw==&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;t&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;c1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;c2&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;c3&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><a href="https://github.com/apache/druid/pull/16458" target="_blank" rel="noopener noreferrer">#16458</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="explore-view-improvements">Explore view improvements<a href="#explore-view-improvements" class="hash-link" aria-label="Direct link to Explore view improvements" title="Direct link to Explore view improvements">​</a></h4><p>You can now configure the Explore view on top of a source query instead of only existing tables.
You can also point and click to edit the source query, store measures in the source query,
and return to the state of your view using stateful URLs.
<a href="https://github.com/apache/druid/pull/17180" target="_blank" rel="noopener noreferrer">#17180</a></p><p>Other changes to the Explore view include the following:</p><ul><li>Added the ability to define expressions and measures on the fly</li><li>Added the ability to hide all null columns in the record table</li><li>Added the ability to expand a nested column into is constituent paths
<a href="https://github.com/apache/druid/pull/17213" target="_blank" rel="noopener noreferrer">#17213</a> <a href="https://github.com/apache/druid/pull/17225" target="_blank" rel="noopener noreferrer">#17225</a> <a href="https://github.com/apache/druid/pull/17234" target="_blank" rel="noopener noreferrer">#17234</a> <a href="https://github.com/apache/druid/pull/17180" target="_blank" rel="noopener noreferrer">#17180</a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="support-delta-lake-ingestion-in-the-data-loaders">Support Delta lake ingestion in the data loaders<a href="#support-delta-lake-ingestion-in-the-data-loaders" class="hash-link" aria-label="Direct link to Support Delta lake ingestion in the data loaders" title="Direct link to Support Delta lake ingestion in the data loaders">​</a></h4><ul><li>Added the Delta tile to the data loader for SQL-based batch and classic batch ingestion methods
<a href="https://github.com/apache/druid/pull/17160" target="_blank" rel="noopener noreferrer">#17160</a> <a href="https://github.com/apache/druid/pull/17023" target="_blank" rel="noopener noreferrer">#17023</a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="support-kinesis-input-format">Support Kinesis input format<a href="#support-kinesis-input-format" class="hash-link" aria-label="Direct link to Support Kinesis input format" title="Direct link to Support Kinesis input format">​</a></h4><p>The web console now supports the Kinesis input format.
<a href="https://github.com/apache/druid/pull/16850" target="_blank" rel="noopener noreferrer">#16850</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="other-web-console-improvements">Other web console improvements<a href="#other-web-console-improvements" class="hash-link" aria-label="Direct link to Other web console improvements" title="Direct link to Other web console improvements">​</a></h4><ul><li>You can now search for datasources in the segment timeline visualization - previously you had to find them manually <a href="https://github.com/apache/druid/pull/16371" target="_blank" rel="noopener noreferrer">#16371</a></li><li>Showing JSON values (in query results) now display both raw and formatted JSON, making the data easier to read and troubleshoot <a href="https://github.com/apache/druid/pull/16632" target="_blank" rel="noopener noreferrer">#16632</a></li><li>Added the ability to submit a suspended supervisor from the data loader <a href="https://github.com/apache/druid/pull/16696" target="_blank" rel="noopener noreferrer">#16696</a></li><li>Added column mapping information to the explain plan <a href="https://github.com/apache/druid/pull/16598" target="_blank" rel="noopener noreferrer">#16598</a></li><li>Updated the Web Console to use array mode by default for schema discovery <a href="https://github.com/apache/druid/pull/17133" target="_blank" rel="noopener noreferrer">#17133</a></li><li>Fixed NPE due to null values in numeric columns <a href="https://github.com/apache/druid/pull/16760" target="_blank" rel="noopener noreferrer">#16760</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ingestion">Ingestion<a href="#ingestion" class="hash-link" aria-label="Direct link to Ingestion" title="Direct link to Ingestion">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="optimized-the-loading-of-broadcast-data-sources">Optimized the loading of broadcast data sources<a href="#optimized-the-loading-of-broadcast-data-sources" class="hash-link" aria-label="Direct link to Optimized the loading of broadcast data sources" title="Direct link to Optimized the loading of broadcast data sources">​</a></h4><p>Previously all services and tasks downloaded all broadcast data sources.
To save task storage space and reduce task startup time, this modification prevents kill tasks and MSQ controller tasks from downloading unneeded broadcast data sources. All other tasks still load all broadcast data sources.</p><p>The <code>CLIPeon</code> command line option <code>--loadBroadcastSegments</code> is deprecated in favor of <code>--loadBroadcastDatasourceMode</code>.</p><p><a href="https://github.com/apache/druid/pull/17027" target="_blank" rel="noopener noreferrer">#17027</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="general-ingestion-improvements">General ingestion improvements<a href="#general-ingestion-improvements" class="hash-link" aria-label="Direct link to General ingestion improvements" title="Direct link to General ingestion improvements">​</a></h4><ul><li>The default value for <code>druid.indexer.tasklock.batchAllocationWaitTime</code> is now 0 <a href="https://github.com/apache/druid/pull/16578" target="_blank" rel="noopener noreferrer">#16578</a></li><li>Hadoop-based ingestion now works on Kubernetes deployments <a href="https://github.com/apache/druid/pull/16726" target="_blank" rel="noopener noreferrer">#16726</a></li><li>Hadoop-based ingestion now has a Boolean config <code>useMaxMemoryEstimates</code> parameter, which controls how memory footprint gets estimated. The default is false, so that the behavior matches native JSON-based batch ingestion <a href="https://github.com/apache/druid/pull/16280" target="_blank" rel="noopener noreferrer">#16280</a></li><li>Added <code>druid-parquet-extensions</code> to all example quickstart configurations <a href="https://github.com/apache/druid/pull/16664" target="_blank" rel="noopener noreferrer">#16664</a></li><li>Added support for ingesting CSV format data into Kafka records when Kafka ingestion is enabled with <code>ioConfig.type = kafka</code> <a href="https://github.com/apache/druid/pull/16630" target="_blank" rel="noopener noreferrer">#16630</a></li><li>Added logging for sketches on workers <a href="https://github.com/apache/druid/pull/16697" target="_blank" rel="noopener noreferrer">#16697</a></li><li>Removed obsolete tasks <code>index_realtime</code> and <code>index_realtime_appenderator</code> tasks<!-- -->—<!-- -->you can no longer use these tasks to ingest data <a href="https://github.com/apache/druid/pull/16602" target="_blank" rel="noopener noreferrer">#16602</a></li><li>Renamed <code>TaskStorageQueryAdapter</code> to <code>TaskQueryTool</code> and removed the <code>isAudited</code> method <a href="https://github.com/apache/druid/pull/16750" target="_blank" rel="noopener noreferrer">#16750</a></li><li>Improved Overlord performance by reducing redundant calls in SQL statements <a href="https://github.com/apache/druid/pull/16839" target="_blank" rel="noopener noreferrer">#16839</a></li><li>Improved <code>CustomExceptionMapper</code> so that it returns a correct failure message <a href="https://github.com/apache/druid/pull/17016" target="_blank" rel="noopener noreferrer">#17016</a></li><li>Improved time filtering in subqueries and non-table data sources <a href="https://github.com/apache/druid/pull/17173" target="_blank" rel="noopener noreferrer">#17173</a></li><li>Improved <code>WindowOperatorQueryFrameProcessor</code> to avoid unnecessary re-runs <a href="https://github.com/apache/druid/pull/17211" target="_blank" rel="noopener noreferrer">#17211</a></li><li>Improved memory management by dividing the amount of <code>partitionStatsMemory</code> by two to account for two simultaneous statistics collectors <a href="https://github.com/apache/druid/pull/17216" target="_blank" rel="noopener noreferrer">#17216</a></li><li>Fixed NPE in <code>CompactSegments</code> <a href="https://github.com/apache/druid/pull/16713" target="_blank" rel="noopener noreferrer">#16713</a></li><li>Fixed Parquet reader to ensure that Druid reads the required columns for a filter from the Parquet data files <a href="https://github.com/apache/druid/pull/16874" target="_blank" rel="noopener noreferrer">#16874</a></li><li>Fixed a distinct sketches issue where Druid called <code>retainedKeys.firstKey()</code> twice when adding another sketch <a href="https://github.com/apache/druid/pull/17184" target="_blank" rel="noopener noreferrer">#17184</a></li><li>Fixed a <code>WindowOperatorQueryFrameProcessor</code> issue where larger queries could reach the frame writer&#x27;s capacity preventing it from outputting all of the result rows <a href="https://github.com/apache/druid/pull/17209" target="_blank" rel="noopener noreferrer">#17209</a></li><li>Fixed native ingestion task failures during rolling upgrades from a version before Druid 30 <a href="https://github.com/apache/druid/pull/17219" target="_blank" rel="noopener noreferrer">#17219</a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="sql-based-ingestion">SQL-based ingestion<a href="#sql-based-ingestion" class="hash-link" aria-label="Direct link to SQL-based ingestion" title="Direct link to SQL-based ingestion">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="optimized-s3-storage-writing-for-msq-durable-storage">Optimized S3 storage writing for MSQ durable storage<a href="#optimized-s3-storage-writing-for-msq-durable-storage" class="hash-link" aria-label="Direct link to Optimized S3 storage writing for MSQ durable storage" title="Direct link to Optimized S3 storage writing for MSQ durable storage">​</a></h5><p>For queries that use the MSQ task engine and write their output to S3 as durable storage, uploading chunks of data is now faster.</p><p><a href="https://github.com/apache/druid/pull/16481" target="_blank" rel="noopener noreferrer">#16481</a></p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="improved-lookup-performance">Improved lookup performance<a href="#improved-lookup-performance" class="hash-link" aria-label="Direct link to Improved lookup performance" title="Direct link to Improved lookup performance">​</a></h5><p>Improved lookup performance for queries that use the MSQ task engine by only loading required lookups. This applies to both ingestion and querying.</p><p><a href="https://github.com/apache/druid/pull/16358" target="_blank" rel="noopener noreferrer">#16358</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="other-sql-based-ingestion-improvements">Other SQL-based ingestion improvements<a href="#other-sql-based-ingestion-improvements" class="hash-link" aria-label="Direct link to Other SQL-based ingestion improvements" title="Direct link to Other SQL-based ingestion improvements">​</a></h4><ul><li>Added the ability to use <code>useConcurrentLocks</code> in task context to determine task lock type <a href="https://github.com/apache/druid/pull/17193" target="_blank" rel="noopener noreferrer">#17193</a></li><li>Improved error handling when retrieving Avro schemas from registry <a href="https://github.com/apache/druid/pull/16684" target="_blank" rel="noopener noreferrer">#16684</a></li><li>Fixed issues related to partitioning boundaries in the MSQ task engine&#x27;s window functions <a href="https://github.com/apache/druid/pull/16729" target="_blank" rel="noopener noreferrer">#16729</a></li><li>Fixed a boost column issue causing quantile sketches to incorrectly estimate the number of output partitions to create <a href="https://github.com/apache/druid/pull/17141" target="_blank" rel="noopener noreferrer">#17141</a></li><li>Fixed an issue with <code>ScanQueryFrameProcessor</code> cursor build not adjusting intervals <a href="https://github.com/apache/druid/pull/17168" target="_blank" rel="noopener noreferrer">#17168</a></li><li>Improved worker cancellation for the MSQ task engine to prevent race conditions <a href="https://github.com/apache/druid/pull/17046" target="_blank" rel="noopener noreferrer">#17046</a></li><li>Improved memory management to better support multi-threaded workers <a href="https://github.com/apache/druid/pull/17057" target="_blank" rel="noopener noreferrer">#17057</a></li><li>Added new format for serialization of sketches between MSQ controller and worker to reduce memory usage <a href="https://github.com/apache/druid/pull/16269" target="_blank" rel="noopener noreferrer">#16269</a></li><li>Improved error handling when retrieving Avro schemas from registry <a href="https://github.com/apache/druid/pull/16684" target="_blank" rel="noopener noreferrer">#16684</a></li><li>Fixed issues related to partitioning boundaries in the MSQ task engine&#x27;s window functions <a href="https://github.com/apache/druid/pull/16729" target="_blank" rel="noopener noreferrer">#16729</a></li><li>Fixed handling of null bytes that led to a runtime exception for &quot;Invalid value start byte&quot; <a href="https://github.com/apache/druid/pull/17232" target="_blank" rel="noopener noreferrer">#17232</a></li><li>Updated logic to fix incorrect query results for comparisons involving arrays <a href="https://github.com/apache/druid/pull/16780" target="_blank" rel="noopener noreferrer">#16780</a></li><li>You can now pass a custom <code>DimensionSchema</code> map to MSQ query destination of type <code>DataSourceMSQDestination</code> instead of using the default values <a href="https://github.com/apache/druid/pull/16864" target="_blank" rel="noopener noreferrer">#16864</a></li><li>Fixed the calculation of suggested memory in <code>WorkerMemoryParameters</code> to account for <code>maxConcurrentStages</code> which improves the accuracy of error messages <a href="https://github.com/apache/druid/pull/17108" target="_blank" rel="noopener noreferrer">#17108</a></li><li>Optimized the row-based frame writer to reduce failures when writing larger single rows to frames <a href="https://github.com/apache/druid/pull/17094" target="_blank" rel="noopener noreferrer">#17094</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="streaming-ingestion">Streaming ingestion<a href="#streaming-ingestion" class="hash-link" aria-label="Direct link to Streaming ingestion" title="Direct link to Streaming ingestion">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="new-kinesis-input-format">New Kinesis input format<a href="#new-kinesis-input-format" class="hash-link" aria-label="Direct link to New Kinesis input format" title="Direct link to New Kinesis input format">​</a></h4><p>Added a Kinesis input format and reader for timestamp and payload parsing.
The reader relies on a <code>ByteEntity</code> type of <code>KinesisRecordEntity</code> which includes the underlying Kinesis record.</p><p><a href="https://github.com/apache/druid/pull/16813" target="_blank" rel="noopener noreferrer">#16813</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="streaming-ingestion-improvements">Streaming ingestion improvements<a href="#streaming-ingestion-improvements" class="hash-link" aria-label="Direct link to Streaming ingestion improvements" title="Direct link to Streaming ingestion improvements">​</a></h4><ul><li>Added a check for handing off upgraded real-time segments. This prevents data from being temporarily unavailable for queries during segment handoff <a href="https://github.com/apache/druid/pull/16162" target="_blank" rel="noopener noreferrer">#16162</a></li><li>Improved the user experience for autoscaling Kinesis. Switching to autoscaling based on max lag per shard from total lag for shard is now controlled by the <code>lagAggregate</code> config, defaulting to sum <a href="https://github.com/apache/druid/pull/16334" target="_blank" rel="noopener noreferrer">#16334</a></li><li>Improved the Supervisor so that it doesn&#x27;t change to a running state from idle if the Overlord restarts <a href="https://github.com/apache/druid/pull/16844" target="_blank" rel="noopener noreferrer">#16844</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="querying">Querying<a href="#querying" class="hash-link" aria-label="Direct link to Querying" title="Direct link to Querying">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="dart-1">Dart<a href="#dart-1" class="hash-link" aria-label="Direct link to Dart" title="Direct link to Dart">​</a></h4><p>Dart is a query engine with multi-threaded workers that conducts in-memory shuffles to provide tunable concurrency and infrastructure costs for low-latency high complexity queries.</p><p>To try out Dart, set <code>druid.msq.dart.enabled</code> to <code>true</code> in your common runtime properties. Then, you can select Dart as a query engine in the web console or through the API <code>/druid/v2/sql/dart</code>, which accepts the same JSON payload as <code>/druid/v2/sql</code>. Dart is fully compatible with current Druid query shapes and Druid&#x27;s storage format. That means you can try Dart with your existing queries and datasources.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="projections">Projections<a href="#projections" class="hash-link" aria-label="Direct link to Projections" title="Direct link to Projections">​</a></h4><p>As an experimental feature, projections are not well documented yet, but can be defined for streaming ingestion and &#x27;classic&#x27; batch ingestion as part of the <code>dataSchema</code>. For an example ingestion spec, see the <a href="https://github.com/apache/druid/pull/17214" target="_blank" rel="noopener noreferrer">the pull request description for #17214</a>.</p><p>The <code>groupingColumns</code> field in the spec defines the order which data is sorted in the projection. Instead of explicitly defining granularity like for the base table, you define it with a virtual column. During ingestion, the processing logic finds the ‘finest’ granularity virtual column that is a <code>timestamp_floor</code> expression and uses it as the <code>__time</code> column for the projection. Projections do not need to have a time column defined. In these cases, they can still match queries that are not grouping on time.</p><p>There are new query context flags that have been added to aid in experimentation with projections:</p><ul><li><p><code>useProjection</code> accepts a specific projection name and instructs the query engine that it must use that projection, and will fail the query if the projection does not match the query</p></li><li><p><code>forceProjections</code> accepts true or false and instructs the query engine that it must use a projection, and will fail the query if it cannot find a matching projection</p></li><li><p><code>noProjections</code> accepts true or false and instructs the query engines to not use any projections</p><p><a href="https://github.com/apache/druid/pull/17214" target="_blank" rel="noopener noreferrer">#17214</a></p></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="enabled-querying-cold-datasources">Enabled querying cold datasources<a href="#enabled-querying-cold-datasources" class="hash-link" aria-label="Direct link to Enabled querying cold datasources" title="Direct link to Enabled querying cold datasources">​</a></h4><p>You can now query entirely cold datasources after you enable the <code>CentralizedDatasourceSchema</code> feature. For information about how to use a centralized datasource schema, see <a href="https://druid.apache.org/docs/latest/configuration/#centralized-datasource-schema" target="_blank" rel="noopener noreferrer">Centralized datasource schema</a>.</p><p><a href="https://github.com/apache/druid/pull/16676" target="_blank" rel="noopener noreferrer">#16676</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="sql-div-function">SQL DIV function<a href="#sql-div-function" class="hash-link" aria-label="Direct link to SQL DIV function" title="Direct link to SQL DIV function">​</a></h4><p>You can now use the SQL DIV function.</p><p><a href="https://github.com/apache/druid/pull/16464" target="_blank" rel="noopener noreferrer">#16464</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="modified-equality-and-typed-in-filter-behavior">Modified equality and typed in filter behavior<a href="#modified-equality-and-typed-in-filter-behavior" class="hash-link" aria-label="Direct link to Modified equality and typed in filter behavior" title="Direct link to Modified equality and typed in filter behavior">​</a></h4><p>Modified the behavior of using <code>EqualityFilter</code> and <code>TypedInFilter</code> to match numeric values (particularly DOUBLE) against string columns by casting strings for numerical comparison. This ensures more consistent Druid behavior when the <code>sqlUseBoundAndSelectors</code> context flag is set.</p><p><a href="https://github.com/apache/druid/pull/16593" target="_blank" rel="noopener noreferrer">#16593</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="window-query-guardrails">Window query guardrails<a href="#window-query-guardrails" class="hash-link" aria-label="Direct link to Window query guardrails" title="Direct link to Window query guardrails">​</a></h4><p>Druid blocks window queries that involve aggregation functions inside the window clause when the window is included in SELECT.
The error message provides details on updating your query syntax.</p><p><a href="https://github.com/apache/druid/pull/16801" target="_blank" rel="noopener noreferrer">#16801</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="updated-query-from-deep-storage-api-response">Updated query from deep storage API response<a href="#updated-query-from-deep-storage-api-response" class="hash-link" aria-label="Direct link to Updated query from deep storage API response" title="Direct link to Updated query from deep storage API response">​</a></h4><p>Added the following fields from the query-based ingestion task report to the response for API request <code>GET</code> <code>/v2/sql/statements/query-id?detail=true</code>:</p><ul><li><code>stages</code>: Query stages</li><li><code>counters</code>: Stage counters</li><li><code>warnings</code>: Warning reports</li></ul><p><a href="https://github.com/apache/druid/pull/16808" target="_blank" rel="noopener noreferrer">#16808</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="other-querying-improvements">Other querying improvements<a href="#other-querying-improvements" class="hash-link" aria-label="Direct link to Other querying improvements" title="Direct link to Other querying improvements">​</a></h4><ul><li>Improved window queries so that window queries without group by using the native engine don&#x27;t return an empty response <a href="https://github.com/apache/druid/pull/16658" target="_blank" rel="noopener noreferrer">#16658</a></li><li>Window queries now support the guardrail <code>maxSubqueryBytes</code>  <a href="https://github.com/apache/druid/pull/16800" target="_blank" rel="noopener noreferrer">#16800</a></li><li>Window functions that use the MSQ task engine now reject MVDs when they&#x27;re used as the PARTITION BY column. Previously, an exception occurred <a href="https://github.com/apache/druid/pull/17036" target="_blank" rel="noopener noreferrer">#17036</a></li><li>A query that references aggregators called with unsupported distinct values now fails <a href="https://github.com/apache/druid/pull/16770" target="_blank" rel="noopener noreferrer">#16770</a></li><li>Druid now validates that a complex type aligns with the supported types when used with an aggregator <a href="https://github.com/apache/druid/pull/16682" target="_blank" rel="noopener noreferrer">#16682</a></li><li>Druid prevents you from using DISTINCT or unsupported aggregations with window functions <a href="https://github.com/apache/druid/pull/16738" target="_blank" rel="noopener noreferrer">#16738</a></li><li>Druid now deduces type from aggregators when materializing subquery results <a href="https://github.com/apache/druid/pull/16703" target="_blank" rel="noopener noreferrer">#16703</a></li><li>Added the ability to define the segment granularity of a table in the catalog <a href="https://github.com/apache/druid/pull/16680" target="_blank" rel="noopener noreferrer">#16680</a></li><li>Added a way for columns to provide <code>GroupByVectorColumnSelectors</code>, which controls how the groupBy engine operates on them <a href="https://github.com/apache/druid/pull/16338" target="_blank" rel="noopener noreferrer">#16338</a></li><li>Added <code>sqlPlannerBloat</code> query context parameter to control whether two project operators get merged when inlining expressions <a href="https://github.com/apache/druid/pull/16248" target="_blank" rel="noopener noreferrer">#16248</a></li><li>Improved window function offsets for <code>ArrayListRowsAndColumns</code> <a href="https://github.com/apache/druid/pull/16718" target="_blank" rel="noopener noreferrer">#16718</a></li><li>Improved the fallback strategy when the Broker is unable to materialize the subquery&#x27;s results as frames for estimating the bytes <a href="https://github.com/apache/druid/pull/16679" target="_blank" rel="noopener noreferrer">#16679</a></li><li>Improved how Druid executes queries that contain a LIMIT clause <a href="https://github.com/apache/druid/pull/16643" target="_blank" rel="noopener noreferrer">#16643</a></li><li>Improved the code style of <code>NestedDataOperatorConversions</code> to be consistent for each <code>SqlOperatorConversion</code> <a href="https://github.com/apache/druid/pull/16695" target="_blank" rel="noopener noreferrer">#16695</a></li><li>Improved window functions so that they reject multi-value dimensions during processing instead of failing to process them <a href="https://github.com/apache/druid/pull/17002" target="_blank" rel="noopener noreferrer">#17002</a></li><li>Improved async query by increasing its timeout to 5 seconds <a href="https://github.com/apache/druid/pull/16656" target="_blank" rel="noopener noreferrer">#16656</a></li><li>Improved error message when the requested number of rows in a window exceeds the maximum <a href="https://github.com/apache/druid/pull/16906" target="_blank" rel="noopener noreferrer">#16906</a></li><li>Improved numeric aggregations so that Druid now coerces complex types to number when possible, such as for <code>SpectatorHistogram</code> <a href="https://github.com/apache/druid/pull/16564" target="_blank" rel="noopener noreferrer">#16564</a></li><li>Improved query filtering to correctly process cases where both an IN expression and an equality (<code>=</code>) filter are applied to the same string value <a href="https://github.com/apache/druid/pull/16597" target="_blank" rel="noopener noreferrer">#16597</a></li><li>Improved the speed of SQL IN queries that use the SCALAR_IN_ARRAY function <a href="https://github.com/apache/druid/pull/16388" target="_blank" rel="noopener noreferrer">#16388</a></li><li>Improved the ARRAY_TO_MV function to handle cases where an object selector encounters a multi-value string <a href="https://github.com/apache/druid/pull/17162" target="_blank" rel="noopener noreferrer">#17162</a></li><li>Improved query filtering so that Druid tries to arrange query filters based on the computational cost of bitmap indexes, prioritizing less expensive filters for computation first. Filters with high compute costs relative to the number of rows they can filter might be omitted. <a href="https://github.com/apache/druid/pull/17055" target="_blank" rel="noopener noreferrer">#17055</a> <a href="https://github.com/apache/druid/pull/17125" target="_blank" rel="noopener noreferrer">#17125</a></li><li>Updated the deserialization of dimensions in GROUP BY queries to operate on all dimensions at once rather than deserializing individual dimensions <a href="https://github.com/apache/druid/pull/16740" target="_blank" rel="noopener noreferrer">#16740</a></li><li>Fixed an issue that caused <code>maxSubqueryBytes</code> to fail when segments had missing columns <a href="https://github.com/apache/druid/pull/16619" target="_blank" rel="noopener noreferrer">#16619</a></li><li>Fixed an issue with the array type selector that caused the array aggregation over window frame to fail <a href="https://github.com/apache/druid/pull/16653" target="_blank" rel="noopener noreferrer">#16653</a></li><li>Fixed support for native window queries without a group by clause <a href="https://github.com/apache/druid/pull/16753" target="_blank" rel="noopener noreferrer">#16753</a></li><li>Window functions now support <code>maxSubqueryBytes</code> <a href="https://github.com/apache/druid/pull/16800" target="_blank" rel="noopener noreferrer">#16800</a></li><li>Fixed an issue with window functions and partitioning <a href="https://github.com/apache/druid/pull/17141" target="_blank" rel="noopener noreferrer">#17141</a></li><li>Updated window functions to disallow multi-value dimensions for partitioning <a href="https://github.com/apache/druid/pull/17036" target="_blank" rel="noopener noreferrer">#17036</a></li><li>Fixed an issue with casting objects to vector expressions <a href="https://github.com/apache/druid/pull/17148" target="_blank" rel="noopener noreferrer">#17148</a></li><li>Added several fixes and improvements to vectorization fallback <a href="https://github.com/apache/druid/pull/17098" target="_blank" rel="noopener noreferrer">#17098</a>, <a href="https://github.com/apache/druid/pull/17162" target="_blank" rel="noopener noreferrer">#17162</a></li><li>You can now configure encoding method for sketches at query time <a href="https://github.com/apache/druid/pull/17086" target="_blank" rel="noopener noreferrer">#17086</a></li><li>Fixed an issue with joins failing to time out on Historicals <a href="https://github.com/apache/druid/pull/17099" target="_blank" rel="noopener noreferrer">#17099</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cluster-management">Cluster management<a href="#cluster-management" class="hash-link" aria-label="Direct link to Cluster management" title="Direct link to Cluster management">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="added-cluster-configuration-for-multivalue-handling">Added cluster configuration for multivalue handling<a href="#added-cluster-configuration-for-multivalue-handling" class="hash-link" aria-label="Direct link to Added cluster configuration for multivalue handling" title="Direct link to Added cluster configuration for multivalue handling">​</a></h4><p>Added an optional cluster configuration property <code>druid.indexing.formats.stringMultiValueHandlingMode</code> which overrides the default mode <code>SORTED_SET</code> used for string dimensions. Possible values are <code>SORTED_SET</code> (default), <code>SORTED_ARRAY</code>, <code>ARRAY</code>.</p><p>Note that we recommend you use array types instead of MVDs where possible. For more information, see <a href="https://druid.apache.org/docs/latest/release-info/migr-mvd-array" target="_blank" rel="noopener noreferrer">Migration guide: MVD to arrays</a>.</p><p><a href="https://github.com/apache/druid/pull/16822" target="_blank" rel="noopener noreferrer">#16822</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="api-for-cluster-level-compaction-configuration">API for cluster-level compaction configuration<a href="#api-for-cluster-level-compaction-configuration" class="hash-link" aria-label="Direct link to API for cluster-level compaction configuration" title="Direct link to API for cluster-level compaction configuration">​</a></h4><p>Druid now offers an API to update the cluster-level compaction dynamic configuration:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">POST /druid/coordinator/v1/config/compaction/cluster</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Example payload:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token property">&quot;compactionTaskSlotRatio&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token property">&quot;maxCompactionTaskSlots&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token property">&quot;engine&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;msq&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This API deprecates the older API <code>/druid/coordinator/v1/config/compaction/taskslots</code>.</p><p><a href="https://github.com/apache/druid/pull/16803" target="_blank" rel="noopener noreferrer">#16803</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="guardrail-for-task-payload-size">Guardrail for task payload size<a href="#guardrail-for-task-payload-size" class="hash-link" aria-label="Direct link to Guardrail for task payload size" title="Direct link to Guardrail for task payload size">​</a></h4><p>The <code>druid.indexer.queue.maxTaskPayloadSize</code> config defines the maximum size in bytes of a task payload accepted by the Overlord service. The default is 60 MB.</p><p><a href="https://github.com/apache/druid/pull/16512" target="_blank" rel="noopener noreferrer">#16512</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="improved-ux-for-coordinator-management">Improved UX for Coordinator management<a href="#improved-ux-for-coordinator-management" class="hash-link" aria-label="Direct link to Improved UX for Coordinator management" title="Direct link to Improved UX for Coordinator management">​</a></h4><p>Improve the user experience around Coordinator management as follows:</p><ul><li>Added an API <code>GET /druid/coordinator/v1/duties</code> that returns a status list of all duty groups currently running on the Coordinator</li><li>The Coordinator now emits the following metrics: <code>segment/poll/time</code>, <code>segment/pollWithSchema/time</code>, and <code>segment/buildSnapshot/time</code></li><li>Remove redundant logs that indicate normal operation of well-tested aspects of the Coordinator</li></ul><p><a href="https://github.com/apache/druid/pull/16959" target="_blank" rel="noopener noreferrer">#16959</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="other-cluster-management-improvements">Other cluster management improvements<a href="#other-cluster-management-improvements" class="hash-link" aria-label="Direct link to Other cluster management improvements" title="Direct link to Other cluster management improvements">​</a></h4><ul><li>The startup script for Docker-based deployments now specifies the node type <a href="https://github.com/apache/druid/pull/16282" target="_blank" rel="noopener noreferrer">#16282</a></li><li>The <code>druid.sh</code> script now uses the canonical hostname for <code>druid.host</code> by default. You can now set the following environment variable to use IP instead: <code>DRUID_SET_HOST_IP=1</code> <a href="https://github.com/apache/druid/pull/16386" target="_blank" rel="noopener noreferrer">#16386</a></li><li>Fixed an issue with tombstone segments incorrectly appearing unavailable in the Web Console <a href="https://github.com/apache/druid/pull/17025" target="_blank" rel="noopener noreferrer">#17025</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-management">Data management<a href="#data-management" class="hash-link" aria-label="Direct link to Data management" title="Direct link to Data management">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="compaction">Compaction<a href="#compaction" class="hash-link" aria-label="Direct link to Compaction" title="Direct link to Compaction">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="compaction-supervisors-experimental">Compaction supervisors (experimental)<a href="#compaction-supervisors-experimental" class="hash-link" aria-label="Direct link to Compaction supervisors (experimental)" title="Direct link to Compaction supervisors (experimental)">​</a></h5><p>You can now configure automatic compaction to run as a supervisor rather than as a Coordinator duty. Compaction supervisors provide the following benefits over Coordinator duties:</p><ul><li>Can use the supervisor framework to get information about the auto-compaction, such as status or state</li><li>More easily suspend or resume compaction for a datasource</li><li>Can use either the native compaction engine or the MSQ task engine</li><li>More reactive and submits tasks as soon as a compaction slot is available</li><li>Tracked compaction task status to avoid re-compacting an interval repeatedly</li></ul><p>You can submit your existing auto-compaction configs as part of the supervisor spec; the two auto-compaction options share the same syntax.</p><p>For more information, see <a href="https://druid.apache.org/docs/latest/data-management/automatic-compaction" target="_blank" rel="noopener noreferrer">Automatic compaction</a>.</p><p><a href="https://github.com/apache/druid/pull/16291" target="_blank" rel="noopener noreferrer">#16291</a> <a href="https://github.com/apache/druid/pull/16768" target="_blank" rel="noopener noreferrer">#16768</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="kill-tasks">Kill tasks<a href="#kill-tasks" class="hash-link" aria-label="Direct link to Kill tasks" title="Direct link to Kill tasks">​</a></h4><ul><li>The <code>KillUnusedSegments</code> coordinator duty now selects datasources in a round-robin manner during each run, ensuring varied selection instead of repeatedly choosing the same set of datasources <a href="https://github.com/apache/druid/pull/16719" target="_blank" rel="noopener noreferrer">#16719</a></li><li>Kill tasks can now use different types of locks, such as APPEND or REPLACE. This change is experimental and not recommended for production use <a href="https://github.com/apache/druid/pull/16362" target="_blank" rel="noopener noreferrer">#16362</a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="other-data-management-improvements">Other data management improvements<a href="#other-data-management-improvements" class="hash-link" aria-label="Direct link to Other data management improvements" title="Direct link to Other data management improvements">​</a></h4><ul><li>Improved the performance of the metadata query to fetch unused segments for a datasource returns results, which could cause issues with Overlord stability. Test queries that used to take over 30 seconds now complete in less than a second <a href="https://github.com/apache/druid/pull/16623" target="_blank" rel="noopener noreferrer">#16623</a></li><li>Fixed an issue in task bootstrapping that prevented tasks from accepting any segment assignments, including broadcast segments <a href="https://github.com/apache/druid/pull/16475" target="_blank" rel="noopener noreferrer">#16475</a></li><li>Improved the performance for writing segments <a href="https://github.com/apache/druid/pull/16698" target="_blank" rel="noopener noreferrer">#16698</a></li><li>Improved the logic so that unused segments and tombstones in the metadata cache don&#x27;t get needlessly refreshed <a href="https://github.com/apache/druid/pull/16990" target="_blank" rel="noopener noreferrer">#16990</a> <a href="https://github.com/apache/druid/pull/17025" target="_blank" rel="noopener noreferrer">17025</a></li><li>Improved how segments are fetched so that they can be reused <a href="https://github.com/apache/druid/pull/17021" target="_blank" rel="noopener noreferrer">#17021</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="storage-improvements-1">Storage improvements<a href="#storage-improvements-1" class="hash-link" aria-label="Direct link to Storage improvements" title="Direct link to Storage improvements">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="compression-for-complex-columns">Compression for complex columns<a href="#compression-for-complex-columns" class="hash-link" aria-label="Direct link to Compression for complex columns" title="Direct link to Compression for complex columns">​</a></h4><p>Compression is now available for all complex metric columns which don&#x27;t have specialized implementations. You can configure the <code>complexMetricCompression</code> IndexSpec option to any compression strategy (<code>lz4</code>, <code>zstd</code>, etc). The default is uncompressed. This works for most complex columns except <code>compressed-big-decimal</code> and columns stored by first/last aggregators.</p><p>Note that enabling compression is not backwards compatible with Druid versions older than 31. Only enable it after comprehensive testing to ensure no need for rollback.</p><p><a href="https://github.com/apache/druid/pull/16863" target="_blank" rel="noopener noreferrer">#16863</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="flexible-segment-sorting">Flexible segment sorting<a href="#flexible-segment-sorting" class="hash-link" aria-label="Direct link to Flexible segment sorting" title="Direct link to Flexible segment sorting">​</a></h4><p>Added the ability to sort segments by dimensions other than <code>__time</code> - this provides a significant storage benefit. Control the sorting method using the <code>segmentSortOrder</code> and <code>forceSegmentSortByTime</code> query context parameters. </p><p>This feature is not backwards compatible. Only enable it after comprehensive testing to ensure no need for rollback.</p><p>For more information, see <a href="https://druid.apache.org/docs/latest/multi-stage-query/reference/#context-parameters" target="_blank" rel="noopener noreferrer">Context parameters</a>.</p><p><a href="https://github.com/apache/druid/pull/16849" target="_blank" rel="noopener noreferrer">#16849</a>
<a href="https://github.com/apache/druid/pull/16958" target="_blank" rel="noopener noreferrer">#16958</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="apis">APIs<a href="#apis" class="hash-link" aria-label="Direct link to APIs" title="Direct link to APIs">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="new-api-for-exiting-streaming-task-groups-early">New API for exiting streaming task groups early<a href="#new-api-for-exiting-streaming-task-groups-early" class="hash-link" aria-label="Direct link to New API for exiting streaming task groups early" title="Direct link to New API for exiting streaming task groups early">​</a></h4><p>This new API does a best effort attempt to trigger the handoff for specified task groups of a supervisor early:</p><p><code>POST</code> <code>/druid/indexer/v1/supervisor/{supervisorId}/taskGroups/handoff</code></p><p><a href="https://github.com/apache/druid/pull/16310" target="_blank" rel="noopener noreferrer">#16310</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="api-to-fetch-conflicting-task-locks">API to fetch conflicting task locks<a href="#api-to-fetch-conflicting-task-locks" class="hash-link" aria-label="Direct link to API to fetch conflicting task locks" title="Direct link to API to fetch conflicting task locks">​</a></h4><p>You can use the new <code>/activeLocks</code> API to view task locks for the following attributes:</p><ul><li>Datasource</li><li>Priority</li><li>Interval list</li></ul><p>Use this API for debugging, to view lock contention, and to observe any concurrent locks.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="metrics-and-monitoring">Metrics and monitoring<a href="#metrics-and-monitoring" class="hash-link" aria-label="Direct link to Metrics and monitoring" title="Direct link to Metrics and monitoring">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="cgroup-usage">Cgroup usage<a href="#cgroup-usage" class="hash-link" aria-label="Direct link to Cgroup usage" title="Direct link to Cgroup usage">​</a></h4><p>The following Cgroup metrics are now available:</p><table><thead><tr><th>Metric</th><th>Description</th><th>Dimensions</th><th>Normal value</th></tr></thead><tbody><tr><td><code>cgroup/cpu/usage/total/percentage</code></td><td>Total cpu percentage used by cgroup of process that is running</td><td></td><td>0-100</td></tr><tr><td><code>cgroup/cpu/usage/user/percentage</code></td><td>User cpu percentage used by cgroup of process that is running</td><td></td><td>0-100</td></tr><tr><td><code>cgroup/cpu/usage/sys/percentage</code></td><td>Sys cpu percentage used by cgroup of process that is running</td><td></td><td>0-100</td></tr><tr><td><code>cgroup/disk/read/size</code></td><td>Reports the number of bytes transferred to specific devices by a cgroup of process that is running.</td><td><code>diskName</code></td><td>Varies</td></tr><tr><td><code>cgroup/disk/write/size</code></td><td>Reports the number of bytes transferred from specific devices by a cgroup of process that is running.</td><td><code>diskName</code></td><td>Varies</td></tr><tr><td><code>cgroup/disk/read/count</code></td><td>Reports the number of read operations performed on specific devices by a cgroup of process that is running.</td><td><code>diskName</code></td><td>Varies</td></tr><tr><td><code>cgroup/disk/write/count</code></td><td>Reports the number of write operations performed on specific devices by a cgroup of process that is running.</td><td><code>diskName</code></td><td>Varies</td></tr></tbody></table><p><a href="https://github.com/apache/druid/pull/16472" target="_blank" rel="noopener noreferrer">#16472</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="default-prometheus-metrics">Default Prometheus metrics<a href="#default-prometheus-metrics" class="hash-link" aria-label="Direct link to Default Prometheus metrics" title="Direct link to Default Prometheus metrics">​</a></h4><p>The default Prometheus metrics have been expanded to cover more of the available metrics for Druid.</p><p><a href="https://github.com/apache/druid/pull/16340" target="_blank" rel="noopener noreferrer">#16340</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="configurable-connection-timeouts">Configurable connection timeouts<a href="#configurable-connection-timeouts" class="hash-link" aria-label="Direct link to Configurable connection timeouts" title="Direct link to Configurable connection timeouts">​</a></h4><p>Added HTTP client property <code>clientConnectTimeout</code> to enable configuration of connection timeouts for Druid HTTP client requests.</p><p><a href="https://github.com/apache/druid/pull/16831" target="_blank" rel="noopener noreferrer">#16831</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="added-indexer-metrics">Added indexer metrics<a href="#added-indexer-metrics" class="hash-link" aria-label="Direct link to Added indexer metrics" title="Direct link to Added indexer metrics">​</a></h4><p>Added <code>indexer/task/failed/count</code> and <code>indexer/task/failed/count</code> metrics.</p><p><a href="https://github.com/apache/druid/pull/16829" target="_blank" rel="noopener noreferrer">#16829</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="added-subquery-metrics">Added subquery metrics<a href="#added-subquery-metrics" class="hash-link" aria-label="Direct link to Added subquery metrics" title="Direct link to Added subquery metrics">​</a></h4><p>Added <code>subquery/rows</code> and <code>subquery/bytes</code> metrics, which indicate the size of the results materialized on the heap.</p><p><a href="https://github.com/apache/druid/pull/16835" target="_blank" rel="noopener noreferrer">#16835</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="added-segment-loading-rate-metrics">Added segment loading rate metrics<a href="#added-segment-loading-rate-metrics" class="hash-link" aria-label="Direct link to Added segment loading rate metrics" title="Direct link to Added segment loading rate metrics">​</a></h4><p>Made the following changes to segment loading rate metrics:</p><ul><li>Added <code>LoadingRateTracker</code> which computes a moving average load rate based on
the last few GBs of successful segment loads.</li><li>Added <code>expectedLoadTimeMillis</code> to <code>/druid/coordinator/v1/loadQueue?simple</code> API response.</li><li>Updated the Coordinator to emit <code>segment/loading/rateKbps</code>.</li></ul><p><a href="https://github.com/apache/druid/pull/16691" target="_blank" rel="noopener noreferrer">#16691</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="extensions">Extensions<a href="#extensions" class="hash-link" aria-label="Direct link to Extensions" title="Direct link to Extensions">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="kubernetes-improvements">Kubernetes improvements<a href="#kubernetes-improvements" class="hash-link" aria-label="Direct link to Kubernetes improvements" title="Direct link to Kubernetes improvements">​</a></h4><p>When the fabric client is unable to communicate with the Kubernetes server, the shutdown logic now proceeds without populating the task status location, ensuring all data structures are cleaned up.</p><p><a href="https://github.com/apache/druid/pull/16711" target="_blank" rel="noopener noreferrer">#16711</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="pac4j-oidc-context"><code>pac4j</code> OIDC context<a href="#pac4j-oidc-context" class="hash-link" aria-label="Direct link to pac4j-oidc-context" title="Direct link to pac4j-oidc-context">​</a></h4><p>The <code>pac4j</code> extension now returns the OIDC context for <code>AuthenticationResult</code>.</p><p><a href="https://github.com/apache/druid/pull/16109" target="_blank" rel="noopener noreferrer">#16109</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="middle-manager-less-druid-improvements">Middle Manager-less Druid improvements<a href="#middle-manager-less-druid-improvements" class="hash-link" aria-label="Direct link to Middle Manager-less Druid improvements" title="Direct link to Middle Manager-less Druid improvements">​</a></h4><p>The Dynamic Pod Template Selection feature enhances the K8s extension by enabling more flexible and dynamic selection of pod templates based on task properties, which can optimize resource utilization and task execution efficiency.</p><p><a href="https://github.com/apache/druid/pull/16510" target="_blank" rel="noopener noreferrer">#16510</a></p><p>In MiddleManager-less ingestion, Druid adds the pod template name as an annotation to the created job or pod.</p><p><a href="https://github.com/apache/druid/pull/16772" target="_blank" rel="noopener noreferrer">#16772</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="improved-iceberg-input-source-support">Improved Iceberg input source support<a href="#improved-iceberg-input-source-support" class="hash-link" aria-label="Direct link to Improved Iceberg input source support" title="Direct link to Improved Iceberg input source support">​</a></h4><ul><li>You can now optionally use the <code>caseSensitive</code> Boolean config to configure how Druid reads column names from Iceberg. Iceberg table scans are case sensitive by default <a href="https://github.com/apache/druid/pull/16496" target="_blank" rel="noopener noreferrer">#16496</a></li><li>Added support to the <code>iceberg</code> input source to read from Iceberg REST catalogs <a href="https://github.com/apache/druid/pull/17124" target="_blank" rel="noopener noreferrer">#17124</a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="delta-lake-complex-types">Delta Lake complex types<a href="#delta-lake-complex-types" class="hash-link" aria-label="Direct link to Delta Lake complex types" title="Direct link to Delta Lake complex types">​</a></h4><p>Added support for delta structs, arrays, and maps to the <code>delta</code> input source. </p><p><a href="https://github.com/apache/druid/pull/16884" target="_blank" rel="noopener noreferrer">#16884</a> </p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="delta-lake-snapshot-versions">Delta Lake snapshot versions<a href="#delta-lake-snapshot-versions" class="hash-link" aria-label="Direct link to Delta Lake snapshot versions" title="Direct link to Delta Lake snapshot versions">​</a></h4><p>Added the ability to optionally specify a <code>snapshotVersion</code> in the delta input source payload to ingest versioned snapshots from a Delta Lake table. When not specified, Druid ingests the latest snapshot from the table. </p><p><a href="https://github.com/apache/druid/pull/17004" target="_blank" rel="noopener noreferrer">#17004</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="other-extensions-improvements">Other extensions improvements<a href="#other-extensions-improvements" class="hash-link" aria-label="Direct link to Other extensions improvements" title="Direct link to Other extensions improvements">​</a></h4><ul><li>Added an informational entry to the streaming supervisor log when task count is greater than the number of partitions <a href="https://github.com/apache/druid/pull/16948" target="_blank" rel="noopener noreferrer">#16948</a></li><li>Reduced logging in S3 output stream extension <a href="https://github.com/apache/druid/pull/16853" target="_blank" rel="noopener noreferrer">#16853</a></li><li>Reduced logging in basic security extension <a href="https://github.com/apache/druid/pull/16767" target="_blank" rel="noopener noreferrer">#16767</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="upgrade-notes-and-incompatible-changes">Upgrade notes and incompatible changes<a href="#upgrade-notes-and-incompatible-changes" class="hash-link" aria-label="Direct link to Upgrade notes and incompatible changes" title="Direct link to Upgrade notes and incompatible changes">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="upgrade-notes">Upgrade notes<a href="#upgrade-notes" class="hash-link" aria-label="Direct link to Upgrade notes" title="Direct link to Upgrade notes">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="array-ingest-mode-now-defaults-to-array">Array ingest mode now defaults to array<a href="#array-ingest-mode-now-defaults-to-array" class="hash-link" aria-label="Direct link to Array ingest mode now defaults to array" title="Direct link to Array ingest mode now defaults to array">​</a></h4><p>The SQL-based ingestion context flag <code>arrayIngestMode</code> now defaults to <code>array</code> instead of <code>mvd</code>. This means that SQL <code>VARCHAR ARRAY</code> types is no longer implicitly translated and stored in <code>VARCHAR</code> columns, but is instead stored as <code>VARCHAR ARRAY</code>. This change permits other array types such as <code>BIGINT ARRAY</code> and <code>DOUBLE ARRAY</code> to be inserted with MSQ into their respective array column types instead of failing as they do in <code>mvd</code> mode.</p><p>To continue to store multi-value strings, modify any insert/replace queries to wrap the array types with the <code>ARRAY_TO_MV</code> operator.</p><p>Validation is in place to prevent mixing <code>VARCHAR</code> and <code>VARCHAR ARRAY</code> columns in the same table, so any ingestions affected by this change will fail and provide a descriptive error message instead of exhibiting unexpected behavior.</p><p>The <code>arrayIngestMode</code> option of <code>none</code> has been removed. It was introduced prior to the table validation logic as a means for cluster operators to force query writers to explicitly set <code>array</code> or <code>mvd</code> on their query contexts but provides little utility in Druid 31.</p><p>See the following topics for more information:</p><ul><li><a href="https://druid.apache.org/docs/latest/querying/multi-value-dimensions#sql-based-ingestion" target="_blank" rel="noopener noreferrer">Ingest multi-value dimensions</a> for how to ingest multi-value strings.</li><li><a href="https://druid.apache.org/docs/latest/querying/arrays#sql-based-ingestion" target="_blank" rel="noopener noreferrer">Ingest arrays</a> for ingesting arrays.</li></ul><p><a href="https://github.com/apache/druid/pull/16789" target="_blank" rel="noopener noreferrer">#16789</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="removed-task-action-audit-logging">Removed task action audit logging<a href="#removed-task-action-audit-logging" class="hash-link" aria-label="Direct link to Removed task action audit logging" title="Direct link to Removed task action audit logging">​</a></h4><p>The deprecated task action audit logging has been removed. This change includes the following updates:</p><ul><li>The endpoint <code>/indexer/v1/task/{taskId}/segments</code> is no longer supported.</li><li>Druid doesn&#x27;t write to or read from the metadata table <code>druid_taskLog</code>.</li><li>Druid ignores the property <code>druid.indexer.auditlog.enabled</code>.</li><li>Druid doesn&#x27;t emit the metric <code>task/action/log/time</code>.</li></ul><p>These changes are backward compatible with all existing metadata storage extensions.</p><p><a href="https://github.com/apache/druid/pull/16309" target="_blank" rel="noopener noreferrer">#16309</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="removed-firehose-and-firehosefactory">Removed Firehose and FirehoseFactory<a href="#removed-firehose-and-firehosefactory" class="hash-link" aria-label="Direct link to Removed Firehose and FirehoseFactory" title="Direct link to Removed Firehose and FirehoseFactory">​</a></h4><p>Removed Firehose and FirehoseFactory and remaining implementations.
Apache deprecated support for Druid firehoses in version 0.17. Support for firehose ingestion was removed in version 26.0.</p><p><a href="https://github.com/apache/druid/pull/16758" target="_blank" rel="noopener noreferrer">#16758</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="front-coded-dictionaries">Front-coded dictionaries<a href="#front-coded-dictionaries" class="hash-link" aria-label="Direct link to Front-coded dictionaries" title="Direct link to Front-coded dictionaries">​</a></h4><p>In Druid 32.0.0, the front coded dictionaries feature will be turned on by default. Front-coded dictionaries reduce storage and improve performance by optimizing for strings where the front part looks similar.</p><p>Once this feature is on, you cannot easily downgrade to an earlier version that does not support the feature. </p><p>For more information, see <a href="https://druid.apache.org/docs/latest/release-info/migr-front-coded-dict" target="_blank" rel="noopener noreferrer">Migration guide: front-coded dictionaries</a>.</p><p>If you&#x27;re already using this feature, you don&#x27;t need to take any action. </p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="storage-improvement-features">Storage improvement features<a href="#storage-improvement-features" class="hash-link" aria-label="Direct link to Storage improvement features" title="Direct link to Storage improvement features">​</a></h4><p>Druid 31.0.0 includes storage improvements that are not backwards compatible. Once you enable <a href="#flexible-segment-sorting">flexible segment sorting</a> or <a href="#compression-for-complex-columns">compression for complex columns</a>, you cannot downgrade to a release earlier than 31.0.0. Thoroughly test these features before rolling them out to your production cluster.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="incompatible-changes">Incompatible changes<a href="#incompatible-changes" class="hash-link" aria-label="Direct link to Incompatible changes" title="Direct link to Incompatible changes">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="removed-the-scan-query-legacy-mode">Removed the scan query legacy mode<a href="#removed-the-scan-query-legacy-mode" class="hash-link" aria-label="Direct link to Removed the scan query legacy mode" title="Direct link to Removed the scan query legacy mode">​</a></h4><p>The native scan query legacy mode has been removed. It was introduced in Druid 0.11 to maintain compatibility during an upgrade from older versions of Druid where the scan query was part of a <code>contrib</code> extension.</p><p><a href="https://github.com/apache/druid/pull/16659" target="_blank" rel="noopener noreferrer">#16659</a></p><p>Hard-coded <code>&quot;legacy&quot;:false</code> following removal of the legacy mode to prevent error during rolling upgrades or downgrades.</p><p><a href="https://github.com/apache/druid/pull/16793" target="_blank" rel="noopener noreferrer">#16793</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="zk-based-segment-loading">ZK-based segment loading<a href="#zk-based-segment-loading" class="hash-link" aria-label="Direct link to ZK-based segment loading" title="Direct link to ZK-based segment loading">​</a></h4><p>ZK-based segment loading is now disabled. ZK <code>servedSegmentsPath</code> was deprecated in Druid 0.7.1. This legacy path has been replaced by <code>liveSegmentsPath</code>.</p><p>Segment-serving processes such as Peons, Historicals and Indexers no longer create ZK <code>loadQueuePath</code> entries. The <code>druid.zk.paths.loadQueuePath</code> and <code>druid.zk.paths.servedSegmentsPath</code> properties are no longer used.</p><p><strong>Move to HTTP-based segment loading first and then perform the version upgrade.</strong></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="developer-notes">Developer notes<a href="#developer-notes" class="hash-link" aria-label="Direct link to Developer notes" title="Direct link to Developer notes">​</a></h3><ul><li>Fixed the <code>hibernate-validator</code> warning displayed during maven build <a href="https://github.com/apache/druid/pull/16746" target="_blank" rel="noopener noreferrer">#16746</a></li><li>Replaced the <code>StorageAdapter</code> interface with the <code>CursorHolder</code> interface <a href="https://github.com/apache/druid/pull/17024" target="_blank" rel="noopener noreferrer">#17024</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="storageadapter-changes"><code>StorageAdapter</code> changes<a href="#storageadapter-changes" class="hash-link" aria-label="Direct link to storageadapter-changes" title="Direct link to storageadapter-changes">​</a></h3><p>If you write custom extensions, specifically query engines or anything else involving the <code>StorageAdapter</code> interface, 31.0.0 includes changes to low-level APIs that may impact you. All methods on <code>StorageAdapter</code> now throw a Druid exception.</p><p>Prepare for these changes before upgrading to 31.0.0 or later. For more information, see the following pull requests:</p><ul><li><a href="https://github.com/apache/druid/pull/16985" target="_blank" rel="noopener noreferrer">#16985</a></li><li><a href="https://github.com/apache/druid/pull/16849" target="_blank" rel="noopener noreferrer">#16849</a></li><li><a href="https://github.com/apache/druid/pull/16533" target="_blank" rel="noopener noreferrer">#16533</a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="dependency-updates">Dependency updates<a href="#dependency-updates" class="hash-link" aria-label="Direct link to Dependency updates" title="Direct link to Dependency updates">​</a></h4><p>Bumped the versions of the following dependencies:</p><ul><li>Apache Avro to 1.11.4 <a href="https://github.com/apache/druid/pull/17230" target="_blank" rel="noopener noreferrer">#17230</a></li><li>Apache Calcite to 1.37.0 <a href="https://github.com/apache/druid/pull/16621" target="_blank" rel="noopener noreferrer">#16621</a></li><li>Delta Kernel from 3.1.0 to 3.2.1 <a href="https://github.com/apache/druid/pull/16513" target="_blank" rel="noopener noreferrer">#16513</a> <a href="https://github.com/apache/druid/pull/17179" target="_blank" rel="noopener noreferrer">#17179</a></li><li>MySQL Java connector to 8.2.0 <a href="https://github.com/apache/druid/pull/16024" target="_blank" rel="noopener noreferrer">#16024</a></li><li>OpenRewrite maven plugin from 5.27.0 to 5.31.0  <a href="https://github.com/apache/druid/pull/16477" target="_blank" rel="noopener noreferrer">#16477</a></li><li>Scala library from 2.13.11 to 2.13.14 <a href="https://github.com/apache/druid/pull/16364" target="_blank" rel="noopener noreferrer">#16364</a></li><li>Apache Curator reverted to 5.3.0 from 5.5.0 <a href="https://github.com/apache/druid/pull/16688" target="_blank" rel="noopener noreferrer">#16688</a></li><li>Updated Blueprint dependencies from v4 to v5 in web console <a href="https://github.com/apache/druid/pull/16756" target="_blank" rel="noopener noreferrer">#16756</a></li><li><code>io.grpc:grpc-netty-shaded</code> from 1.57.2 to 1.65.1 <a href="https://github.com/apache/druid/pull/16731" target="_blank" rel="noopener noreferrer">#16731</a></li><li><code>jclouds.version</code> from 2.5.0 to 2.6.0 <a href="https://github.com/apache/druid/pull/16796" target="_blank" rel="noopener noreferrer">#16796</a></li><li>Axios to 1.7.4 <a href="https://github.com/apache/druid/pull/16898" target="_blank" rel="noopener noreferrer">#16898</a></li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/31.0.0/development/experimental"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Experimental features</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/31.0.0/release-info/upgrade-notes"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Upgrade notes</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#important-features-changes-and-deprecations" class="table-of-contents__link toc-highlight">Important features, changes, and deprecations</a><ul><li><a href="#compaction-features" class="table-of-contents__link toc-highlight">Compaction features</a></li><li><a href="#window-functions-are-ga" class="table-of-contents__link toc-highlight">Window functions are GA</a></li><li><a href="#concurrent-append-and-replace-ga" class="table-of-contents__link toc-highlight">Concurrent append and replace GA</a></li><li><a href="#delta-lake-improvements" class="table-of-contents__link toc-highlight">Delta Lake improvements</a></li><li><a href="#iceberg-improvements" class="table-of-contents__link toc-highlight">Iceberg improvements</a></li><li><a href="#projections-experimental" class="table-of-contents__link toc-highlight">Projections (experimental)</a></li><li><a href="#low-latency-high-complexity-queries-using-dart-experimental" class="table-of-contents__link toc-highlight">Low latency high complexity queries using Dart (experimental)</a></li><li><a href="#storage-improvements" class="table-of-contents__link toc-highlight">Storage improvements</a></li><li><a href="#upgrade-related-changes" class="table-of-contents__link toc-highlight">Upgrade-related changes</a></li><li><a href="#deprecations" class="table-of-contents__link toc-highlight">Deprecations</a></li></ul></li><li><a href="#functional-areas-and-related-changes" class="table-of-contents__link toc-highlight">Functional areas and related changes</a><ul><li><a href="#web-console" class="table-of-contents__link toc-highlight">Web console</a></li><li><a href="#ingestion" class="table-of-contents__link toc-highlight">Ingestion</a></li><li><a href="#streaming-ingestion" class="table-of-contents__link toc-highlight">Streaming ingestion</a></li><li><a href="#querying" class="table-of-contents__link toc-highlight">Querying</a></li><li><a href="#cluster-management" class="table-of-contents__link toc-highlight">Cluster management</a></li><li><a href="#data-management" class="table-of-contents__link toc-highlight">Data management</a></li><li><a href="#storage-improvements-1" class="table-of-contents__link toc-highlight">Storage improvements</a></li><li><a href="#apis" class="table-of-contents__link toc-highlight">APIs</a></li><li><a href="#metrics-and-monitoring" class="table-of-contents__link toc-highlight">Metrics and monitoring</a></li><li><a href="#extensions" class="table-of-contents__link toc-highlight">Extensions</a></li></ul></li><li><a href="#upgrade-notes-and-incompatible-changes" class="table-of-contents__link toc-highlight">Upgrade notes and incompatible changes</a><ul><li><a href="#upgrade-notes" class="table-of-contents__link toc-highlight">Upgrade notes</a></li><li><a href="#incompatible-changes" class="table-of-contents__link toc-highlight">Incompatible changes</a></li><li><a href="#developer-notes" class="table-of-contents__link toc-highlight">Developer notes</a></li><li><a href="#storageadapter-changes" class="table-of-contents__link toc-highlight"><code>StorageAdapter</code> changes</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/img/favicon.png" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/img/favicon.png" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></div><div class="footer__copyright">Copyright © 2023 Apache Software Foundation. Except where otherwise noted, licensed under CC BY-SA 4.0. Apache Druid, Druid, and the Druid logo are either registered trademarks or trademarks of The Apache Software Foundation in the United States and other countries.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.2c2acc8f.js"></script>
<script src="/assets/js/main.f8032a27.js"></script>
</body>
</html>