"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3336],{6959:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>t,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"operations/java","title":"Java runtime","description":"\x3c!--","source":"@site/docs/33.0.0/operations/java.md","sourceDirName":"operations","slug":"/operations/java","permalink":"/docs/33.0.0/operations/java","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"java","title":"Java runtime"},"sidebar":"docs","previous":{"title":"Web console","permalink":"/docs/33.0.0/operations/web-console"},"next":{"title":"Durable storage","permalink":"/docs/33.0.0/operations/durable-storage"}}');var r=a(74848),s=a(28453);const t={id:"java",title:"Java runtime"},o=void 0,d={},l=[{value:"Selecting a Java runtime",id:"selecting-a-java-runtime",level:2},{value:"Garbage collection",id:"garbage-collection",level:2},{value:"Strong encapsulation",id:"strong-encapsulation",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Apache Druid is written in Java and requires a Java runtime. This page provides details about obtaining and configuring\na Java runtime for Druid."}),"\n",(0,r.jsx)(n.h2,{id:"selecting-a-java-runtime",children:"Selecting a Java runtime"}),"\n",(0,r.jsx)(n.p,{children:"Druid fully supports Java 11 and Java 17. The project team recommends Java 17."}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"Note: Starting with Apache Druid 32.0.0, support for Java 8 has been removed."})}),"\n",(0,r.jsxs)(n.p,{children:["The project team recommends using an OpenJDK-based Java distribution. There are many free and actively-supported\ndistributions available, including\n",(0,r.jsx)(n.a,{href:"https://docs.aws.amazon.com/corretto/latest/corretto-17-ug/what-is-corretto-17.html",children:"Amazon Corretto"}),",\n",(0,r.jsx)(n.a,{href:"https://www.azul.com/downloads/?version=java-17-lts&package=jdk",children:"Azul Zulu"}),", and\n",(0,r.jsx)(n.a,{href:"https://adoptium.net/temurin/releases?version=17",children:"Eclipse Temurin"}),".\nThe project team does not recommend any specific distribution over any other."]}),"\n",(0,r.jsxs)(n.p,{children:["Druid relies on the environment variables ",(0,r.jsx)(n.code,{children:"JAVA_HOME"})," or ",(0,r.jsx)(n.code,{children:"DRUID_JAVA_HOME"})," to find Java on the machine. You can set\n",(0,r.jsx)(n.code,{children:"DRUID_JAVA_HOME"})," if there is more than one instance of Java. To verify Java requirements for your environment, run the\n",(0,r.jsx)(n.code,{children:"bin/verify-java"})," script."]}),"\n",(0,r.jsx)(n.h2,{id:"garbage-collection",children:"Garbage collection"}),"\n",(0,r.jsx)(n.p,{children:"In general, the project team recommends using the G1 collector with default settings. This is the default collector in\nJava 11 and 17."}),"\n",(0,r.jsx)(n.p,{children:"Garbage collector selection and tuning is a form of sport in the Java community. There may be situations where adjusting\ngarbage collection configuration improves or worsens performance. The project team's guidance is that most people do\nnot need to stray away from G1 with default settings."}),"\n",(0,r.jsx)(n.h2,{id:"strong-encapsulation",children:"Strong encapsulation"}),"\n",(0,r.jsxs)(n.p,{children:["Java 9 and beyond (including Java 11 and 17) include the capability for\n",(0,r.jsx)(n.a,{href:"https://dev.java/learn/strong-encapsulation-(of-jdk-internals)/",children:"strong encapsulation"})," of internal JDK APIs. Druid\nuses certain internal JDK APIs, which must be added to ",(0,r.jsx)(n.code,{children:"--add-exports"})," and ",(0,r.jsx)(n.code,{children:"--add-opens"})," on the Java command line."]}),"\n",(0,r.jsx)(n.p,{children:"On Java 11, if these parameters are not included, you will see warnings like the following:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"WARNING: An illegal reflective access operation has occurred\nWARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations\nWARNING: All illegal access operations will be denied in a future release\n"})}),"\n",(0,r.jsx)(n.p,{children:"On Java 17, if these parameters are not included, you will see errors on startup like the following:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'Exception in thread "main" java.lang.ExceptionInInitializerError\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Druid's out-of-box configuration adds these parameters transparently when you use the bundled ",(0,r.jsx)(n.code,{children:"bin/start-druid"})," or\nsimilar commands. In this case, there is nothing special you need to do to run successfully on Java 11 or 17. However,\nif you have customized your Druid service launching system, you will need to ensure the required Java parameters are\nadded. There are many ways of doing this. Choose the one that works best for you."]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["The simplest approach: use Druid's bundled ",(0,r.jsx)(n.code,{children:"bin/start-druid"})," script to launch Druid."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["If you launch Druid using ",(0,r.jsx)(n.code,{children:"bin/supervise -c <config>"}),", ensure your config file uses ",(0,r.jsx)(n.code,{children:"bin/run-druid"}),". This\nscript uses ",(0,r.jsx)(n.code,{children:"bin/run-java"})," internally, and automatically adds the proper flags."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["If you launch Druid using a ",(0,r.jsx)(n.code,{children:"java"})," command, replace ",(0,r.jsx)(n.code,{children:"java"})," with ",(0,r.jsx)(n.code,{children:"bin/run-java"}),". Druid's bundled\n",(0,r.jsx)(n.code,{children:"bin/run-java"})," script automatically adds the proper flags."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"If you launch Druid without using its bundled scripts, ensure the following parameters are added to your Java\ncommand line:"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"--add-exports=java.base/jdk.internal.misc=ALL-UNNAMED \\\n--add-exports=java.base/jdk.internal.ref=ALL-UNNAMED \\\n--add-opens=java.base/java.nio=ALL-UNNAMED \\\n--add-opens=java.base/sun.nio.ch=ALL-UNNAMED \\\n--add-opens=java.base/jdk.internal.ref=ALL-UNNAMED \\\n--add-opens=java.base/java.io=ALL-UNNAMED \\\n--add-opens=java.base/java.lang=ALL-UNNAMED \\\n--add-opens=jdk.management/com.sun.management.internal=ALL-UNNAMED\n"})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},28453:(e,n,a)=>{a.d(n,{R:()=>t,x:()=>o});var i=a(96540);const r={},s=i.createContext(r);function t(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);