"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[662],{28453:(e,n,o)=>{o.d(n,{R:()=>s,x:()=>l});var t=o(96540);const r={},i=t.createContext(r);function s(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(i.Provider,{value:n},e.children)}},89088:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>g,frontMatter:()=>s,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"configuration/logging","title":"Logging","description":"\x3c!--","source":"@site/docs/latest/configuration/logging.md","sourceDirName":"configuration","slug":"/configuration/logging","permalink":"/docs/latest/configuration/logging","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"logging","title":"Logging"},"sidebar":"docs","previous":{"title":"Extensions","permalink":"/docs/latest/configuration/extensions"},"next":{"title":"Automatic compaction","permalink":"/docs/latest/api-reference/automatic-compaction-api"}}');var r=o(74848),i=o(28453);const s={id:"logging",title:"Logging"},l=void 0,a={},d=[{value:"Log directory",id:"log-directory",level:2},{value:"All-in-one start commands",id:"all-in-one-start-commands",level:2},{value:"Set the logs to asynchronously write",id:"set-the-logs-to-asynchronously-write",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["Apache Druid services emit logs that to help you debug.\nThe same services also emit periodic ",(0,r.jsx)(n.a,{href:"/docs/latest/configuration/#enabling-metrics",children:"metrics"})," about their state.\nTo disable metric info logs set the following runtime property: ",(0,r.jsx)(n.code,{children:"-Ddruid.emitter.logging.logLevel=debug"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Druid uses ",(0,r.jsx)(n.a,{href:"http://logging.apache.org/log4j/2.x/",children:"log4j2"})," for logging.\nThe default configuration file log4j2.xml ships with Druid at the following path: ",(0,r.jsx)(n.code,{children:"conf/druid/{config}/_common/log4j2.xml"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["By default, Druid uses ",(0,r.jsx)(n.code,{children:"RollingRandomAccessFile"})," for rollover daily, and keeps log files up to 7 days.\nIf that's not suitable in your case, modify the ",(0,r.jsx)(n.code,{children:"log4j2.xml"})," accordingly."]}),"\n",(0,r.jsx)(n.p,{children:"The following example log4j2.xml is based upon the micro quickstart:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'<?xml version="1.0" encoding="UTF-8" ?>\n<Configuration status="WARN">\n  <Properties>\n    \x3c!-- to change log directory, set DRUID_LOG_DIR environment variable to your directory before launching Druid --\x3e\n    <Property name="druid.log.path" value="log" />\n  </Properties>\n\n  <Appenders>\n    <Console name="Console" target="SYSTEM_OUT">\n      <PatternLayout pattern="%d{ISO8601} %p [%t] %c -%notEmpty{ [%markerSimpleName]} %m%n"/>\n    </Console>\n\n    \x3c!-- Rolling Files--\x3e\n    <RollingRandomAccessFile name="FileAppender"\n                             fileName="${sys:druid.log.path}/${sys:druid.node.type}.log"\n                             filePattern="${sys:druid.log.path}/${sys:druid.node.type}.%d{yyyyMMdd}.log">\n      <PatternLayout pattern="%d{ISO8601} %p [%t] %c -%notEmpty{ [%markerSimpleName]} %m%n"/>\n      <Policies>\n        <TimeBasedTriggeringPolicy interval="1" modulate="true"/>\n      </Policies>\n      <DefaultRolloverStrategy>\n        <Delete basePath="${sys:druid.log.path}/" maxDepth="1">\n          <IfFileName glob="*.log" />\n          <IfLastModified age="7d" />\n        </Delete>\n      </DefaultRolloverStrategy>\n    </RollingRandomAccessFile>\n\n  </Appenders>\n\n  <Loggers>\n    <Root level="info">\n      <AppenderRef ref="FileAppender"/>\n    </Root>\n\n    \x3c!-- Set level="debug" to see stack traces for query errors --\x3e\n    <Logger name="org.apache.druid.server.QueryResource" level="info" additivity="false">\n      <Appender-ref ref="FileAppender"/>\n    </Logger>\n    <Logger name="org.apache.druid.server.QueryLifecycle" level="info" additivity="false">\n      <Appender-ref ref="FileAppender"/>\n    </Logger>\n\n    \x3c!-- Set level="debug" or "trace" to see more Coordinator details (segment balancing, load/drop rules, etc) --\x3e\n    <Logger name="org.apache.druid.server.coordinator" level="info" additivity="false">\n      <Appender-ref ref="FileAppender"/>\n    </Logger>\n\n    \x3c!-- Set level="debug" to see low-level details about segments and ingestion --\x3e\n    <Logger name="org.apache.druid.segment" level="info" additivity="false">\n      <Appender-ref ref="FileAppender"/>\n    </Logger>\n\n    \x3c!-- Set level="debug" to see more information about extension initialization --\x3e\n    <Logger name="org.apache.druid.initialization" level="info" additivity="false">\n      <Appender-ref ref="FileAppender"/>\n    </Logger>\n\n    \x3c!-- Quieter logging at startup --\x3e\n    <Logger name="com.sun.jersey.guice" level="warn" additivity="false">\n      <Appender-ref ref="FileAppender"/>\n    </Logger>\n  </Loggers>\n</Configuration>\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Peons always output logs to standard output. Middle Managers redirect task logs from standard output to\n",(0,r.jsx)(n.a,{href:"/docs/latest/configuration/#log-long-term-storage",children:"long-term storage"}),"."]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["NOTE:\nDruid shares the log4j configuration file among all services, including task peon processes.\nHowever, you must define a console appender in the logger for your peon processes.\nIf you don't define a console appender, Druid creates and configures a new console appender\nthat retains the log level, such as ",(0,r.jsx)(n.code,{children:"info"})," or ",(0,r.jsx)(n.code,{children:"warn"}),", but does not retain any other appender\nconfiguration, including non-console ones."]})}),"\n",(0,r.jsx)(n.h2,{id:"log-directory",children:"Log directory"}),"\n",(0,r.jsxs)(n.p,{children:["The included log4j2.xml configuration for Druid and ZooKeeper writes logs to the ",(0,r.jsx)(n.code,{children:"log"})," directory at the root of the distribution."]}),"\n",(0,r.jsxs)(n.p,{children:["If you want to change the log directory, set the environment variable ",(0,r.jsx)(n.code,{children:"DRUID_LOG_DIR"})," to the right directory before you start Druid."]}),"\n",(0,r.jsx)(n.h2,{id:"all-in-one-start-commands",children:"All-in-one start commands"}),"\n",(0,r.jsxs)(n.p,{children:["If you use one of the all-in-one start commands, such as ",(0,r.jsx)(n.code,{children:"bin/start-micro-quickstart"}),", the default configuration for each service has two kinds of log files.\nLog4j2 writes the main log file and rotates it periodically.\nFor example, ",(0,r.jsx)(n.code,{children:"log/historical.log"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["The secondary log file contains anything that is written by the component\ndirectly to standard output or standard error without going through log4j2.\nFor example, ",(0,r.jsx)(n.code,{children:"log/historical.stdout.log"}),".\nThis consists mainly of messages from the\nJava runtime itself.\nThis file is not rotated, but it is generally small due to the low volume of messages.\nIf necessary, you can truncate it using the Linux command ",(0,r.jsx)(n.code,{children:"truncate --size 0 log/historical.stdout.log"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"set-the-logs-to-asynchronously-write",children:"Set the logs to asynchronously write"}),"\n",(0,r.jsxs)(n.p,{children:["If your logs are really chatty, you can set them to write asynchronously.\nThe following example shows a ",(0,r.jsx)(n.code,{children:"log4j2.xml"})," that configures some of the more chatty classes to write asynchronously:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'<?xml version="1.0" encoding="UTF-8" ?>\n<Configuration status="WARN">\n  <Appenders>\n    <Console name="Console" target="SYSTEM_OUT">\n      <PatternLayout pattern="%d{ISO8601} %p [%t] %c -%notEmpty{ [%markerSimpleName]} %m%n"/>\n    </Console>\n  </Appenders>\n  \n<Loggers>\n    \x3c!-- AsyncLogger instead of Logger --\x3e\n    <AsyncLogger name="org.apache.druid.curator.inventory.CuratorInventoryManager" level="debug" additivity="false">\n      <AppenderRef ref="Console"/>\n    </AsyncLogger>\n    <AsyncLogger name="org.apache.druid.client.BatchServerInventoryView" level="debug" additivity="false">\n      <AppenderRef ref="Console"/>\n    </AsyncLogger>\n    \x3c!-- Make extra sure nobody adds logs in a bad way that can hurt performance --\x3e\n    <AsyncLogger name="org.apache.druid.client.ServerInventoryView" level="debug" additivity="false">\n      <AppenderRef ref="Console"/>\n    </AsyncLogger>\n    <AsyncLogger name ="org.apache.druid.java.util.http.client.pool.ChannelResourceFactory" level="info" additivity="false">\n      <AppenderRef ref="Console"/>\n    </AsyncLogger>\n    <Root level="info">\n      <AppenderRef ref="Console"/>\n    </Root>\n  </Loggers>\n</Configuration>\n'})})]})}function g(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);