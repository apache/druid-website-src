"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3705],{15680:(e,r,a)=>{a.d(r,{xA:()=>p,yg:()=>m});var n=a(96540);function t(e,r,a){return r in e?Object.defineProperty(e,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[r]=a,e}function l(e,r){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?l(Object(a),!0).forEach((function(r){t(e,r,a[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(a,r))}))}return e}function i(e,r){if(null==e)return{};var a,n,t=function(e,r){if(null==e)return{};var a,n,t={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],r.indexOf(a)>=0||(t[a]=e[a]);return t}(e,r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],r.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(t[a]=e[a])}return t}var u=n.createContext({}),s=function(e){var r=n.useContext(u),a=r;return e&&(a="function"==typeof e?e(r):o(o({},r),e)),a},p=function(e){var r=s(e.components);return n.createElement(u.Provider,{value:r},e.children)},d="mdxType",y={inlineCode:"code",wrapper:function(e){var r=e.children;return n.createElement(n.Fragment,{},r)}},c=n.forwardRef((function(e,r){var a=e.components,t=e.mdxType,l=e.originalType,u=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=s(a),c=t,m=d["".concat(u,".").concat(c)]||d[c]||y[c]||l;return a?n.createElement(m,o(o({ref:r},p),{},{components:a})):n.createElement(m,o({ref:r},p))}));function m(e,r){var a=arguments,t=r&&r.mdxType;if("string"==typeof e||t){var l=a.length,o=new Array(l);o[0]=c;var i={};for(var u in r)hasOwnProperty.call(r,u)&&(i[u]=r[u]);i.originalType=e,i[d]="string"==typeof e?e:t,o[1]=i;for(var s=2;s<l;s++)o[s]=a[s];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},19365:(e,r,a)=>{a.d(r,{A:()=>o});var n=a(96540),t=a(20053);const l={tabItem:"tabItem_Ymn6"};function o(e){var r=e.children,a=e.hidden,o=e.className;return n.createElement("div",{role:"tabpanel",className:(0,t.A)(l.tabItem,o),hidden:a},r)}},11470:(e,r,a)=>{a.d(r,{A:()=>N});var n=a(58168),t=a(96540),l=a(20053),o=a(23104),i=a(56347),u=a(57485),s=a(31682),p=a(89466);function d(e){return function(e){var r,a;return null!=(r=null==(a=t.Children.map(e,(function(e){if(!e||(0,t.isValidElement)(e)&&(r=e.props)&&"object"==typeof r&&"value"in r)return e;var r;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:a.filter(Boolean))?r:[]}(e).map((function(e){var r=e.props;return{value:r.value,label:r.label,attributes:r.attributes,default:r.default}}))}function y(e){var r=e.values,a=e.children;return(0,t.useMemo)((function(){var e=null!=r?r:d(a);return function(e){var r=(0,s.X)(e,(function(e,r){return e.value===r.value}));if(r.length>0)throw new Error('Docusaurus error: Duplicate values "'+r.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[r,a])}function c(e){var r=e.value;return e.tabValues.some((function(e){return e.value===r}))}function m(e){var r=e.queryString,a=void 0!==r&&r,n=e.groupId,l=(0,i.W6)(),o=function(e){var r=e.queryString,a=void 0!==r&&r,n=e.groupId;if("string"==typeof a)return a;if(!1===a)return null;if(!0===a&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=n?n:null}({queryString:a,groupId:n});return[(0,u.aZ)(o),(0,t.useCallback)((function(e){if(o){var r=new URLSearchParams(l.location.search);r.set(o,e),l.replace(Object.assign({},l.location,{search:r.toString()}))}}),[o,l])]}function g(e){var r,a,n,l,o=e.defaultValue,i=e.queryString,u=void 0!==i&&i,s=e.groupId,d=y(e),g=(0,t.useState)((function(){return function(e){var r,a=e.defaultValue,n=e.tabValues;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(a){if(!c({value:a,tabValues:n}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+a+'" but none of its children has the corresponding value. Available values are: '+n.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return a}var t=null!=(r=n.find((function(e){return e.default})))?r:n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:o,tabValues:d})})),f=g[0],v=g[1],h=m({queryString:u,groupId:s}),T=h[0],b=h[1],N=(r=function(e){return e?"docusaurus.tab."+e:null}({groupId:s}.groupId),a=(0,p.Dv)(r),n=a[0],l=a[1],[n,(0,t.useCallback)((function(e){r&&l.set(e)}),[r,l])]),R=N[0],I=N[1],O=function(){var e=null!=T?T:R;return c({value:e,tabValues:d})?e:null}();return(0,t.useLayoutEffect)((function(){O&&v(O)}),[O]),{selectedValue:f,selectValue:(0,t.useCallback)((function(e){if(!c({value:e,tabValues:d}))throw new Error("Can't select invalid tab value="+e);v(e),b(e),I(e)}),[b,I,d]),tabValues:d}}var f=a(92303);const v={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function h(e){var r=e.className,a=e.block,i=e.selectedValue,u=e.selectValue,s=e.tabValues,p=[],d=(0,o.a_)().blockElementScrollPositionUntilNextRender,y=function(e){var r=e.currentTarget,a=p.indexOf(r),n=s[a].value;n!==i&&(d(r),u(n))},c=function(e){var r,a=null;switch(e.key){case"Enter":y(e);break;case"ArrowRight":var n,t=p.indexOf(e.currentTarget)+1;a=null!=(n=p[t])?n:p[0];break;case"ArrowLeft":var l,o=p.indexOf(e.currentTarget)-1;a=null!=(l=p[o])?l:p[p.length-1]}null==(r=a)||r.focus()};return t.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.A)("tabs",{"tabs--block":a},r)},s.map((function(e){var r=e.value,a=e.label,o=e.attributes;return t.createElement("li",(0,n.A)({role:"tab",tabIndex:i===r?0:-1,"aria-selected":i===r,key:r,ref:function(e){return p.push(e)},onKeyDown:c,onClick:y},o,{className:(0,l.A)("tabs__item",v.tabItem,null==o?void 0:o.className,{"tabs__item--active":i===r})}),null!=a?a:r)})))}function T(e){var r=e.lazy,a=e.children,n=e.selectedValue,l=(Array.isArray(a)?a:[a]).filter(Boolean);if(r){var o=l.find((function(e){return e.props.value===n}));return o?(0,t.cloneElement)(o,{className:"margin-top--md"}):null}return t.createElement("div",{className:"margin-top--md"},l.map((function(e,r){return(0,t.cloneElement)(e,{key:r,hidden:e.props.value!==n})})))}function b(e){var r=g(e);return t.createElement("div",{className:(0,l.A)("tabs-container",v.tabList)},t.createElement(h,(0,n.A)({},e,r)),t.createElement(T,(0,n.A)({},e,r)))}function N(e){var r=(0,f.A)();return t.createElement(b,(0,n.A)({key:String(r)},e))}},25312:(e,r,a)=>{a.r(r),a.d(r,{assets:()=>y,contentTitle:()=>p,default:()=>f,frontMatter:()=>s,metadata:()=>d,toc:()=>c});var n=a(58168),t=a(98587),l=(a(96540),a(15680)),o=a(11470),i=a(19365),u=["components"],s={id:"retention-rules-api",title:"Retention rules API",sidebar_label:"Retention rules"},p=void 0,d={unversionedId:"api-reference/retention-rules-api",id:"api-reference/retention-rules-api",title:"Retention rules API",description:"\x3c!--",source:"@site/docs/29.0.0/api-reference/retention-rules-api.md",sourceDirName:"api-reference",slug:"/api-reference/retention-rules-api",permalink:"/docs/29.0.0/api-reference/retention-rules-api",draft:!1,tags:[],version:"current",frontMatter:{id:"retention-rules-api",title:"Retention rules API",sidebar_label:"Retention rules"},sidebar:"docs",previous:{title:"Supervisors",permalink:"/docs/29.0.0/api-reference/supervisor-api"},next:{title:"Data management",permalink:"/docs/29.0.0/api-reference/data-management-api"}},y={},c=[{value:"Update retention rules for a datasource",id:"update-retention-rules-for-a-datasource",level:2},{value:"URL",id:"url",level:3},{value:"Header parameters",id:"header-parameters",level:3},{value:"Responses",id:"responses",level:3},{value:"Sample request",id:"sample-request",level:3},{value:"Sample response",id:"sample-response",level:3},{value:"Update default retention rules for all datasources",id:"update-default-retention-rules-for-all-datasources",level:2},{value:"URL",id:"url-1",level:3},{value:"Header parameters",id:"header-parameters-1",level:3},{value:"Responses",id:"responses-1",level:3},{value:"Sample request",id:"sample-request-1",level:3},{value:"Sample response",id:"sample-response-1",level:3},{value:"Get an array of all retention rules",id:"get-an-array-of-all-retention-rules",level:2},{value:"URL",id:"url-2",level:3},{value:"Responses",id:"responses-2",level:3},{value:"Sample request",id:"sample-request-2",level:3},{value:"Sample response",id:"sample-response-2",level:3},{value:"Get an array of retention rules for a datasource",id:"get-an-array-of-retention-rules-for-a-datasource",level:2},{value:"URL",id:"url-3",level:3},{value:"Query parameters",id:"query-parameters",level:3},{value:"Responses",id:"responses-3",level:3},{value:"Sample request",id:"sample-request-3",level:3},{value:"Sample response",id:"sample-response-3",level:3},{value:"Get audit history for all datasources",id:"get-audit-history-for-all-datasources",level:2},{value:"URL",id:"url-4",level:3},{value:"Query parameters",id:"query-parameters-1",level:3},{value:"Responses",id:"responses-4",level:3},{value:"Sample request",id:"sample-request-4",level:3},{value:"Sample response",id:"sample-response-4",level:3}],m={toc:c},g="wrapper";function f(e){var r=e.components,a=(0,t.A)(e,u);return(0,l.yg)(g,(0,n.A)({},m,a,{components:r,mdxType:"MDXLayout"}),(0,l.yg)("p",null,"This topic describes the API endpoints for managing retention rules in Apache Druid. You can configure retention rules in the Druid web console or API."),(0,l.yg)("p",null,"Druid uses retention rules to determine what data is retained in the cluster. Druid supports load, drop, and broadcast rules. For more information, see ",(0,l.yg)("a",{parentName:"p",href:"/docs/29.0.0/operations/rule-configuration"},"Using rules to drop and retain data"),"."),(0,l.yg)("p",null,"In this topic, ",(0,l.yg)("inlineCode",{parentName:"p"},"http://ROUTER_IP:ROUTER_PORT")," is a placeholder for your Router service address and port. Replace it with the information for your deployment. For example, use ",(0,l.yg)("inlineCode",{parentName:"p"},"http://localhost:8888")," for quickstart deployments."),(0,l.yg)("h2",{id:"update-retention-rules-for-a-datasource"},"Update retention rules for a datasource"),(0,l.yg)("p",null,"Updates one or more retention rules for a datasource. The request body takes an array of retention rule objects. For details on defining retention rules, see the following sources:"),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("a",{parentName:"li",href:"/docs/29.0.0/operations/rule-configuration#load-rules"},"Load rules")),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("a",{parentName:"li",href:"/docs/29.0.0/operations/rule-configuration#drop-rules"},"Drop rules")),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("a",{parentName:"li",href:"/docs/29.0.0/operations/rule-configuration#broadcast-rules"},"Broadcast rules"))),(0,l.yg)("p",null,"This request overwrites any existing rules for the datasource.\nDruid reads rules in the order in which they appear; for more information, see ",(0,l.yg)("a",{parentName:"p",href:"/docs/29.0.0/operations/rule-configuration"},"rule structure"),"."),(0,l.yg)("p",null,"Note that this endpoint returns an HTTP ",(0,l.yg)("inlineCode",{parentName:"p"},"200 OK")," even if the datasource does not exist."),(0,l.yg)("h3",{id:"url"},"URL"),(0,l.yg)("code",{class:"postAPI"},"POST")," ",(0,l.yg)("code",null,"/druid/coordinator/v1/rules/:dataSource"),(0,l.yg)("h3",{id:"header-parameters"},"Header parameters"),(0,l.yg)("p",null,"The endpoint supports a set of optional header parameters to populate the ",(0,l.yg)("inlineCode",{parentName:"p"},"author")," and ",(0,l.yg)("inlineCode",{parentName:"p"},"comment")," fields in the ",(0,l.yg)("inlineCode",{parentName:"p"},"auditInfo")," property for audit history."),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("inlineCode",{parentName:"li"},"X-Druid-Author")," (optional)",(0,l.yg)("ul",{parentName:"li"},(0,l.yg)("li",{parentName:"ul"},"Type: String"),(0,l.yg)("li",{parentName:"ul"},"A string representing the author making the configuration change."))),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("inlineCode",{parentName:"li"},"X-Druid-Comment")," (optional)",(0,l.yg)("ul",{parentName:"li"},(0,l.yg)("li",{parentName:"ul"},"Type: String"),(0,l.yg)("li",{parentName:"ul"},"A string describing the update.")))),(0,l.yg)("h3",{id:"responses"},"Responses"),(0,l.yg)(o.A,{mdxType:"Tabs"},(0,l.yg)(i.A,{value:"1",label:"200 SUCCESS",mdxType:"TabItem"},(0,l.yg)("p",null,(0,l.yg)("em",{parentName:"p"},"Successfully updated retention rules for specified datasource")))),(0,l.yg)("hr",null),(0,l.yg)("h3",{id:"sample-request"},"Sample request"),(0,l.yg)("p",null,"The following example sets a set of broadcast, load, and drop retention rules for the ",(0,l.yg)("inlineCode",{parentName:"p"},"kttm1")," datasource."),(0,l.yg)(o.A,{mdxType:"Tabs"},(0,l.yg)(i.A,{value:"2",label:"cURL",mdxType:"TabItem"},(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-shell"},'curl "http://ROUTER_IP:ROUTER_PORT/druid/coordinator/v1/rules/kttm1" \\\n--header \'X-Druid-Author: doc intern\' \\\n--header \'X-Druid-Comment: submitted via api\' \\\n--header \'Content-Type: application/json\' \\\n--data \'[\n    {\n        "type": "broadcastForever"\n    },\n    {\n        "type": "loadForever",\n        "tieredReplicants": {\n            "_default_tier": 2\n        },\n        "useDefaultTierForNull": true\n    },\n    {\n        "type": "dropByPeriod",\n        "period": "P1M"\n    }\n]\'\n'))),(0,l.yg)(i.A,{value:"3",label:"HTTP",mdxType:"TabItem"},(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-HTTP"},'POST /druid/coordinator/v1/rules/kttm1 HTTP/1.1\nHost: http://ROUTER_IP:ROUTER_PORT\nX-Druid-Author: doc intern\nX-Druid-Comment: submitted via api\nContent-Type: application/json\nContent-Length: 273\n\n[\n    {\n        "type": "broadcastForever"\n    },\n    {\n        "type": "loadForever",\n        "tieredReplicants": {\n            "_default_tier": 1\n        },\n        "useDefaultTierForNull": true\n    },\n    {\n        "type": "dropByPeriod",\n        "period": "P1M"\n    }\n]\n')))),(0,l.yg)("h3",{id:"sample-response"},"Sample response"),(0,l.yg)("p",null,"A successful request returns an HTTP ",(0,l.yg)("inlineCode",{parentName:"p"},"200 OK")," message code and an empty response body."),(0,l.yg)("h2",{id:"update-default-retention-rules-for-all-datasources"},"Update default retention rules for all datasources"),(0,l.yg)("p",null,"Updates one or more default retention rules for all datasources. Submit retention rules as an array of objects in the request body. For details on defining retention rules, see the following sources:"),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("a",{parentName:"li",href:"/docs/29.0.0/operations/rule-configuration#load-rules"},"Load rules")),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("a",{parentName:"li",href:"/docs/29.0.0/operations/rule-configuration#drop-rules"},"Drop rules")),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("a",{parentName:"li",href:"/docs/29.0.0/operations/rule-configuration#broadcast-rules"},"Broadcast rules"))),(0,l.yg)("p",null,"This request overwrites any existing rules for all datasources. To remove default retention rules for all datasources, submit an empty rule array in the request body. Rules are read in the order in which they appear; for more information, see ",(0,l.yg)("a",{parentName:"p",href:"/docs/29.0.0/operations/rule-configuration"},"rule structure"),"."),(0,l.yg)("h3",{id:"url-1"},"URL"),(0,l.yg)("code",{class:"postAPI"},"POST")," ",(0,l.yg)("code",null,"/druid/coordinator/v1/rules/_default"),(0,l.yg)("h3",{id:"header-parameters-1"},"Header parameters"),(0,l.yg)("p",null,"The endpoint supports a set of optional header parameters to populate the ",(0,l.yg)("inlineCode",{parentName:"p"},"author")," and ",(0,l.yg)("inlineCode",{parentName:"p"},"comment")," fields in the ",(0,l.yg)("inlineCode",{parentName:"p"},"auditInfo")," property for audit history."),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("inlineCode",{parentName:"li"},"X-Druid-Author")," (optional)",(0,l.yg)("ul",{parentName:"li"},(0,l.yg)("li",{parentName:"ul"},"Type: String"),(0,l.yg)("li",{parentName:"ul"},"A string representing the author making the configuration change."))),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("inlineCode",{parentName:"li"},"X-Druid-Comment")," (optional)",(0,l.yg)("ul",{parentName:"li"},(0,l.yg)("li",{parentName:"ul"},"Type: String"),(0,l.yg)("li",{parentName:"ul"},"A string describing the update.")))),(0,l.yg)("h3",{id:"responses-1"},"Responses"),(0,l.yg)(o.A,{mdxType:"Tabs"},(0,l.yg)(i.A,{value:"4",label:"200 SUCCESS",mdxType:"TabItem"},(0,l.yg)("p",null,(0,l.yg)("em",{parentName:"p"},"Successfully updated default retention rules"))),(0,l.yg)(i.A,{value:"5",label:"500 SERVER ERROR",mdxType:"TabItem"},(0,l.yg)("p",null,(0,l.yg)("em",{parentName:"p"},"Error with request body")))),(0,l.yg)("hr",null),(0,l.yg)("h3",{id:"sample-request-1"},"Sample request"),(0,l.yg)("p",null,"The following example updates the default retention rule for all datasources with a ",(0,l.yg)("inlineCode",{parentName:"p"},"loadByInterval")," rule."),(0,l.yg)(o.A,{mdxType:"Tabs"},(0,l.yg)(i.A,{value:"6",label:"cURL",mdxType:"TabItem"},(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-shell"},'curl "http://ROUTER_IP:ROUTER_PORT/druid/coordinator/v1/rules/_default" \\\n--header \'Content-Type: application/json\' \\\n--data \'[\n    {\n        "type": "loadByInterval",\n        "tieredReplicants": {},\n        "useDefaultTierForNull": false,\n        "interval": "2010-01-01/2020-01-01"\n    }\n]\'\n'))),(0,l.yg)(i.A,{value:"7",label:"HTTP",mdxType:"TabItem"},(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-HTTP"},'POST /druid/coordinator/v1/rules/_default HTTP/1.1\nHost: http://ROUTER_IP:ROUTER_PORT\nContent-Type: application/json\nContent-Length: 205\n\n[\n    {\n        "type": "loadByInterval",\n        "tieredReplicants": {},\n        "useDefaultTierForNull": false,\n        "interval": "2010-01-01/2020-01-01"\n    }\n]\n')))),(0,l.yg)("h3",{id:"sample-response-1"},"Sample response"),(0,l.yg)("p",null,"A successful request returns an HTTP ",(0,l.yg)("inlineCode",{parentName:"p"},"200 OK")," message code and an empty response body."),(0,l.yg)("h2",{id:"get-an-array-of-all-retention-rules"},"Get an array of all retention rules"),(0,l.yg)("p",null,"Retrieves all current retention rules in the cluster including the default retention rule. Returns an array of objects for each datasource and their associated retention rules."),(0,l.yg)("h3",{id:"url-2"},"URL"),(0,l.yg)("code",{class:"getAPI"},"GET")," ",(0,l.yg)("code",null,"/druid/coordinator/v1/rules"),(0,l.yg)("h3",{id:"responses-2"},"Responses"),(0,l.yg)(o.A,{mdxType:"Tabs"},(0,l.yg)(i.A,{value:"8",label:"200 SUCCESS",mdxType:"TabItem"},(0,l.yg)("p",null,(0,l.yg)("em",{parentName:"p"},"Successfully retrieved retention rules")))),(0,l.yg)("hr",null),(0,l.yg)("h3",{id:"sample-request-2"},"Sample request"),(0,l.yg)(o.A,{mdxType:"Tabs"},(0,l.yg)(i.A,{value:"9",label:"cURL",mdxType:"TabItem"},(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-shell"},'curl "http://ROUTER_IP:ROUTER_PORT/druid/coordinator/v1/rules"\n'))),(0,l.yg)(i.A,{value:"10",label:"HTTP",mdxType:"TabItem"},(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-HTTP"},"GET /druid/coordinator/v1/rules HTTP/1.1\nHost: http://ROUTER_IP:ROUTER_PORT\n")))),(0,l.yg)("h3",{id:"sample-response-2"},"Sample response"),(0,l.yg)("details",null,(0,l.yg)("summary",null,"Click to show sample response"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "_default": [\n      {\n          "tieredReplicants": {\n              "_default_tier": 2\n          },\n          "type": "loadForever"\n      }\n  ],\n  "social_media": [\n      {\n          "interval": "2023-01-01T00:00:00.000Z/2023-02-01T00:00:00.000Z",\n          "type": "dropByInterval"\n      }\n  ],\n  "wikipedia_api": [],\n}\n'))),(0,l.yg)("h2",{id:"get-an-array-of-retention-rules-for-a-datasource"},"Get an array of retention rules for a datasource"),(0,l.yg)("p",null,"Retrieves an array of rule objects for a single datasource. Returns an empty array if there are no retention rules."),(0,l.yg)("p",null,"Note that this endpoint returns an HTTP ",(0,l.yg)("inlineCode",{parentName:"p"},"200 OK")," message code even if the datasource does not exist."),(0,l.yg)("h3",{id:"url-3"},"URL"),(0,l.yg)("code",{class:"getAPI"},"GET")," ",(0,l.yg)("code",null,"/druid/coordinator/v1/rules/:dataSource"),(0,l.yg)("h3",{id:"query-parameters"},"Query parameters"),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("inlineCode",{parentName:"li"},"full")," (optional)",(0,l.yg)("ul",{parentName:"li"},(0,l.yg)("li",{parentName:"ul"},"Includes the default retention rule for the datasource in the response.")))),(0,l.yg)("h3",{id:"responses-3"},"Responses"),(0,l.yg)(o.A,{mdxType:"Tabs"},(0,l.yg)(i.A,{value:"11",label:"200 SUCCESS",mdxType:"TabItem"},(0,l.yg)("p",null,(0,l.yg)("em",{parentName:"p"},"Successfully retrieved retention rules")))),(0,l.yg)("hr",null),(0,l.yg)("h3",{id:"sample-request-3"},"Sample request"),(0,l.yg)("p",null,"The following example retrieves the custom retention rules and default retention rules for datasource with the name ",(0,l.yg)("inlineCode",{parentName:"p"},"social_media"),"."),(0,l.yg)(o.A,{mdxType:"Tabs"},(0,l.yg)(i.A,{value:"12",label:"cURL",mdxType:"TabItem"},(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-shell"},'curl "http://ROUTER_IP:ROUTER_PORT/druid/coordinator/v1/rules/social_media?full=null"\n'))),(0,l.yg)(i.A,{value:"13",label:"HTTP",mdxType:"TabItem"},(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-HTTP"},"GET /druid/coordinator/v1/rules/social_media?full=null HTTP/1.1\nHost: http://ROUTER_IP:ROUTER_PORT\n")))),(0,l.yg)("h3",{id:"sample-response-3"},"Sample response"),(0,l.yg)("details",null,(0,l.yg)("summary",null,"Click to show sample response"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-json"},'[\n  {\n      "interval": "2020-01-01T00:00:00.000Z/2022-02-01T00:00:00.000Z",\n      "type": "dropByInterval"\n  },\n  {\n      "interval": "2010-01-01T00:00:00.000Z/2020-01-01T00:00:00.000Z",\n      "tieredReplicants": {\n          "_default_tier": 2\n      },\n      "type": "loadByInterval"\n  },\n  {\n      "tieredReplicants": {\n          "_default_tier": 2\n      },\n      "type": "loadForever"\n  }\n]\n'))),(0,l.yg)("h2",{id:"get-audit-history-for-all-datasources"},"Get audit history for all datasources"),(0,l.yg)("p",null,"Retrieves the audit history of rules for all datasources over an interval of time. The default interval is 1 week. You can change this period by setting ",(0,l.yg)("inlineCode",{parentName:"p"},"druid.audit.manager.auditHistoryMillis")," in the ",(0,l.yg)("inlineCode",{parentName:"p"},"runtime.properties")," file for the Coordinator."),(0,l.yg)("h3",{id:"url-4"},"URL"),(0,l.yg)("code",{class:"getAPI"},"GET")," ",(0,l.yg)("code",null,"/druid/coordinator/v1/rules/history"),(0,l.yg)("h3",{id:"query-parameters-1"},"Query parameters"),(0,l.yg)("p",null,"Note that the following query parameters cannot be chained."),(0,l.yg)("ul",null,(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("inlineCode",{parentName:"li"},"interval")," (optional)",(0,l.yg)("ul",{parentName:"li"},(0,l.yg)("li",{parentName:"ul"},"Type: ISO 8601."),(0,l.yg)("li",{parentName:"ul"},"Limits the number of results to the specified time interval. Delimit with ",(0,l.yg)("inlineCode",{parentName:"li"},"/"),". For example, ",(0,l.yg)("inlineCode",{parentName:"li"},"2023-07-13/2023-07-19"),"."))),(0,l.yg)("li",{parentName:"ul"},(0,l.yg)("inlineCode",{parentName:"li"},"count")," (optional)",(0,l.yg)("ul",{parentName:"li"},(0,l.yg)("li",{parentName:"ul"},"Type: Int"),(0,l.yg)("li",{parentName:"ul"},"Limits the number of results to the last ",(0,l.yg)("inlineCode",{parentName:"li"},"n")," entries.")))),(0,l.yg)("h3",{id:"responses-4"},"Responses"),(0,l.yg)(o.A,{mdxType:"Tabs"},(0,l.yg)(i.A,{value:"14",label:"200 SUCCESS",mdxType:"TabItem"},(0,l.yg)("p",null,(0,l.yg)("em",{parentName:"p"},"Successfully retrieved audit history"))),(0,l.yg)(i.A,{value:"15",label:"400 BAD REQUEST",mdxType:"TabItem"},(0,l.yg)("p",null,(0,l.yg)("em",{parentName:"p"},"Request in the incorrect format"))),(0,l.yg)(i.A,{value:"16",label:"404 NOT FOUND",mdxType:"TabItem"},(0,l.yg)("p",null,(0,l.yg)("em",{parentName:"p"},(0,l.yg)("inlineCode",{parentName:"em"},"count")," query parameter too large")))),(0,l.yg)("hr",null),(0,l.yg)("h3",{id:"sample-request-4"},"Sample request"),(0,l.yg)("p",null,"The following example retrieves the audit history for all datasources from ",(0,l.yg)("inlineCode",{parentName:"p"},"2023-07-13")," to ",(0,l.yg)("inlineCode",{parentName:"p"},"2023-07-19"),"."),(0,l.yg)(o.A,{mdxType:"Tabs"},(0,l.yg)(i.A,{value:"17",label:"cURL",mdxType:"TabItem"},(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-shell"},'curl "http://ROUTER_IP:ROUTER_PORT/druid/coordinator/v1/rules/history?interval=2023-07-13%2F2023-07-19"\n'))),(0,l.yg)(i.A,{value:"18",label:"HTTP",mdxType:"TabItem"},(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-HTTP"},"GET /druid/coordinator/v1/rules/history?interval=2023-07-13/2023-07-19 HTTP/1.1\nHost: http://ROUTER_IP:ROUTER_PORT\n")))),(0,l.yg)("h3",{id:"sample-response-4"},"Sample response"),(0,l.yg)("details",null,(0,l.yg)("summary",null,"Click to show sample response"),(0,l.yg)("pre",null,(0,l.yg)("code",{parentName:"pre",className:"language-json"},'[\n  {\n      "key": "social_media",\n      "type": "rules",\n      "auditInfo": {\n          "author": "console",\n          "comment": "test",\n          "ip": "127.0.0.1"\n      },\n      "payload": "[{\\"interval\\":\\"2023-01-01T00:00:00.000Z/2023-02-01T00:00:00.000Z\\",\\"type\\":\\"dropByInterval\\"}]",\n      "auditTime": "2023-07-13T18:05:33.066Z"\n  },\n  {\n      "key": "social_media",\n      "type": "rules",\n      "auditInfo": {\n          "author": "console",\n          "comment": "test",\n          "ip": "127.0.0.1"\n      },\n      "payload": "[]",\n      "auditTime": "2023-07-18T18:10:21.203Z"\n  },\n  {\n      "key": "wikipedia_api",\n      "type": "rules",\n      "auditInfo": {\n          "author": "console",\n          "comment": "test",\n          "ip": "127.0.0.1"\n      },\n      "payload": "[{\\"tieredReplicants\\":{\\"_default_tier\\":2},\\"type\\":\\"loadForever\\"}]",\n      "auditTime": "2023-07-18T18:10:44.519Z"\n  },\n  {\n      "key": "wikipedia_api",\n      "type": "rules",\n      "auditInfo": {\n          "author": "console",\n          "comment": "test",\n          "ip": "127.0.0.1"\n      },\n      "payload": "[]",\n      "auditTime": "2023-07-18T18:11:02.110Z"\n  },\n  {\n      "key": "social_media",\n      "type": "rules",\n      "auditInfo": {\n          "author": "console",\n          "comment": "test",\n          "ip": "127.0.0.1"\n      },\n      "payload": "[{\\"interval\\":\\"2023-07-03T18:49:54.848Z/2023-07-03T18:49:55.861Z\\",\\"type\\":\\"dropByInterval\\"}]",\n      "auditTime": "2023-07-18T18:32:50.060Z"\n  },\n  {\n      "key": "social_media",\n      "type": "rules",\n      "auditInfo": {\n          "author": "console",\n          "comment": "test",\n          "ip": "127.0.0.1"\n      },\n      "payload": "[{\\"interval\\":\\"2020-01-01T00:00:00.000Z/2022-02-01T00:00:00.000Z\\",\\"type\\":\\"dropByInterval\\"}]",\n      "auditTime": "2023-07-18T18:34:09.657Z"\n  },\n  {\n      "key": "social_media",\n      "type": "rules",\n      "auditInfo": {\n          "author": "console",\n          "comment": "test",\n          "ip": "127.0.0.1"\n      },\n      "payload": "[{\\"interval\\":\\"2020-01-01T00:00:00.000Z/2022-02-01T00:00:00.000Z\\",\\"type\\":\\"dropByInterval\\"},{\\"tieredReplicants\\":{\\"_default_tier\\":2},\\"type\\":\\"loadForever\\"}]",\n      "auditTime": "2023-07-18T18:38:37.223Z"\n  },\n  {\n      "key": "social_media",\n      "type": "rules",\n      "auditInfo": {\n          "author": "console",\n          "comment": "test",\n          "ip": "127.0.0.1"\n      },\n      "payload": "[{\\"interval\\":\\"2020-01-01T00:00:00.000Z/2022-02-01T00:00:00.000Z\\",\\"type\\":\\"dropByInterval\\"},{\\"interval\\":\\"2010-01-01T00:00:00.000Z/2020-01-01T00:00:00.000Z\\",\\"tieredReplicants\\":{\\"_default_tier\\":2},\\"type\\":\\"loadByInterval\\"}]",\n      "auditTime": "2023-07-18T18:49:43.964Z"\n  }\n]\n'))))}f.isMDXComponent=!0}}]);