"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5691],{28453:(e,s,r)=>{r.d(s,{R:()=>d,x:()=>o});var i=r(96540);const n={},t=i.createContext(n);function d(e){const s=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:d(e.components),i.createElement(t.Provider,{value:s},e.children)}},28583:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"operations/security-user-auth","title":"User authentication and authorization","description":"\x3c!--","source":"@site/docs/33.0.0/operations/security-user-auth.md","sourceDirName":"operations","slug":"/operations/security-user-auth","permalink":"/docs/33.0.0/operations/security-user-auth","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"security-user-auth","title":"User authentication and authorization"},"sidebar":"docs","previous":{"title":"Security overview","permalink":"/docs/33.0.0/operations/security-overview"},"next":{"title":"LDAP auth","permalink":"/docs/33.0.0/operations/auth-ldap"}}');var n=r(74848),t=r(28453);const d={id:"security-user-auth",title:"User authentication and authorization"},o=void 0,c={},a=[{value:"Authentication and authorization model",id:"authentication-and-authorization-model",level:2},{value:"Resource types",id:"resource-types",level:3},{value:"Actions",id:"actions",level:3},{value:"User types",id:"user-types",level:3},{value:"Default user accounts",id:"default-user-accounts",level:2},{value:"Authenticator",id:"authenticator",level:3},{value:"Authorizer",id:"authorizer",level:3},{value:"Defining permissions",id:"defining-permissions",level:2},{value:"<code>DATASOURCE</code>",id:"datasource",level:3},{value:"<code>CONFIG</code>",id:"config",level:3},{value:"<code>EXTERNAL</code>",id:"external",level:3},{value:"<code>STATE</code>",id:"state",level:3},{value:"<code>SYSTEM_TABLE</code>",id:"system_table",level:3},{value:"HTTP methods",id:"http-methods",level:3},{value:"SQL permissions",id:"sql-permissions",level:3},{value:"Configuration propagation",id:"configuration-propagation",level:2}];function l(e){const s={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.p,{children:"This document describes the Druid security model that extensions use to enable user authentication and authorization services to Druid."}),"\n",(0,n.jsx)(s.h2,{id:"authentication-and-authorization-model",children:"Authentication and authorization model"}),"\n",(0,n.jsxs)(s.p,{children:["At the center of the Druid user authentication and authorization model are ",(0,n.jsx)(s.em,{children:"resources"})," and ",(0,n.jsx)(s.em,{children:"actions"}),". A resource is something that authenticated users are trying to access or modify. An action is something that users are trying to do."]}),"\n",(0,n.jsx)(s.h3,{id:"resource-types",children:"Resource types"}),"\n",(0,n.jsx)(s.p,{children:"Druid uses the following resource types:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:["DATASOURCE \u2013 Each Druid table (i.e., ",(0,n.jsx)(s.code,{children:"tables"})," in the ",(0,n.jsx)(s.code,{children:"druid"})," schema in SQL) is a resource."]}),"\n",(0,n.jsx)(s.li,{children:"CONFIG \u2013 Configuration resources exposed by the cluster components."}),"\n",(0,n.jsxs)(s.li,{children:["EXTERNAL \u2013 External data read through the ",(0,n.jsx)(s.a,{href:"/docs/33.0.0/multi-stage-query/concepts#extern",children:"EXTERN function"})," in SQL."]}),"\n",(0,n.jsx)(s.li,{children:"STATE \u2013 Cluster-wide state resources."}),"\n",(0,n.jsxs)(s.li,{children:["SYSTEM_TABLE \u2013 when the Broker property ",(0,n.jsx)(s.code,{children:"druid.sql.planner.authorizeSystemTablesDirectly"})," is true, then Druid uses this resource type to authorize the system tables in the ",(0,n.jsx)(s.code,{children:"sys"})," schema in SQL."]}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["For specific resources associated with the resource types, see ",(0,n.jsx)(s.a,{href:"#defining-permissions",children:"Defining permissions"})," and the corresponding endpoint descriptions in ",(0,n.jsx)(s.a,{href:"/docs/33.0.0/api-reference/",children:"API reference"}),"."]}),"\n",(0,n.jsx)(s.h3,{id:"actions",children:"Actions"}),"\n",(0,n.jsx)(s.p,{children:"Users perform one of the following actions on resources:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"READ \u2013 Used for read-only operations."}),"\n",(0,n.jsx)(s.li,{children:"WRITE \u2013 Used for operations that are not read-only."}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["WRITE permission on a resource does not include READ permission. If a user requires both READ and WRITE permissions on a resource, you must grant them both explicitly. For instance, a user with only ",(0,n.jsx)(s.code,{children:"DATASOURCE READ"})," permission\nmight have access to an API or a system schema record that a user with ",(0,n.jsx)(s.code,{children:"DATASOURCE WRITE"})," permission would not have access to."]}),"\n",(0,n.jsx)(s.h3,{id:"user-types",children:"User types"}),"\n",(0,n.jsx)(s.p,{children:"In practice, most deployments will only need to define two classes of users:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"Administrators, who have WRITE action permissions on all resource types. These users will add datasources and administer the system."}),"\n",(0,n.jsx)(s.li,{children:"Data users, who only need READ access to DATASOURCE. These users should access Query APIs only through an API gateway. Other APIs and permissions include functionality that should be limited to server admins."}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:"It is important to note that WRITE access to DATASOURCE grants a user broad access. For instance, such users will have access to the Druid file system, S3 buckets, and credentials, among other things. As such, the ability to add and manage datasources should be allocated selectively to administrators."}),"\n",(0,n.jsx)(s.h2,{id:"default-user-accounts",children:"Default user accounts"}),"\n",(0,n.jsx)(s.h3,{id:"authenticator",children:"Authenticator"}),"\n",(0,n.jsxs)(s.p,{children:["If ",(0,n.jsx)(s.code,{children:"druid.auth.authenticator.<authenticator-name>.initialAdminPassword"}),' is set, a default admin user named "admin" will be created, with the specified initial password. If this configuration is omitted, the "admin" user will not be created.']}),"\n",(0,n.jsxs)(s.p,{children:["If ",(0,n.jsx)(s.code,{children:"druid.auth.authenticator.<authenticator-name>.initialInternalClientPassword"}),' is set, a default internal system user named "druid_system" will be created, with the specified initial password. If this configuration is omitted, the "druid_system" user will not be created.']}),"\n",(0,n.jsx)(s.h3,{id:"authorizer",children:"Authorizer"}),"\n",(0,n.jsx)(s.p,{children:'Each Authorizer will always have a default "admin" and "druid_system" user with full privileges.'}),"\n",(0,n.jsx)(s.h2,{id:"defining-permissions",children:"Defining permissions"}),"\n",(0,n.jsx)(s.p,{children:"You define permissions that you then grant to user groups.\nPermissions are defined by resource type, action, and resource name.\nThis section describes the resource names available for each resource type."}),"\n",(0,n.jsx)(s.h3,{id:"datasource",children:(0,n.jsx)(s.code,{children:"DATASOURCE"})}),"\n",(0,n.jsx)(s.p,{children:"Resource names for this type are datasource names. Specifying a datasource permission allows the administrator to grant users access to specific datasources."}),"\n",(0,n.jsx)(s.h3,{id:"config",children:(0,n.jsx)(s.code,{children:"CONFIG"})}),"\n",(0,n.jsx)(s.p,{children:'There are two possible resource names for the "CONFIG" resource type, "CONFIG" and "security". Granting a user access to CONFIG resources allows them to access the following endpoints.'}),"\n",(0,n.jsx)(s.p,{children:'"CONFIG" resource name covers the following endpoints:'}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Endpoint"}),(0,n.jsx)(s.th,{children:"Process Type"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid/coordinator/v1/config"})}),(0,n.jsx)(s.td,{children:"coordinator"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid/indexer/v1/worker"})}),(0,n.jsx)(s.td,{children:"overlord"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid/indexer/v1/worker/history"})}),(0,n.jsx)(s.td,{children:"overlord"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid/worker/v1/disable"})}),(0,n.jsx)(s.td,{children:"middleManager"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid/worker/v1/enable"})}),(0,n.jsx)(s.td,{children:"middleManager"})]})]})]}),"\n",(0,n.jsx)(s.p,{children:'"security" resource name covers the following endpoint:'}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Endpoint"}),(0,n.jsx)(s.th,{children:"Process Type"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid-ext/basic-security/authentication"})}),(0,n.jsx)(s.td,{children:"coordinator"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid-ext/basic-security/authorization"})}),(0,n.jsx)(s.td,{children:"coordinator"})]})]})]}),"\n",(0,n.jsx)(s.h3,{id:"external",children:(0,n.jsx)(s.code,{children:"EXTERNAL"})}),"\n",(0,n.jsxs)(s.p,{children:['The EXTERNAL resource type only accepts the resource name "EXTERNAL".\nGranting a user access to EXTERNAL resources allows them to run queries that include\nthe ',(0,n.jsx)(s.a,{href:"/docs/33.0.0/multi-stage-query/concepts#extern",children:"EXTERN function"})," in SQL\nto read external data."]}),"\n",(0,n.jsx)(s.h3,{id:"state",children:(0,n.jsx)(s.code,{children:"STATE"})}),"\n",(0,n.jsx)(s.p,{children:'There is only one possible resource name for the "STATE" config resource type, "STATE". Granting a user access to STATE resources allows them to access the following endpoints.'}),"\n",(0,n.jsx)(s.p,{children:'"STATE" resource name covers the following endpoints:'}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Endpoint"}),(0,n.jsx)(s.th,{children:"Process Type"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid/coordinator/v1"})}),(0,n.jsx)(s.td,{children:"coordinator"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid/coordinator/v1/rules"})}),(0,n.jsx)(s.td,{children:"coordinator"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid/coordinator/v1/rules/history"})}),(0,n.jsx)(s.td,{children:"coordinator"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid/coordinator/v1/servers"})}),(0,n.jsx)(s.td,{children:"coordinator"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid/coordinator/v1/tiers"})}),(0,n.jsx)(s.td,{children:"coordinator"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid/broker/v1"})}),(0,n.jsx)(s.td,{children:"broker"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid/v2/candidates"})}),(0,n.jsx)(s.td,{children:"broker"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid/indexer/v1/leader"})}),(0,n.jsx)(s.td,{children:"overlord"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid/indexer/v1/isLeader"})}),(0,n.jsx)(s.td,{children:"overlord"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid/indexer/v1/action"})}),(0,n.jsx)(s.td,{children:"overlord"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid/indexer/v1/workers"})}),(0,n.jsx)(s.td,{children:"overlord"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid/indexer/v1/scaling"})}),(0,n.jsx)(s.td,{children:"overlord"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid/worker/v1/enabled"})}),(0,n.jsx)(s.td,{children:"middleManager"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid/worker/v1/tasks"})}),(0,n.jsx)(s.td,{children:"middleManager"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid/worker/v1/task/{taskid}/shutdown"})}),(0,n.jsx)(s.td,{children:"middleManager"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid/worker/v1/task/{taskid}/log"})}),(0,n.jsx)(s.td,{children:"middleManager"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid/historical/v1"})}),(0,n.jsx)(s.td,{children:"historical"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid-internal/v1/segments/"})}),(0,n.jsx)(s.td,{children:"historical"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid-internal/v1/segments/"})}),(0,n.jsx)(s.td,{children:"peon"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/druid-internal/v1/segments/"})}),(0,n.jsx)(s.td,{children:"realtime"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"/status"})}),(0,n.jsx)(s.td,{children:"all process types"})]})]})]}),"\n",(0,n.jsx)(s.h3,{id:"system_table",children:(0,n.jsx)(s.code,{children:"SYSTEM_TABLE"})}),"\n",(0,n.jsxs)(s.p,{children:["Resource names for this type are system schema table names in the ",(0,n.jsx)(s.code,{children:"sys"})," schema in SQL, for example ",(0,n.jsx)(s.code,{children:"sys.segments"})," and ",(0,n.jsx)(s.code,{children:"sys.server_segments"}),". Druid only enforces authorization for ",(0,n.jsx)(s.code,{children:"SYSTEM_TABLE"})," resources when the Broker property ",(0,n.jsx)(s.code,{children:"druid.sql.planner.authorizeSystemTablesDirectly"})," is true."]}),"\n",(0,n.jsx)(s.h3,{id:"http-methods",children:"HTTP methods"}),"\n",(0,n.jsxs)(s.p,{children:["For information on what HTTP methods are supported on a particular request endpoint, refer to ",(0,n.jsx)(s.a,{href:"/docs/33.0.0/api-reference/",children:"API reference"}),"."]}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.code,{children:"GET"})," requests require READ permissions, while ",(0,n.jsx)(s.code,{children:"POST"})," and ",(0,n.jsx)(s.code,{children:"DELETE"})," requests require WRITE permissions."]}),"\n",(0,n.jsx)(s.h3,{id:"sql-permissions",children:"SQL permissions"}),"\n",(0,n.jsx)(s.p,{children:"Queries on Druid datasources require DATASOURCE READ permissions for the specified datasource."}),"\n",(0,n.jsxs)(s.p,{children:["Queries to access external data through the ",(0,n.jsx)(s.a,{href:"/docs/33.0.0/multi-stage-query/concepts#extern",children:"EXTERN function"})," require EXTERNAL READ permissions."]}),"\n",(0,n.jsxs)(s.p,{children:["Queries on ",(0,n.jsx)(s.a,{href:"/docs/33.0.0/querying/sql-metadata-tables#information-schema",children:"INFORMATION_SCHEMA tables"})," return information about datasources that the caller has DATASOURCE READ access to. Other\ndatasources are omitted."]}),"\n",(0,n.jsxs)(s.p,{children:["Queries on the ",(0,n.jsx)(s.a,{href:"/docs/33.0.0/querying/sql-metadata-tables#system-schema",children:"system schema tables"})," require the following permissions:"]}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"segments"}),": Druid filters segments according to DATASOURCE READ permissions."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"servers"}),": The user requires STATE READ permissions."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"server_segments"}),": The user requires STATE READ permissions. Druid filters segments according to DATASOURCE READ permissions."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"tasks"}),": Druid filters tasks according to DATASOURCE READ permissions."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"supervisors"}),": Druid filters supervisors according to DATASOURCE READ permissions."]}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["When the Broker property ",(0,n.jsx)(s.code,{children:"druid.sql.planner.authorizeSystemTablesDirectly"})," is true, users also require  ",(0,n.jsx)(s.code,{children:"SYSTEM_TABLE"})," authorization on a system schema table to query it."]}),"\n",(0,n.jsx)(s.h2,{id:"configuration-propagation",children:"Configuration propagation"}),"\n",(0,n.jsx)(s.p,{children:"To prevent excessive load on the Coordinator, the Authenticator and Authorizer user/role Druid metadata store state is cached on each Druid process."}),"\n",(0,n.jsxs)(s.p,{children:["Each process will periodically poll the Coordinator for the latest Druid metadata store state, controlled by the ",(0,n.jsx)(s.code,{children:"druid.auth.basic.common.pollingPeriod"})," and ",(0,n.jsx)(s.code,{children:"druid.auth.basic.common.maxRandomDelay"})," properties."]}),"\n",(0,n.jsxs)(s.p,{children:["When a configuration update occurs, the Coordinator can optionally notify each process with the updated Druid metadata store state. This behavior is controlled by the ",(0,n.jsx)(s.code,{children:"enableCacheNotifications"})," and ",(0,n.jsx)(s.code,{children:"cacheNotificationTimeout"})," properties on Authenticators and Authorizers."]}),"\n",(0,n.jsx)(s.p,{children:"Note that because of the caching, changes made to the user/role Druid metadata store may not be immediately reflected at each Druid process."})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}}}]);