"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[555],{28453:(e,n,l)=>{l.d(n,{R:()=>s,x:()=>d});var i=l(96540);const t={},r=i.createContext(t);function s(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),i.createElement(r.Provider,{value:n},e.children)}},59755:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"tutorials/tutorial-sql-null","title":"Null handling tutorial","description":"Introduction to null handling in Druid","source":"@site/docs/latest/tutorials/tutorial-sql-null.md","sourceDirName":"tutorials","slug":"/tutorials/tutorial-sql-null","permalink":"/docs/latest/tutorials/tutorial-sql-null","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"tutorial-sql-null","title":"Null handling tutorial","sidebar_label":"Handling null values","description":"Introduction to null handling in Druid"}}');var t=l(74848),r=l(28453);const s={id:"tutorial-sql-null",title:"Null handling tutorial",sidebar_label:"Handling null values",description:"Introduction to null handling in Druid"},d=void 0,a={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Load data with null values",id:"load-data-with-null-values",level:2},{value:"String query example",id:"string-query-example",level:2},{value:"Filter for empty strings in addition to null",id:"filter-for-empty-strings-in-addition-to-null",level:3},{value:"Numeric query examples",id:"numeric-query-examples",level:2},{value:"Ingestion time filtering",id:"ingestion-time-filtering",level:2},{value:"Learn more",id:"learn-more",level:2}];function u(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"This tutorial introduces the basic concepts of null handling for string and numeric columns in Apache Druid.\nThe tutorial focuses on filters using the logical NOT operation on columns with NULL values."}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(n.p,{children:["Before starting this tutorial, download and run Apache Druid on your local machine as described in\nthe ",(0,t.jsx)(n.a,{href:"/docs/latest/tutorials/",children:"Local quickstart"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["The tutorial assumes you are familiar with using the ",(0,t.jsx)(n.a,{href:"/docs/latest/tutorials/tutorial-sql-query-view",children:"Query view"})," to ingest and query data."]}),"\n",(0,t.jsx)(n.p,{children:"The tutorial also assumes you have not changed any of the default settings for null handling."}),"\n",(0,t.jsx)(n.h2,{id:"load-data-with-null-values",children:"Load data with null values"}),"\n",(0,t.jsx)(n.p,{children:"The sample data for the tutorial contains null values for string and numeric columns as follows:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{"date": "1/1/2024 1:02:00","title": "example_1","string_value": "some_value","numeric_value": 1}\n{"date": "1/1/2024 1:03:00","title": "example_2","string_value": "another_value","numeric_value": 2}\n{"date": "1/1/2024 1:04:00","title": "example_3","string_value": "", "numeric_value": null}\n{"date": "1/1/2024 1:05:00","title": "example_4","string_value": null, "numeric_value": null}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Run the following query in the Druid Console to load the data:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'REPLACE INTO "null_example" OVERWRITE ALL\nWITH "ext" AS (\n  SELECT *\n  FROM TABLE(\n    EXTERN(\n      \'{"type":"inline","data":"{\\"date\\": \\"1/1/2024 1:02:00\\",\\"title\\": \\"example_1\\",\\"string_value\\": \\"some_value\\",\\"numeric_value\\": 1}\\n{\\"date\\": \\"1/1/2024 1:03:00\\",\\"title\\": \\"example_2\\",\\"string_value\\": \\"another_value\\",\\"numeric_value\\": 2}\\n{\\"date\\": \\"1/1/2024 1:04:00\\",\\"title\\": \\"example_3\\",\\"string_value\\": \\"\\", \\"numeric_value\\": null}\\n{\\"date\\": \\"1/1/2024 1:05:00\\",\\"title\\": \\"example_4\\",\\"string_value\\": null, \\"numeric_value\\": null}"}\',\n      \'{"type":"json"}\'\n    )\n  ) EXTEND ("date" VARCHAR, "title" VARCHAR, "string_value" VARCHAR, "numeric_value" BIGINT)\n)\nSELECT\n  TIME_PARSE("date", \'d/M/yyyy H:mm:ss\') AS "__time",\n  "title",\n  "string_value",\n  "numeric_value"\nFROM "ext"\nPARTITIONED BY DAY\n'})}),"\n",(0,t.jsx)(n.p,{children:"After Druid finishes loading the data, run the following query to see the table:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'SELECT * FROM "null_example"\n'})}),"\n",(0,t.jsx)(n.p,{children:"Druid returns the following:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:(0,t.jsx)(n.code,{children:"__time"})}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.code,{children:"title"})}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.code,{children:"string_value"})}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.code,{children:"numeric_value"})})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"2024-01-01T01:02:00.000Z"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"example_1"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"some_value"})}),(0,t.jsx)(n.td,{children:"1"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"2024-01-01T01:03:00.000Z"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"example_2"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"another_value"})}),(0,t.jsx)(n.td,{children:"2"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"2024-01-01T01:04:00.000Z"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"example_3"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"empty"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"null"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"2024-01-01T01:05:00.000Z"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"example_4"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"null"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"null"})})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"Note the difference in the empty string value for example 3 and the null string value for example 4."}),"\n",(0,t.jsx)(n.h2,{id:"string-query-example",children:"String query example"}),"\n",(0,t.jsxs)(n.p,{children:["The queries in this section illustrate null handling with strings.\nThe following query filters rows where the string value is not equal to ",(0,t.jsx)(n.code,{children:"some_value"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'SELECT COUNT(*)\nFROM "null_example"\nWHERE "string_value" != \'some_value\'\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Druid returns 2 for ",(0,t.jsx)(n.code,{children:"another_value"})," and the empty string ",(0,t.jsx)(n.code,{children:'""'}),". The null value is not counted."]}),"\n",(0,t.jsxs)(n.p,{children:["Note that the null value is included in ",(0,t.jsx)(n.code,{children:"COUNT(*)"})," but not as a count of the values in the column as follows:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'SELECT "string_value",\n      COUNT(*) AS count_all_rows,\n      COUNT("string_value") AS count_values\nFROM "inline_data"\nGROUP BY 1\n'})}),"\n",(0,t.jsx)(n.p,{children:"Druid returns the following:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:(0,t.jsx)(n.code,{children:"string_value"})}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.code,{children:"count_all_rows"})}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.code,{children:"count_values"})})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"null"})}),(0,t.jsx)(n.td,{children:"1"}),(0,t.jsx)(n.td,{children:"0"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"empty"})}),(0,t.jsx)(n.td,{children:"1"}),(0,t.jsx)(n.td,{children:"1"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"another_value"})}),(0,t.jsx)(n.td,{children:"1"}),(0,t.jsx)(n.td,{children:"1"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"some_value"})}),(0,t.jsx)(n.td,{children:"1"}),(0,t.jsx)(n.td,{children:"1"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:["Also note that GROUP BY expressions yield distinct entries for ",(0,t.jsx)(n.code,{children:"null"})," and the empty string."]}),"\n",(0,t.jsx)(n.h3,{id:"filter-for-empty-strings-in-addition-to-null",children:"Filter for empty strings in addition to null"}),"\n",(0,t.jsx)(n.p,{children:"If your queries rely on treating empty strings and null values the same, you can use an OR operator in the filter. For example to select all rows with null values or empty strings:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'SELECT *\nFROM "null_example"\nWHERE "string_value" IS NULL OR "string_value" = \'\'\n'})}),"\n",(0,t.jsx)(n.p,{children:"Druid returns the following:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:(0,t.jsx)(n.code,{children:"__time"})}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.code,{children:"title"})}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.code,{children:"string_value"})}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.code,{children:"numeric_value"})})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"2024-01-01T01:04:00.000Z"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"example_3"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"empty"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"null"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"2024-01-01T01:05:00.000Z"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"example_4"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"null"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"null"})})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"For another example, if you do not want to count empty strings, use a FILTER to exclude them. For example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'SELECT COUNT("string_value") FILTER(WHERE "string_value" <> \'\')\nFROM "null_example"\n'})}),"\n",(0,t.jsx)(n.p,{children:"Druid returns 2. Both the empty string and null values are excluded."}),"\n",(0,t.jsx)(n.h2,{id:"numeric-query-examples",children:"Numeric query examples"}),"\n",(0,t.jsx)(n.p,{children:"Druid does not count null values in numeric comparisons."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'SELECT COUNT(*)\nFROM "null_example"\nWHERE "numeric_value" < 2\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Druid returns 1. The ",(0,t.jsx)(n.code,{children:"null"})," values for examples 3 and 4 are excluded."]}),"\n",(0,t.jsx)(n.p,{children:"Additionally, be aware that null values do not behave as 0. For examples:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'SELECT numeric_value + 1\nFROM "null_example"\nWHERE "__time" > \'2024-01-01 01:04:00.000Z\'\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Druid returns ",(0,t.jsx)(n.code,{children:"null"})," and not 1. One option is to use the COALESCE function for null handling. For example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'SELECT COALESCE(numeric_value, 0) + 1\nFROM "null_example"\nWHERE "__time" > \'2024-01-01 01:04:00.000Z\'\n'})}),"\n",(0,t.jsx)(n.p,{children:"In this case, Druid returns 1."}),"\n",(0,t.jsx)(n.h2,{id:"ingestion-time-filtering",children:"Ingestion time filtering"}),"\n",(0,t.jsx)(n.p,{children:"The same null handling rules apply at ingestion time.\nThe following query replaces the example data with data filtered with a WHERE clause:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'REPLACE INTO "null_example" OVERWRITE ALL\nWITH "ext" AS (\n  SELECT *\n  FROM TABLE(\n    EXTERN(\n      \'{"type":"inline","data":"{\\"date\\": \\"1/1/2024 1:02:00\\",\\"title\\": \\"example_1\\",\\"string_value\\": \\"some_value\\",\\"numeric_value\\": 1}\\n{\\"date\\": \\"1/1/2024 1:03:00\\",\\"title\\": \\"example_2\\",\\"string_value\\": \\"another_value\\",\\"numeric_value\\": 2}\\n{\\"date\\": \\"1/1/2024 1:04:00\\",\\"title\\": \\"example_3\\",\\"string_value\\": \\"\\", \\"numeric_value\\": null}\\n{\\"date\\": \\"1/1/2024 1:05:00\\",\\"title\\": \\"example_4\\",\\"string_value\\": null, \\"numeric_value\\": null}"}\',\n      \'{"type":"json"}\'\n    )\n  ) EXTEND ("date" VARCHAR, "title" VARCHAR, "string_value" VARCHAR, "numeric_value" BIGINT)\n)\nSELECT\n  TIME_PARSE("date", \'d/M/yyyy H:mm:ss\') AS "__time",\n  "title",\n  "string_value",\n  "numeric_value"\nFROM "ext"\nWHERE "string_value" != \'some_value\'\nPARTITIONED BY DAY\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The resulting data set only includes two rows. Druid has filtered out example 1 (",(0,t.jsx)(n.code,{children:"some_value"}),") and example 4 (",(0,t.jsx)(n.code,{children:"null"}),"):"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:(0,t.jsx)(n.code,{children:"__time"})}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.code,{children:"title"})}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.code,{children:"string_value"})}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.code,{children:"numeric_value"})})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"2024-01-01T01:03:00.000Z"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"example_2"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"another_value"})}),(0,t.jsx)(n.td,{children:"2"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"2024-01-01T01:04:00.000Z"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"example_3"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"empty"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"null"})})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"learn-more",children:"Learn more"}),"\n",(0,t.jsx)(n.p,{children:"See the following for more information:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/latest/querying/sql-data-types#null-values",children:"Null values"})}),"\n",(0,t.jsxs)(n.li,{children:['"Generating and working with NULL values" notebook at ',(0,t.jsx)(n.a,{href:"https://github.com/implydata/learn-druid/",children:"Learn druid"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}}}]);