"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5575],{28453:(e,n,t)=>{t.d(n,{R:()=>d,x:()=>a});var r=t(96540);const s={},i=r.createContext(s);function d(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),r.createElement(i.Provider,{value:n},e.children)}},42700:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"tutorials/tutorial-update-data","title":"Update data","description":"Learn how to update data in Apache Druid.","source":"@site/docs/33.0.0/tutorials/tutorial-update-data.md","sourceDirName":"tutorials","slug":"/tutorials/tutorial-update-data","permalink":"/docs/33.0.0/tutorials/tutorial-update-data","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"tutorial-update-data","title":"Update data","sidebar_label":"Update data","description":"Learn how to update data in Apache Druid."},"sidebar":"docs","previous":{"title":"Append data","permalink":"/docs/33.0.0/tutorials/tutorial-append-data"},"next":{"title":"Compact segments","permalink":"/docs/33.0.0/tutorials/tutorial-compaction"}}');var s=t(74848),i=t(28453);const d={id:"tutorial-update-data",title:"Update data",sidebar_label:"Update data",description:"Learn how to update data in Apache Druid."},a=void 0,l={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Load sample data",id:"load-sample-data",level:2},{value:"Overwrite all data",id:"overwrite-all-data",level:2},{value:"Overwrite records for a specific time range",id:"overwrite-records-for-a-specific-time-range",level:2},{value:"Update a row using partial segment overshadowing",id:"update-a-row-using-partial-segment-overshadowing",level:2},{value:"Learn more",id:"learn-more",level:2}];function o(e){const n={a:"a",br:"br",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["Apache Druid stores data and indexes in ",(0,s.jsx)(n.a,{href:"/docs/33.0.0/design/segments",children:"segment files"})," partitioned by time.\nAfter Druid creates a segment, its contents can't be modified.\nYou can either replace data for the whole segment, or, in some cases, overshadow a portion of the segment data."]}),"\n",(0,s.jsx)(n.p,{children:"In Druid, use time ranges to specify the data you want to update, as opposed to a primary key or dimensions often used in transactional databases. Data outside the specified replacement time range remains unaffected.\nYou can use this Druid functionality to perform data updates, inserts, and deletes, similar to UPSERT functionality for transactional databases."}),"\n",(0,s.jsxs)(n.p,{children:["This tutorial shows you how to use the Druid SQL ",(0,s.jsx)(n.a,{href:"/docs/33.0.0/multi-stage-query/reference#replace",children:"REPLACE"})," function with the OVERWRITE clause to update existing data."]}),"\n",(0,s.jsx)(n.p,{children:"The tutorial walks you through the following use cases:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#overwrite-all-data",children:"Overwrite all data"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#overwrite-records-for-a-specific-time-range",children:"Overwrite records for a specific time range"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#update-a-row-using-partial-segment-overshadowing",children:"Update a row using partial segment overshadowing"})}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["All examples use the ",(0,s.jsx)(n.a,{href:"/docs/33.0.0/multi-stage-query/",children:"multi-stage query (MSQ)"})," task engine to executes SQL statements."]}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(n.p,{children:["Before you follow the steps in this tutorial, download Druid as described in ",(0,s.jsx)(n.a,{href:"/docs/33.0.0/tutorials/",children:"Quickstart (local)"})," and have it running on your local machine. You don't need to load any data into the Druid cluster."]}),"\n",(0,s.jsxs)(n.p,{children:["You should be familiar with data querying in Druid. If you haven't already, go through the ",(0,s.jsx)(n.a,{href:"/docs/33.0.0/tutorials/tutorial-query",children:"Query data"})," tutorial first."]}),"\n",(0,s.jsx)(n.h2,{id:"load-sample-data",children:"Load sample data"}),"\n",(0,s.jsxs)(n.p,{children:["Load a sample dataset using ",(0,s.jsx)(n.a,{href:"/docs/33.0.0/multi-stage-query/reference#replace",children:"REPLACE"})," and ",(0,s.jsx)(n.a,{href:"/docs/33.0.0/multi-stage-query/reference#extern-function",children:"EXTERN"})," functions.\nIn Druid SQL, the REPLACE function can create a new ",(0,s.jsx)(n.a,{href:"/docs/33.0.0/design/storage",children:"datasource"})," or update an existing datasource."]}),"\n",(0,s.jsxs)(n.p,{children:["In the Druid ",(0,s.jsx)(n.a,{href:"/docs/33.0.0/operations/web-console",children:"web console"}),", go to the ",(0,s.jsx)(n.strong,{children:"Query"})," view and run the following query:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'REPLACE INTO "update_tutorial" OVERWRITE ALL\nWITH "ext" AS (\n  SELECT *\n  FROM TABLE(\n    EXTERN(\n     \'{"type":"inline","data":"{\\"timestamp\\":\\"2024-01-01T07:01:35Z\\",\\"animal\\":\\"octopus\\", \\"number\\":115}\\n{\\"timestamp\\":\\"2024-01-01T05:01:35Z\\",\\"animal\\":\\"mongoose\\", \\"number\\":737}\\n{\\"timestamp\\":\\"2024-01-01T06:01:35Z\\",\\"animal\\":\\"snake\\", \\"number\\":1234}\\n{\\"timestamp\\":\\"2024-01-01T01:01:35Z\\",\\"animal\\":\\"lion\\", \\"number\\":300}\\n{\\"timestamp\\":\\"2024-01-02T07:01:35Z\\",\\"animal\\":\\"seahorse\\", \\"number\\":115}\\n{\\"timestamp\\":\\"2024-01-02T05:01:35Z\\",\\"animal\\":\\"skunk\\", \\"number\\":737}\\n{\\"timestamp\\":\\"2024-01-02T06:01:35Z\\",\\"animal\\":\\"iguana\\", \\"number\\":1234}\\n{\\"timestamp\\":\\"2024-01-02T01:01:35Z\\",\\"animal\\":\\"opossum\\", \\"number\\":300}"}\',\n     \'{"type":"json"}\'\n    )\n  ) EXTEND ("timestamp" VARCHAR, "animal" VARCHAR, "number" BIGINT)\n)\nSELECT\n  TIME_PARSE("timestamp") AS "__time",\n  "animal",\n  "number"\nFROM "ext"\nPARTITIONED BY DAY\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["In the resulting ",(0,s.jsx)(n.code,{children:"update_tutorial"})," datasource, individual rows are uniquely identified by ",(0,s.jsx)(n.code,{children:"__time"}),", ",(0,s.jsx)(n.code,{children:"animal"}),", and ",(0,s.jsx)(n.code,{children:"number"}),".\nTo view the results, open a new tab and run the following query:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'SELECT * FROM "update_tutorial"\n'})}),"\n",(0,s.jsxs)(t,{children:[(0,s.jsx)("summary",{children:" View the results"}),(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:(0,s.jsx)(n.code,{children:"__time"})}),(0,s.jsx)(n.th,{children:(0,s.jsx)(n.code,{children:"animal"})}),(0,s.jsx)(n.th,{children:(0,s.jsx)(n.code,{children:"number"})})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-01T01:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"lion"})}),(0,s.jsx)(n.td,{children:"300"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-01T05:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"mongoose"})}),(0,s.jsx)(n.td,{children:"737"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-01T06:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"snake"})}),(0,s.jsx)(n.td,{children:"1234"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-01T07:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"octopus"})}),(0,s.jsx)(n.td,{children:"115"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-02T01:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"opossum"})}),(0,s.jsx)(n.td,{children:"300"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-02T05:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"skunk"})}),(0,s.jsx)(n.td,{children:"737"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-02T06:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"iguana"})}),(0,s.jsx)(n.td,{children:"1234"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-02T07:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"seahorse"})}),(0,s.jsx)(n.td,{children:"115"})]})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"The results contain records for eight animals over two days."}),"\n",(0,s.jsx)(n.h2,{id:"overwrite-all-data",children:"Overwrite all data"}),"\n",(0,s.jsx)(n.p,{children:"You can use the REPLACE function with OVERWRITE ALL to replace the entire datasource with new data while dropping the old data."}),"\n",(0,s.jsxs)(n.p,{children:["In the web console, open a new tab and run the following query to overwrite timestamp data for the entire ",(0,s.jsx)(n.code,{children:"update_tutorial"})," datasource:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'REPLACE INTO "update_tutorial" OVERWRITE ALL\nWITH "ext" AS (SELECT *\nFROM TABLE(\n  EXTERN(\n    \'{"type":"inline","data":"{\\"timestamp\\":\\"2024-01-02T07:01:35Z\\",\\"animal\\":\\"octopus\\", \\"number\\":115}\\n{\\"timestamp\\":\\"2024-01-02T05:01:35Z\\",\\"animal\\":\\"mongoose\\", \\"number\\":737}\\n{\\"timestamp\\":\\"2024-01-02T06:01:35Z\\",\\"animal\\":\\"snake\\", \\"number\\":1234}\\n{\\"timestamp\\":\\"2024-01-02T01:01:35Z\\",\\"animal\\":\\"lion\\", \\"number\\":300}\\n{\\"timestamp\\":\\"2024-01-03T07:01:35Z\\",\\"animal\\":\\"seahorse\\", \\"number\\":115}\\n{\\"timestamp\\":\\"2024-01-03T05:01:35Z\\",\\"animal\\":\\"skunk\\", \\"number\\":737}\\n{\\"timestamp\\":\\"2024-01-03T06:01:35Z\\",\\"animal\\":\\"iguana\\", \\"number\\":1234}\\n{\\"timestamp\\":\\"2024-01-03T01:01:35Z\\",\\"animal\\":\\"opossum\\", \\"number\\":300}"}\',\n    \'{"type":"json"}\'\n  )\n) EXTEND ("timestamp" VARCHAR, "animal" VARCHAR, "number" BIGINT))\nSELECT\n  TIME_PARSE("timestamp") AS "__time",\n  "animal",\n  "number"\nFROM "ext"\nPARTITIONED BY DAY\n'})}),"\n",(0,s.jsxs)(t,{children:[(0,s.jsx)("summary",{children:" View the results"}),(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:(0,s.jsx)(n.code,{children:"__time"})}),(0,s.jsx)(n.th,{children:(0,s.jsx)(n.code,{children:"animal"})}),(0,s.jsx)(n.th,{children:(0,s.jsx)(n.code,{children:"number"})})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-02T01:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"lion"})}),(0,s.jsx)(n.td,{children:"300"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-02T05:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"mongoose"})}),(0,s.jsx)(n.td,{children:"737"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-02T06:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"snake"})}),(0,s.jsx)(n.td,{children:"1234"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-02T07:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"octopus"})}),(0,s.jsx)(n.td,{children:"115"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-03T01:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"opossum"})}),(0,s.jsx)(n.td,{children:"300"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-03T05:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"skunk"})}),(0,s.jsx)(n.td,{children:"737"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-03T06:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"iguana"})}),(0,s.jsx)(n.td,{children:"1234"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-03T07:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"seahorse"})}),(0,s.jsx)(n.td,{children:"115"})]})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["Note that the values in the ",(0,s.jsx)(n.code,{children:"__time"})," column have changed to one day later."]}),"\n",(0,s.jsx)(n.h2,{id:"overwrite-records-for-a-specific-time-range",children:"Overwrite records for a specific time range"}),"\n",(0,s.jsx)(n.p,{children:"You can use the REPLACE function to overwrite a specific time range of a datasource. When you overwrite a specific time range, that time range must align with the granularity specified in the PARTITIONED BY clause."}),"\n",(0,s.jsx)(n.p,{children:"In the web console, open a new tab and run the following query to insert a new row and update specific rows. Note that the OVERWRITE WHERE clause tells the query to only update records for the date 2024-01-03."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'REPLACE INTO "update_tutorial" \n  OVERWRITE WHERE "__time" >= TIMESTAMP\'2024-01-03 00:00:00\' AND "__time" < TIMESTAMP\'2024-01-04 00:00:00\'\nWITH "ext" AS (SELECT *\nFROM TABLE(\n  EXTERN(\n    \'{"type":"inline","data":"{\\"timestamp\\":\\"2024-01-03T01:01:35Z\\",\\"animal\\":\\"tiger\\", \\"number\\":300}\\n{\\"timestamp\\":\\"2024-01-03T07:01:35Z\\",\\"animal\\":\\"seahorse\\", \\"number\\":500}\\n{\\"timestamp\\":\\"2024-01-03T05:01:35Z\\",\\"animal\\":\\"polecat\\", \\"number\\":626}\\n{\\"timestamp\\":\\"2024-01-03T06:01:35Z\\",\\"animal\\":\\"iguana\\", \\"number\\":300}\\n{\\"timestamp\\":\\"2024-01-03T01:01:35Z\\",\\"animal\\":\\"flamingo\\", \\"number\\":999}"}\',\n    \'{"type":"json"}\'\n  )\n) EXTEND ("timestamp" VARCHAR, "animal" VARCHAR, "number" BIGINT))\nSELECT\n  TIME_PARSE("timestamp") AS "__time",\n  "animal",\n  "number"\nFROM "ext"\nPARTITIONED BY DAY\n'})}),"\n",(0,s.jsxs)(t,{children:[(0,s.jsx)("summary",{children:" View the results"}),(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:(0,s.jsx)(n.code,{children:"__time"})}),(0,s.jsx)(n.th,{children:(0,s.jsx)(n.code,{children:"animal"})}),(0,s.jsx)(n.th,{children:(0,s.jsx)(n.code,{children:"number"})})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-02T01:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"lion"})}),(0,s.jsx)(n.td,{children:"300"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-02T05:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"mongoose"})}),(0,s.jsx)(n.td,{children:"737"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-02T06:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"snake"})}),(0,s.jsx)(n.td,{children:"1234"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-02T07:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"octopus"})}),(0,s.jsx)(n.td,{children:"115"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-03T01:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"flamingo"})}),(0,s.jsx)(n.td,{children:"999"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-03T01:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"tiger"})}),(0,s.jsx)(n.td,{children:"300"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-03T05:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"polecat"})}),(0,s.jsx)(n.td,{children:"626"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-03T06:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"iguana"})}),(0,s.jsx)(n.td,{children:"300"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-03T07:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"seahorse"})}),(0,s.jsx)(n.td,{children:"500"})]})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"Note the changes in the resulting datasource:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["There is now a new row called ",(0,s.jsx)(n.code,{children:"flamingo"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.code,{children:"opossum"})," row has the value ",(0,s.jsx)(n.code,{children:"tiger"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.code,{children:"skunk"})," row has the value ",(0,s.jsx)(n.code,{children:"polecat"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.code,{children:"iguana"})," and ",(0,s.jsx)(n.code,{children:"seahorse"})," rows have different numbers."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"update-a-row-using-partial-segment-overshadowing",children:"Update a row using partial segment overshadowing"}),"\n",(0,s.jsxs)(n.p,{children:["In Druid, you can overlay older data with newer data for the entire segment or portions of the segment within a particular partition.\nThis capability is called ",(0,s.jsx)(n.a,{href:"/docs/33.0.0/ingestion/tasks#overshadowing-between-segments",children:"overshadowing"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"You can use partial overshadowing to update a single row by adding a smaller time granularity segment on top of the existing data.\nIt's a less common variation on a more common approach where you replace the entire time chunk."}),"\n",(0,s.jsxs)(n.p,{children:["The following example demonstrates how update data using partial overshadowing with mixed segment granularity.",(0,s.jsx)(n.br,{}),"\n","Note the following important points about the example:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The query updates a single record for a specific ",(0,s.jsx)(n.code,{children:"number"})," row."]}),"\n",(0,s.jsx)(n.li,{children:"The original datasource uses DAY segment granularity."}),"\n",(0,s.jsx)(n.li,{children:"The new data segment is at HOUR granularity and represents a time range that's smaller than the existing data."}),"\n",(0,s.jsx)(n.li,{children:"The OVERWRITE WHERE and WHERE TIME_IN_INTERVAL clauses specify the destination where the update occurs and the source of the update, respectively."}),"\n",(0,s.jsxs)(n.li,{children:["The query replaces everything within the specified interval. To update only a subset of data in that interval, you have to carry forward all records, changing only what you want to change. You can accomplish that by using the ",(0,s.jsx)(n.a,{href:"/docs/33.0.0/querying/sql-functions#case",children:"CASE"})," function in the SELECT list."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'REPLACE INTO "update_tutorial"\n   OVERWRITE\n       WHERE "__time" >= TIMESTAMP\'2024-01-03 05:00:00\' AND "__time" < TIMESTAMP\'2024-01-03 06:00:00\'\nSELECT \n   "__time", \n   "animal", \n   CAST(486 AS BIGINT) AS "number"\nFROM "update_tutorial" \nWHERE TIME_IN_INTERVAL("__time", \'2024-01-03T05:01:35Z/PT1S\')\nPARTITIONED BY FLOOR(__time TO HOUR)\n'})}),"\n",(0,s.jsxs)(t,{children:[(0,s.jsx)("summary",{children:" View the results"}),(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:(0,s.jsx)(n.code,{children:"__time"})}),(0,s.jsx)(n.th,{children:(0,s.jsx)(n.code,{children:"animal"})}),(0,s.jsx)(n.th,{children:(0,s.jsx)(n.code,{children:"number"})})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-02T01:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"lion"})}),(0,s.jsx)(n.td,{children:"300"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-02T05:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"mongoose"})}),(0,s.jsx)(n.td,{children:"737"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-02T06:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"snake"})}),(0,s.jsx)(n.td,{children:"1234"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-02T07:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"octopus"})}),(0,s.jsx)(n.td,{children:"115"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-03T01:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"flamingo"})}),(0,s.jsx)(n.td,{children:"999"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-03T01:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"tiger"})}),(0,s.jsx)(n.td,{children:"300"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-03T05:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"polecat"})}),(0,s.jsx)(n.td,{children:"486"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-03T06:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"iguana"})}),(0,s.jsx)(n.td,{children:"300"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2024-01-03T07:01:35.000Z"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"seahorse"})}),(0,s.jsx)(n.td,{children:"500"})]})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["Note that the ",(0,s.jsx)(n.code,{children:"number"})," for ",(0,s.jsx)(n.code,{children:"polecat"})," has changed from 626 to 486."]}),"\n",(0,s.jsxs)(n.p,{children:["When you perform partial segment overshadowing multiple times, you can create segment fragmentation that could affect query performance. Use ",(0,s.jsx)(n.a,{href:"/docs/33.0.0/data-management/compaction",children:"compaction"})," to correct any fragmentation."]}),"\n",(0,s.jsx)(n.h2,{id:"learn-more",children:"Learn more"}),"\n",(0,s.jsx)(n.p,{children:"See the following topics for more information:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/33.0.0/data-management/update",children:"Data updates"})," for an overview of updating data in Druid."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/33.0.0/tutorials/tutorial-msq-extern",children:"Load files with SQL-based ingestion"})," for generating a query that references externally hosted data."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/33.0.0/multi-stage-query/concepts#overwrite-data-with-replace",children:"Overwrite data with REPLACE"})," for details on how the MSQ task engine executes SQL REPLACE queries."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}}}]);