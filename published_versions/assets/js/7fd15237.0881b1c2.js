"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5012],{14137:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),m=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=m(e.components);return a.createElement(s.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=m(n),c=r,h=p["".concat(s,".").concat(c)]||p[c]||d[c]||i;return n?a.createElement(h,o(o({ref:t},u),{},{components:n})):a.createElement(h,o({ref:t},u))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:r,o[1]=l;for(var m=2;m<i;m++)o[m]=n[m];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},47206:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>m,toc:()=>p});var a=n(87462),r=n(63366),i=(n(67294),n(14137)),o=["components"],l={id:"tutorial-transform",title:"Transform input data",sidebar_label:"Transform input data"},s=void 0,m={unversionedId:"tutorials/tutorial-transform",id:"tutorials/tutorial-transform",title:"Transform input data",description:"\x3c!--",source:"@site/docs/31.0.0/tutorials/tutorial-transform.md",sourceDirName:"tutorials",slug:"/tutorials/tutorial-transform",permalink:"/docs/31.0.0/tutorials/tutorial-transform",draft:!1,tags:[],version:"current",frontMatter:{id:"tutorial-transform",title:"Transform input data",sidebar_label:"Transform input data"},sidebar:"docs",previous:{title:"Write an ingestion spec",permalink:"/docs/31.0.0/tutorials/tutorial-ingestion-spec"},next:{title:"Convert ingestion spec to SQL",permalink:"/docs/31.0.0/tutorials/tutorial-msq-convert-spec"}},u={},p=[{value:"Prerequisite",id:"prerequisite",level:2},{value:"Sample data",id:"sample-data",level:2},{value:"Transform data during ingestion",id:"transform-data-during-ingestion",level:2},{value:"Query the transformed data",id:"query-the-transformed-data",level:2},{value:"Learn more",id:"learn-more",level:2}],d={toc:p},c="wrapper";function h(e){var t=e.components,n=(0,r.Z)(e,o);return(0,i.kt)(c,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"This tutorial demonstrates how to transform input data during ingestion."),(0,i.kt)("h2",{id:"prerequisite"},"Prerequisite"),(0,i.kt)("p",null,"Before proceeding, download Apache Druid","\xae"," as described in ",(0,i.kt)("a",{parentName:"p",href:"/docs/31.0.0/tutorials/"},"Quickstart (local)")," and have it running on your local machine. You don't need to load any data into the Druid cluster."),(0,i.kt)("p",null,"You should be familiar with data querying in Druid. If you haven't already, go through the ",(0,i.kt)("a",{parentName:"p",href:"/docs/31.0.0/tutorials/tutorial-query"},"Query data")," tutorial first."),(0,i.kt)("h2",{id:"sample-data"},"Sample data"),(0,i.kt)("p",null,"For this tutorial, you use the following sample data:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{"timestamp":"2018-01-01T07:01:35Z", "animal":"octopus", "location":1, "number":100}\n{"timestamp":"2018-01-01T05:01:35Z", "animal":"mongoose", "location":2,"number":200}\n{"timestamp":"2018-01-01T06:01:35Z", "animal":"snake", "location":3, "number":300}\n{"timestamp":"2018-01-01T01:01:35Z", "animal":"lion", "location":4, "number":300}\n')),(0,i.kt)("h2",{id:"transform-data-during-ingestion"},"Transform data during ingestion"),(0,i.kt)("p",null,"Load the sample dataset using the ",(0,i.kt)("a",{parentName:"p",href:"/docs/31.0.0/multi-stage-query/reference/#insert"},(0,i.kt)("inlineCode",{parentName:"a"},"INSERT INTO"))," statement and the ",(0,i.kt)("a",{parentName:"p",href:"/docs/31.0.0/multi-stage-query/reference/#extern-function"},(0,i.kt)("inlineCode",{parentName:"a"},"EXTERN"))," function to ingest the data inline. In the ",(0,i.kt)("a",{parentName:"p",href:"/docs/31.0.0/operations/web-console"},"Druid web console"),", go to the ",(0,i.kt)("strong",{parentName:"p"},"Query")," view and run the following query:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},'INSERT INTO "transform_tutorial"\nWITH "ext" AS (\n  SELECT *\n  FROM TABLE(EXTERN(\'{"type":"inline","data":"{\\"timestamp\\":\\"2018-01-01T07:01:35Z\\",\\"animal\\":\\"octopus\\",  \\"location\\":1, \\"number\\":100}\\n{\\"timestamp\\":\\"2018-01-01T05:01:35Z\\",\\"animal\\":\\"mongoose\\", \\"location\\":2,\\"number\\":200}\\n{\\"timestamp\\":\\"2018-01-01T06:01:35Z\\",\\"animal\\":\\"snake\\", \\"location\\":3, \\"number\\":300}\\n{\\"timestamp\\":\\"2018-01-01T01:01:35Z\\",\\"animal\\":\\"lion\\", \\"location\\":4, \\"number\\":300}"}\', \'{"type":"json"}\')) EXTEND ("timestamp" VARCHAR, "animal" VARCHAR, "location" BIGINT, "number" BIGINT)\n)\nSELECT\n  TIME_PARSE("timestamp") AS "__time",\n  TEXTCAT(\'super-\', "animal") AS "animal",\n  "location",\n  "number",\n  "number" * 3 AS "triple-number"\nFROM "ext"\nWHERE (TEXTCAT(\'super-\', "animal") = \'super-mongoose\' OR "location" = 3 OR "number" = 100)\nPARTITIONED BY DAY\n')),(0,i.kt)("p",null,"In the ",(0,i.kt)("inlineCode",{parentName:"p"},"SELECT")," clause, you specify the following transformations:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"animal"),': prepends "super-" to the values in the ',(0,i.kt)("inlineCode",{parentName:"li"},"animal")," column using the ",(0,i.kt)("a",{parentName:"li",href:"/docs/31.0.0/querying/sql-functions/#textcat"},(0,i.kt)("inlineCode",{parentName:"a"},"TEXTCAT"))," function. Note that it only ingests the transformed data."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"triple-number"),": multiplies the ",(0,i.kt)("inlineCode",{parentName:"li"},"number")," column by three and stores the results in a column named ",(0,i.kt)("inlineCode",{parentName:"li"},"triple-number"),". Note that the query ingests both the original and the transformed data.")),(0,i.kt)("p",null,"Additionally, the ",(0,i.kt)("inlineCode",{parentName:"p"},"WHERE")," clause applies the following three OR operators so that the query only ingests the rows where at least one of the following conditions is ",(0,i.kt)("inlineCode",{parentName:"p"},"true"),":"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"TEXTCAT('super-', \"animal\")"),' matches "super-mongoose"'),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"location")," matches 3"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"number")," matches 100")),(0,i.kt)("p",null,"Once a row passes the filter, the ingestion job applies the transformations. In this example, the filter selects the first three rows because each row meets at least one of the required OR conditions. For the selected rows, the ingestion job ingests the transformed ",(0,i.kt)("inlineCode",{parentName:"p"},"animal")," column, the ",(0,i.kt)("inlineCode",{parentName:"p"},"location")," column, and both the original ",(0,i.kt)("inlineCode",{parentName:"p"},"number")," and the transformed ",(0,i.kt)("inlineCode",{parentName:"p"},"triple-number"),' column. The "lion" row doesn\'t meet any of the conditions, so it is not ingested or transformed.'),(0,i.kt)("h2",{id:"query-the-transformed-data"},"Query the transformed data"),(0,i.kt)("p",null,"In the web console, open a new tab in the ",(0,i.kt)("strong",{parentName:"p"},"Query")," view. Run the following query to view the ingested data:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},'SELECT * FROM "transform_tutorial"\n')),(0,i.kt)("p",null,"Returns the following:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"th"},"__time")),(0,i.kt)("th",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"th"},"animal")),(0,i.kt)("th",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"th"},"location")),(0,i.kt)("th",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"th"},"number")),(0,i.kt)("th",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"th"},"triple-number")))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"2018-01-01T05:01:35.000Z")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"super-mongoose")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"2")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"200")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"600"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"2018-01-01T06:01:35.000Z")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"super-snake")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"3")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"300")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"900"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"2018-01-01T07:01:35.000Z")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"super-octopus")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"1")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"100")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"300"))))),(0,i.kt)("p",null,'Notice how the "lion" row is missing, and how the other three rows that were ingested have transformations applied to them.'),(0,i.kt)("h2",{id:"learn-more"},"Learn more"),(0,i.kt)("p",null,"See the following topics for more information:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/31.0.0/querying/sql-functions"},"All functions")," for a list of functions that can be used to transform data. "),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/31.0.0/ingestion/ingestion-spec/#transformspec"},"Transform spec reference")," to learn more about transforms in JSON-based batch ingestion."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/docs/31.0.0/querying/sql#where"},"WHERE clause")," to learn how to specify filters in Druid SQL.")))}h.isMDXComponent=!0}}]);