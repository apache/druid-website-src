"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2931],{12393:(e,d,i)=>{i.r(d),i.d(d,{assets:()=>h,contentTitle:()=>l,default:()=>j,frontMatter:()=>c,metadata:()=>n,toc:()=>t});const n=JSON.parse('{"id":"querying/sql-window-functions","title":"Window functions","description":"Reference for window functions","source":"@site/docs/33.0.0/querying/sql-window-functions.md","sourceDirName":"querying","slug":"/querying/sql-window-functions","permalink":"/docs/33.0.0/querying/sql-window-functions","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"sql-window-functions","title":"Window functions","description":"Reference for window functions"},"sidebar":"docs","previous":{"title":"Aggregation functions","permalink":"/docs/33.0.0/querying/sql-aggregations"},"next":{"title":"Array functions","permalink":"/docs/33.0.0/querying/sql-array-functions"}}');var s=i(74848),r=i(28453);const c={id:"sql-window-functions",title:"Window functions",description:"Reference for window functions"},l=void 0,h={},t=[{value:"Window function syntax",id:"window-function-syntax",level:2},{value:"ORDER BY windows",id:"order-by-windows",level:3},{value:"PARTITION BY windows",id:"partition-by-windows",level:3},{value:"Window frame guardrails",id:"window-frame-guardrails",level:4},{value:"Window function reference",id:"window-function-reference",level:2},{value:"Examples",id:"examples",level:2},{value:"Example with window frames",id:"example-with-window-frames",level:3},{value:"Known issues",id:"known-issues",level:2}];function x(e){const d={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components},{Details:i}=d;return i||function(e,d){throw new Error("Expected "+(d?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.admonition,{type:"info",children:(0,s.jsxs)(d.p,{children:["Apache Druid supports two query languages: ",(0,s.jsx)(d.a,{href:"/docs/33.0.0/querying/sql",children:"Druid SQL"})," and ",(0,s.jsx)(d.a,{href:"/docs/33.0.0/querying/",children:"native queries"}),".\nThis document describes the SQL language."]})}),"\n",(0,s.jsx)(d.p,{children:"Window functions in Apache Druid produce values based upon the relationship of one row within a window of rows to the other rows within the same window. A window is a group of related rows within a result set. For example, rows with the same value for a specific dimension."}),"\n",(0,s.jsx)(d.p,{children:"Window functions in Druid require a GROUP BY statement. Druid performs the row-level aggregations for the GROUP BY before performing the window function calculations."}),"\n",(0,s.jsxs)(d.p,{children:["The following example organizes results with the same ",(0,s.jsx)(d.code,{children:"channel"})," value into windows. For each window, the query returns the rank of each row in ascending order based upon its ",(0,s.jsx)(d.code,{children:"changed"})," value."]}),"\n",(0,s.jsx)(d.pre,{children:(0,s.jsx)(d.code,{className:"language-sql",children:"SELECT FLOOR(__time TO DAY) AS event_time,\n    channel,\n    ABS(delta) AS change,\n    RANK() OVER w AS rank_value\nFROM wikipedia\nWHERE channel in ('#kk.wikipedia', '#lt.wikipedia')\nAND '2016-06-28' > FLOOR(__time TO DAY) > '2016-06-26'\nGROUP BY channel, ABS(delta), __time\nWINDOW w AS (PARTITION BY channel ORDER BY ABS(delta) ASC)\n"})}),"\n",(0,s.jsxs)(i,{children:[(0,s.jsx)("summary",{children:" View results "}),(0,s.jsxs)(d.table,{children:[(0,s.jsx)(d.thead,{children:(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"event_time"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"channel"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"change"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"rank_value"})})]})}),(0,s.jsxs)(d.tbody,{children:[(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"1"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"1"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"7"}),(0,s.jsx)(d.td,{children:"3"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"56"}),(0,s.jsx)(d.td,{children:"4"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"56"}),(0,s.jsx)(d.td,{children:"4"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"63"}),(0,s.jsx)(d.td,{children:"6"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"91"}),(0,s.jsx)(d.td,{children:"7"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"2440"}),(0,s.jsx)(d.td,{children:"8"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"2703"}),(0,s.jsx)(d.td,{children:"9"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"6900"}),(0,s.jsx)(d.td,{children:"10"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"1"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"2"}),(0,s.jsx)(d.td,{children:"2"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"13"}),(0,s.jsx)(d.td,{children:"3"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"28"}),(0,s.jsx)(d.td,{children:"4"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"53"}),(0,s.jsx)(d.td,{children:"5"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"56"}),(0,s.jsx)(d.td,{children:"6"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"59"}),(0,s.jsx)(d.td,{children:"7"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"391"}),(0,s.jsx)(d.td,{children:"8"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"894"}),(0,s.jsx)(d.td,{children:"9"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"4358"}),(0,s.jsx)(d.td,{children:"10"})]})]})]})]}),"\n",(0,s.jsxs)(d.p,{children:["Window functions are similar to ",(0,s.jsx)(d.a,{href:"/docs/33.0.0/querying/aggregations",children:"aggregation functions"}),"."]}),"\n",(0,s.jsx)(d.p,{children:"You can use the OVER clause to treat other Druid aggregation functions as window functions. For example, the sum of a value for rows within a window."}),"\n",(0,s.jsx)(d.p,{children:"Window functions support aliasing."}),"\n",(0,s.jsx)(d.h2,{id:"window-function-syntax",children:"Window function syntax"}),"\n",(0,s.jsx)(d.p,{children:"You can write a window function in Druid using either syntax below.\nThe second syntax shows a window alias to reference a window that you can reuse."}),"\n",(0,s.jsx)(d.pre,{children:(0,s.jsx)(d.code,{className:"language-sql",children:"window_function() OVER (\n  [PARTITION BY partitioning expression]\n  [ORDER BY order expression]\n  [[ROWS, RANGE] BETWEEN range start AND range end])\nFROM table\nGROUP BY dimensions\n"})}),"\n",(0,s.jsx)(d.pre,{children:(0,s.jsx)(d.code,{className:"language-sql",children:"window_function() OVER w\nFROM table\nWINDOW w AS ([PARTITION BY partitioning expression] [ORDER BY order expression]\n  [[ROWS, RANGE] BETWEEN range start AND range end])\nGROUP BY dimensions\n"})}),"\n",(0,s.jsx)(d.p,{children:"The OVER clause defines the query windows for window functions as follows:"}),"\n",(0,s.jsxs)(d.ul,{children:["\n",(0,s.jsx)(d.li,{children:"PARTITION BY indicates the dimension that defines window boundaries"}),"\n",(0,s.jsx)(d.li,{children:"ORDER BY specifies the order of the rows within the windows"}),"\n"]}),"\n",(0,s.jsx)(d.p,{children:"An empty OVER clause or the absence of a PARTITION BY clause indicates that all data belongs to a single window."}),"\n",(0,s.jsxs)(d.p,{children:["In the following example, the following OVER clause example sets the window dimension to ",(0,s.jsx)(d.code,{children:"channel"})," and orders the results by the absolute value of ",(0,s.jsx)(d.code,{children:"delta"})," ascending:"]}),"\n",(0,s.jsx)(d.pre,{children:(0,s.jsx)(d.code,{className:"language-sql",children:"...\nRANK() OVER (PARTITION BY channel ORDER BY ABS(delta) ASC)\n...\n"})}),"\n",(0,s.jsx)(d.p,{children:"Window frames, set in ROWS and RANGE expressions, limit the set of rows used for the windowed aggregation."}),"\n",(0,s.jsxs)(d.p,{children:["ROWS and RANGE accept the following values for ",(0,s.jsx)(d.code,{children:"range start"})," and ",(0,s.jsx)(d.code,{children:"range end"}),":"]}),"\n",(0,s.jsxs)(d.ul,{children:["\n",(0,s.jsx)(d.li,{children:"UNBOUNDED PRECEDING: from the beginning of the window as ordered by the order expression"}),"\n",(0,s.jsxs)(d.li,{children:[(0,s.jsx)(d.em,{children:"N"})," ROWS PRECEDING: ",(0,s.jsx)(d.em,{children:"N"})," rows before the current row as ordered by the order expression"]}),"\n",(0,s.jsx)(d.li,{children:"CURRENT ROW: the current row"}),"\n",(0,s.jsxs)(d.li,{children:[(0,s.jsx)(d.em,{children:"N"})," ROWS FOLLOWING: ",(0,s.jsx)(d.em,{children:"N"})," rows after the current row as ordered by the order expression"]}),"\n",(0,s.jsx)(d.li,{children:"UNBOUNDED FOLLOWING: to the end of the window as ordered by the order expression"}),"\n"]}),"\n",(0,s.jsxs)(d.p,{children:["See ",(0,s.jsx)(d.a,{href:"#example-with-window-frames",children:"Example with window frames"})," for more detail."]}),"\n",(0,s.jsx)(d.p,{children:"Druid applies the GROUP BY dimensions before calculating all non-window aggregation functions. Then it applies the window function over the aggregated results."}),"\n",(0,s.jsx)(d.admonition,{type:"note",children:(0,s.jsx)(d.p,{children:"Sometimes windows are called partitions. However, the partitioning for window functions are a shuffle (partition) of the result set created at query time and is not to be confused with Druid's segment partitioning feature which partitions data at ingest time."})}),"\n",(0,s.jsx)(d.h3,{id:"order-by-windows",children:"ORDER BY windows"}),"\n",(0,s.jsx)(d.p,{children:"When the window definition only specifies ORDER BY and not PARTITION BY, it sorts the aggregate data set and applies the function in that order."}),"\n",(0,s.jsxs)(d.p,{children:["The following query uses ",(0,s.jsx)(d.code,{children:"ORDER BY SUM(delta) DESC"})," to rank user hourly activity from the most changed the least changed within an hour:"]}),"\n",(0,s.jsx)(d.pre,{children:(0,s.jsx)(d.code,{className:"language-sql",children:"SELECT\n    TIME_FLOOR(__time, 'PT1H') as time_hour, \n    channel, \n    user,\n    SUM(delta) net_user_changes,\n    RANK() OVER (ORDER BY SUM(delta) DESC) AS editing_rank\nFROM \"wikipedia\"\nWHERE channel IN ('#kk.wikipedia', '#lt.wikipedia')\n  AND __time BETWEEN '2016-06-27' AND '2016-06-28'\nGROUP BY TIME_FLOOR(__time, 'PT1H'), channel, user\nORDER BY 5 \n"})}),"\n",(0,s.jsxs)(i,{children:[(0,s.jsx)("summary",{children:" View results "}),(0,s.jsxs)(d.table,{children:[(0,s.jsx)(d.thead,{children:(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"time_hour"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"channel"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"user"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"net_user_changes"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"editing_rank"})})]})}),(0,s.jsxs)(d.tbody,{children:[(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T15:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"Nurkhan"})}),(0,s.jsx)(d.td,{children:"6900"}),(0,s.jsx)(d.td,{children:"1"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T19:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"77.221.66.41"})}),(0,s.jsx)(d.td,{children:"4358"}),(0,s.jsx)(d.td,{children:"2"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T09:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"\u0421\u0430\u043b\u0438\u0445\u0430"})}),(0,s.jsx)(d.td,{children:"2702"}),(0,s.jsx)(d.td,{children:"3"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T04:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"Nurkhan"})}),(0,s.jsx)(d.td,{children:"2440"}),(0,s.jsx)(d.td,{children:"4"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T09:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"80.4.147.222"})}),(0,s.jsx)(d.td,{children:"894"}),(0,s.jsx)(d.td,{children:"5"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T09:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"178.11.203.212"})}),(0,s.jsx)(d.td,{children:"447"}),(0,s.jsx)(d.td,{children:"6"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T11:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"\u041d\u04b1\u0440\u043b\u0430\u043d \u0420\u0430\u0445\u044b\u043c\u0436\u0430\u043d\u043e\u0432"})}),(0,s.jsx)(d.td,{children:"126"}),(0,s.jsx)(d.td,{children:"7"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T06:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"\u0428\u043e\u043a\u0430\u0439"})}),(0,s.jsx)(d.td,{children:"91"}),(0,s.jsx)(d.td,{children:"8"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T11:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"MaryroseB54"})}),(0,s.jsx)(d.td,{children:"59"}),(0,s.jsx)(d.td,{children:"9"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T04:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"\u041d\u04b1\u0440\u043b\u0430\u043d \u0420\u0430\u0445\u044b\u043c\u0436\u0430\u043d\u043e\u0432"})}),(0,s.jsx)(d.td,{children:"56"}),(0,s.jsx)(d.td,{children:"10"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T12:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"Karoliuk"})}),(0,s.jsx)(d.td,{children:"53"}),(0,s.jsx)(d.td,{children:"11"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T12:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"Powermelon"})}),(0,s.jsx)(d.td,{children:"28"}),(0,s.jsx)(d.td,{children:"12"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T07:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"Powermelon"})}),(0,s.jsx)(d.td,{children:"13"}),(0,s.jsx)(d.td,{children:"13"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T10:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"80.4.147.222"})}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"14"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T07:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"\u0421\u0430\u043b\u0438\u0445\u0430"})}),(0,s.jsx)(d.td,{children:"-1"}),(0,s.jsx)(d.td,{children:"15"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T06:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"Powermelon"})}),(0,s.jsx)(d.td,{children:"-2"}),(0,s.jsx)(d.td,{children:"16"})]})]})]})]}),"\n",(0,s.jsx)(d.h3,{id:"partition-by-windows",children:"PARTITION BY windows"}),"\n",(0,s.jsx)(d.p,{children:"When a window only specifies PARTITION BY partition expression, Druid calculates the aggregate window function over all the rows that share a value within the selected dataset."}),"\n",(0,s.jsxs)(d.p,{children:["The following example demonstrates a query that uses two different windows\u2014",(0,s.jsx)(d.code,{children:"PARTITION BY channel"})," and ",(0,s.jsx)(d.code,{children:"PARTITION BY user"}),"\u2014to calculate the total activity in the channel and total activity by the user so that they can be compared to individual hourly activity:"]}),"\n",(0,s.jsx)(d.pre,{children:(0,s.jsx)(d.code,{className:"language-sql",children:"SELECT\n    TIME_FLOOR(__time, 'PT1H') as time_hour,\n    channel,\n    user,\n    SUM(delta) AS hourly_user_changes,\n    SUM(SUM(delta)) OVER (PARTITION BY user) AS total_user_changes,\n    SUM(SUM(delta)) OVER (PARTITION BY channel) AS total_channel_changes\nFROM \"wikipedia\"\nWHERE channel IN ('#kk.wikipedia', '#lt.wikipedia')\n  AND __time BETWEEN '2016-06-27' AND '2016-06-28'\nGROUP BY TIME_FLOOR(__time, 'PT1H'), 2, 3\nORDER BY channel, TIME_FLOOR(__time, 'PT1H'), user\n"})}),"\n",(0,s.jsxs)(i,{children:[(0,s.jsx)("summary",{children:" View results "}),(0,s.jsxs)(d.table,{children:[(0,s.jsx)(d.thead,{children:(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"time_hour"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"channel"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"user"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"hourly_user_changes"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"total_user_changes"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"total_channel_changes"})})]})}),(0,s.jsxs)(d.tbody,{children:[(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T04:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"Nurkhan"})}),(0,s.jsx)(d.td,{children:"2440"}),(0,s.jsx)(d.td,{children:"9340"}),(0,s.jsx)(d.td,{children:"12314"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T04:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"\u041d\u04b1\u0440\u043b\u0430\u043d \u0420\u0430\u0445\u044b\u043c\u0436\u0430\u043d\u043e\u0432"})}),(0,s.jsx)(d.td,{children:"56"}),(0,s.jsx)(d.td,{children:"182"}),(0,s.jsx)(d.td,{children:"12314"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T06:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"\u0428\u043e\u043a\u0430\u0439"})}),(0,s.jsx)(d.td,{children:"91"}),(0,s.jsx)(d.td,{children:"91"}),(0,s.jsx)(d.td,{children:"12314"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T07:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"\u0421\u0430\u043b\u0438\u0445\u0430"})}),(0,s.jsx)(d.td,{children:"-1"}),(0,s.jsx)(d.td,{children:"2701"}),(0,s.jsx)(d.td,{children:"12314"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T09:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"\u0421\u0430\u043b\u0438\u0445\u0430"})}),(0,s.jsx)(d.td,{children:"2702"}),(0,s.jsx)(d.td,{children:"2701"}),(0,s.jsx)(d.td,{children:"12314"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T11:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"\u041d\u04b1\u0440\u043b\u0430\u043d \u0420\u0430\u0445\u044b\u043c\u0436\u0430\u043d\u043e\u0432"})}),(0,s.jsx)(d.td,{children:"126"}),(0,s.jsx)(d.td,{children:"182"}),(0,s.jsx)(d.td,{children:"12314"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T15:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"Nurkhan"})}),(0,s.jsx)(d.td,{children:"6900"}),(0,s.jsx)(d.td,{children:"9340"}),(0,s.jsx)(d.td,{children:"12314"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T06:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"Powermelon"})}),(0,s.jsx)(d.td,{children:"-2"}),(0,s.jsx)(d.td,{children:"39"}),(0,s.jsx)(d.td,{children:"5851"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T07:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"Powermelon"})}),(0,s.jsx)(d.td,{children:"13"}),(0,s.jsx)(d.td,{children:"39"}),(0,s.jsx)(d.td,{children:"5851"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T09:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"178.11.203.212"})}),(0,s.jsx)(d.td,{children:"447"}),(0,s.jsx)(d.td,{children:"447"}),(0,s.jsx)(d.td,{children:"5851"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T09:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"80.4.147.222"})}),(0,s.jsx)(d.td,{children:"894"}),(0,s.jsx)(d.td,{children:"895"}),(0,s.jsx)(d.td,{children:"5851"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T10:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"80.4.147.222"})}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"895"}),(0,s.jsx)(d.td,{children:"5851"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T11:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"MaryroseB54"})}),(0,s.jsx)(d.td,{children:"59"}),(0,s.jsx)(d.td,{children:"59"}),(0,s.jsx)(d.td,{children:"5851"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T12:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"Karoliuk"})}),(0,s.jsx)(d.td,{children:"53"}),(0,s.jsx)(d.td,{children:"53"}),(0,s.jsx)(d.td,{children:"5851"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T12:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"Powermelon"})}),(0,s.jsx)(d.td,{children:"28"}),(0,s.jsx)(d.td,{children:"39"}),(0,s.jsx)(d.td,{children:"5851"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T19:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"77.221.66.41"})}),(0,s.jsx)(d.td,{children:"4358"}),(0,s.jsx)(d.td,{children:"4358"}),(0,s.jsx)(d.td,{children:"5851"})]})]})]})]}),"\n",(0,s.jsxs)(d.p,{children:["In this example, the dataset is filtered for a single day. Therefore the window function results represent the total activity for the day, for the ",(0,s.jsx)(d.code,{children:"user"})," and for the ",(0,s.jsx)(d.code,{children:"channel"})," dimensions respectively."]}),"\n",(0,s.jsx)(d.p,{children:"This type of result helps you analyze the impact of an individual user's hourly activity:"}),"\n",(0,s.jsxs)(d.ul,{children:["\n",(0,s.jsxs)(d.li,{children:["the impact to the channel by comparing ",(0,s.jsx)(d.code,{children:"hourly_user_changes"})," to ",(0,s.jsx)(d.code,{children:"total_channel_changes"})]}),"\n",(0,s.jsxs)(d.li,{children:["the impact of each user over the channel by ",(0,s.jsx)(d.code,{children:"total_user_changes"})," to ",(0,s.jsx)(d.code,{children:"total_channel_changes"})]}),"\n",(0,s.jsxs)(d.li,{children:["the progress of each user's individual activity by comparing ",(0,s.jsx)(d.code,{children:"hourly_user_changes"})," to ",(0,s.jsx)(d.code,{children:"total_user_changes"})]}),"\n"]}),"\n",(0,s.jsx)(d.h4,{id:"window-frame-guardrails",children:"Window frame guardrails"}),"\n",(0,s.jsx)(d.p,{children:"Druid has guardrail logic to prevent you from executing window function queries with window frame expressions that might return unexpected results."}),"\n",(0,s.jsx)(d.p,{children:"For example:"}),"\n",(0,s.jsxs)(d.ul,{children:["\n",(0,s.jsx)(d.li,{children:"You cannot set expressions as bounds for window frames."}),"\n",(0,s.jsx)(d.li,{children:"You can only use a RANGE frames when both endpoints are unbounded or current row."}),"\n"]}),"\n",(0,s.jsx)(d.h2,{id:"window-function-reference",children:"Window function reference"}),"\n",(0,s.jsxs)(d.table,{children:[(0,s.jsx)(d.thead,{children:(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.th,{children:"Function"}),(0,s.jsx)(d.th,{children:"Notes"})]})}),(0,s.jsxs)(d.tbody,{children:[(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"ROW_NUMBER()"})}),(0,s.jsx)(d.td,{children:"Returns the number of the row within the window starting from 1"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"RANK()"})}),(0,s.jsx)(d.td,{children:"Returns the rank with gaps for a row within a window. For example, if two rows tie for rank 1, the next rank is 3"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"DENSE_RANK()"})}),(0,s.jsx)(d.td,{children:"Returns the rank for a row within a window without gaps. For example, if two rows tie for rank of 1, the subsequent row is ranked 2."})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"PERCENT_RANK()"})}),(0,s.jsxs)(d.td,{children:["Returns the relative rank of the row calculated as a percentage according to the formula: ",(0,s.jsx)(d.code,{children:"RANK() OVER (window) / COUNT(1) OVER (window)"})]})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"CUME_DIST()"})}),(0,s.jsxs)(d.td,{children:["Returns the cumulative distribution of the current row within the window calculated as number of window rows at the same rank or higher than current row divided by total window rows. The return value ranges between ",(0,s.jsx)(d.code,{children:"1/number of rows"})," and 1"]})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"NTILE(tiles)"})}),(0,s.jsx)(d.td,{children:"Divides the rows within a window as evenly as possible into the number of tiles, also called buckets, and returns the value of the tile that the row falls into"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"LAG(expr[, offset])"})}),(0,s.jsxs)(d.td,{children:["If you do not supply an ",(0,s.jsx)(d.code,{children:"offset"}),", returns the value evaluated at the row preceding the current row. Specify an offset number, ",(0,s.jsx)(d.code,{children:"n"}),", to return the value evaluated at ",(0,s.jsx)(d.code,{children:"n"})," rows preceding the current one"]})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"LEAD(expr[, offset])"})}),(0,s.jsxs)(d.td,{children:["If you do not supply an ",(0,s.jsx)(d.code,{children:"offset"}),", returns the value evaluated at the row following the current row. Specify an offset number ",(0,s.jsx)(d.code,{children:"n"})," to return the value evaluated at ",(0,s.jsx)(d.code,{children:"n"})," rows following the current one; if there is no such row, returns the given default value"]})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"FIRST_VALUE(expr)"})}),(0,s.jsx)(d.td,{children:"Returns the value evaluated for the expression for the first row within the window"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"LAST_VALUE(expr)"})}),(0,s.jsx)(d.td,{children:"Returns the value evaluated for the expression for the last row within the window"})]})]})]}),"\n",(0,s.jsx)(d.h2,{id:"examples",children:"Examples"}),"\n",(0,s.jsx)(d.p,{children:"The following example illustrates all of the built-in window functions to compare the number of characters changed per event for a channel in the Wikipedia data set."}),"\n",(0,s.jsx)(d.pre,{children:(0,s.jsx)(d.code,{className:"language-sql",children:"SELECT FLOOR(__time TO DAY) AS event_time,\n    channel,\n    ABS(delta) AS change,\n    ROW_NUMBER() OVER w AS row_no,\n    RANK() OVER w AS rank_no,\n    DENSE_RANK() OVER w AS dense_rank_no,\n    PERCENT_RANK() OVER w AS pct_rank,\n    CUME_DIST() OVER w AS cumulative_dist,\n    NTILE(4) OVER w AS ntile_val,\n    LAG(ABS(delta), 1, 0) OVER w AS lag_val,\n    LEAD(ABS(delta), 1, 0) OVER w AS lead_val,\n    FIRST_VALUE(ABS(delta)) OVER w AS first_val,\n    LAST_VALUE(ABS(delta)) OVER w AS last_val\nFROM wikipedia\nWHERE channel IN ('#kk.wikipedia', '#lt.wikipedia')\nGROUP BY channel, ABS(delta), FLOOR(__time TO DAY) \nWINDOW w AS (PARTITION BY channel ORDER BY ABS(delta) ASC)\n"})}),"\n",(0,s.jsxs)(i,{children:[(0,s.jsx)("summary",{children:" View results "}),(0,s.jsxs)(d.table,{children:[(0,s.jsx)(d.thead,{children:(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"event_time"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"channel"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"change"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"row_no"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"rank_no"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"dense_rank_no"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"pct_rank"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"cumulative_dist"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"ntile_val"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"lag_val"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"lead_val"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"first_val"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"last_val"})})]})}),(0,s.jsxs)(d.tbody,{children:[(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"0.0"}),(0,s.jsx)(d.td,{children:"0.125"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"null"}),(0,s.jsx)(d.td,{children:"7"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"6900"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"7"}),(0,s.jsx)(d.td,{children:"2"}),(0,s.jsx)(d.td,{children:"2"}),(0,s.jsx)(d.td,{children:"2"}),(0,s.jsx)(d.td,{children:"0.14285714285714285"}),(0,s.jsx)(d.td,{children:"0.25"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"56"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"6900"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"56"}),(0,s.jsx)(d.td,{children:"3"}),(0,s.jsx)(d.td,{children:"3"}),(0,s.jsx)(d.td,{children:"3"}),(0,s.jsx)(d.td,{children:"0.2857142857142857"}),(0,s.jsx)(d.td,{children:"0.375"}),(0,s.jsx)(d.td,{children:"2"}),(0,s.jsx)(d.td,{children:"7"}),(0,s.jsx)(d.td,{children:"63"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"6900"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"63"}),(0,s.jsx)(d.td,{children:"4"}),(0,s.jsx)(d.td,{children:"4"}),(0,s.jsx)(d.td,{children:"4"}),(0,s.jsx)(d.td,{children:"0.42857142857142855"}),(0,s.jsx)(d.td,{children:"0.5"}),(0,s.jsx)(d.td,{children:"2"}),(0,s.jsx)(d.td,{children:"56"}),(0,s.jsx)(d.td,{children:"91"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"6900"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"91"}),(0,s.jsx)(d.td,{children:"5"}),(0,s.jsx)(d.td,{children:"5"}),(0,s.jsx)(d.td,{children:"5"}),(0,s.jsx)(d.td,{children:"0.5714285714285714"}),(0,s.jsx)(d.td,{children:"0.625"}),(0,s.jsx)(d.td,{children:"3"}),(0,s.jsx)(d.td,{children:"63"}),(0,s.jsx)(d.td,{children:"2440"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"6900"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"2440"}),(0,s.jsx)(d.td,{children:"6"}),(0,s.jsx)(d.td,{children:"6"}),(0,s.jsx)(d.td,{children:"6"}),(0,s.jsx)(d.td,{children:"0.7142857142857143"}),(0,s.jsx)(d.td,{children:"0.75"}),(0,s.jsx)(d.td,{children:"3"}),(0,s.jsx)(d.td,{children:"91"}),(0,s.jsx)(d.td,{children:"2703"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"6900"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"2703"}),(0,s.jsx)(d.td,{children:"7"}),(0,s.jsx)(d.td,{children:"7"}),(0,s.jsx)(d.td,{children:"7"}),(0,s.jsx)(d.td,{children:"0.8571428571428571"}),(0,s.jsx)(d.td,{children:"0.875"}),(0,s.jsx)(d.td,{children:"4"}),(0,s.jsx)(d.td,{children:"2440"}),(0,s.jsx)(d.td,{children:"6900"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"6900"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"6900"}),(0,s.jsx)(d.td,{children:"8"}),(0,s.jsx)(d.td,{children:"8"}),(0,s.jsx)(d.td,{children:"8"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"4"}),(0,s.jsx)(d.td,{children:"2703"}),(0,s.jsx)(d.td,{children:"null"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"6900"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"0"}),(0,s.jsx)(d.td,{children:"0.1"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"null"}),(0,s.jsx)(d.td,{children:"2"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"4358"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"2"}),(0,s.jsx)(d.td,{children:"2"}),(0,s.jsx)(d.td,{children:"2"}),(0,s.jsx)(d.td,{children:"2"}),(0,s.jsx)(d.td,{children:"0.1111111111111111"}),(0,s.jsx)(d.td,{children:"0.2"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"13"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"4358"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"13"}),(0,s.jsx)(d.td,{children:"3"}),(0,s.jsx)(d.td,{children:"3"}),(0,s.jsx)(d.td,{children:"3"}),(0,s.jsx)(d.td,{children:"0.2222222222222222"}),(0,s.jsx)(d.td,{children:"0.3"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"2"}),(0,s.jsx)(d.td,{children:"28"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"4358"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"28"}),(0,s.jsx)(d.td,{children:"4"}),(0,s.jsx)(d.td,{children:"4"}),(0,s.jsx)(d.td,{children:"4"}),(0,s.jsx)(d.td,{children:"0.3333333333333333"}),(0,s.jsx)(d.td,{children:"0.4"}),(0,s.jsx)(d.td,{children:"2"}),(0,s.jsx)(d.td,{children:"13"}),(0,s.jsx)(d.td,{children:"53"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"4358"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"53"}),(0,s.jsx)(d.td,{children:"5"}),(0,s.jsx)(d.td,{children:"5"}),(0,s.jsx)(d.td,{children:"5"}),(0,s.jsx)(d.td,{children:"0.4444444444444444"}),(0,s.jsx)(d.td,{children:"0.5"}),(0,s.jsx)(d.td,{children:"2"}),(0,s.jsx)(d.td,{children:"28"}),(0,s.jsx)(d.td,{children:"56"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"4358"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"56"}),(0,s.jsx)(d.td,{children:"6"}),(0,s.jsx)(d.td,{children:"6"}),(0,s.jsx)(d.td,{children:"6"}),(0,s.jsx)(d.td,{children:"0.5555555555555556"}),(0,s.jsx)(d.td,{children:"0.6"}),(0,s.jsx)(d.td,{children:"2"}),(0,s.jsx)(d.td,{children:"53"}),(0,s.jsx)(d.td,{children:"59"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"4358"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"59"}),(0,s.jsx)(d.td,{children:"7"}),(0,s.jsx)(d.td,{children:"7"}),(0,s.jsx)(d.td,{children:"7"}),(0,s.jsx)(d.td,{children:"0.6666666666666666"}),(0,s.jsx)(d.td,{children:"0.7"}),(0,s.jsx)(d.td,{children:"3"}),(0,s.jsx)(d.td,{children:"56"}),(0,s.jsx)(d.td,{children:"391"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"4358"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"391"}),(0,s.jsx)(d.td,{children:"8"}),(0,s.jsx)(d.td,{children:"8"}),(0,s.jsx)(d.td,{children:"8"}),(0,s.jsx)(d.td,{children:"0.7777777777777778"}),(0,s.jsx)(d.td,{children:"0.8"}),(0,s.jsx)(d.td,{children:"3"}),(0,s.jsx)(d.td,{children:"59"}),(0,s.jsx)(d.td,{children:"894"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"4358"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"894"}),(0,s.jsx)(d.td,{children:"9"}),(0,s.jsx)(d.td,{children:"9"}),(0,s.jsx)(d.td,{children:"9"}),(0,s.jsx)(d.td,{children:"0.8888888888888888"}),(0,s.jsx)(d.td,{children:"0.9"}),(0,s.jsx)(d.td,{children:"4"}),(0,s.jsx)(d.td,{children:"391"}),(0,s.jsx)(d.td,{children:"4358"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"4358"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"4358"}),(0,s.jsx)(d.td,{children:"10"}),(0,s.jsx)(d.td,{children:"10"}),(0,s.jsx)(d.td,{children:"10"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"4"}),(0,s.jsx)(d.td,{children:"894"}),(0,s.jsx)(d.td,{children:"null"}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"4358"})]})]})]})]}),"\n",(0,s.jsx)(d.p,{children:"The following example demonstrates applying the SUM() function over the values in a window to calculate the cumulative changes to a channel over time:"}),"\n",(0,s.jsx)(d.pre,{children:(0,s.jsx)(d.code,{className:"language-sql",children:"SELECT\n    FLOOR(__time TO MINUTE) as \"time\",\n    channel,\n    ABS(delta) AS changes,\n    sum(ABS(delta)) OVER (PARTITION BY channel ORDER BY FLOOR(__time TO MINUTE) ASC) AS cum_changes\nFROM wikipedia\nWHERE channel IN ('#kk.wikipedia', '#lt.wikipedia')\nGROUP BY channel, __time, delta\n"})}),"\n",(0,s.jsxs)(i,{children:[(0,s.jsx)("summary",{children:" View results "}),(0,s.jsxs)(d.table,{children:[(0,s.jsx)(d.thead,{children:(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"time"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"channel"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"changes"})}),(0,s.jsx)(d.th,{children:(0,s.jsx)(d.code,{children:"cum_changes"})})]})}),(0,s.jsxs)(d.tbody,{children:[(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T04:20:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"56"}),(0,s.jsx)(d.td,{children:"56"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T04:35:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"2440"}),(0,s.jsx)(d.td,{children:"2496"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T06:15:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"91"}),(0,s.jsx)(d.td,{children:"2587"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T07:32:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"2588"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T09:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"2703"}),(0,s.jsx)(d.td,{children:"5291"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T09:24:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"5292"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T11:00:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"63"}),(0,s.jsx)(d.td,{children:"5355"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T11:05:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"7"}),(0,s.jsx)(d.td,{children:"5362"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T11:32:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"56"}),(0,s.jsx)(d.td,{children:"5418"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T15:21:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#kk.wikipedia"})}),(0,s.jsx)(d.td,{children:"6900"}),(0,s.jsx)(d.td,{children:"12318"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T06:17:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"2"}),(0,s.jsx)(d.td,{children:"2"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T07:55:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"13"}),(0,s.jsx)(d.td,{children:"15"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T09:05:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"894"}),(0,s.jsx)(d.td,{children:"909"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T09:12:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"391"}),(0,s.jsx)(d.td,{children:"1300"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T09:23:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"56"}),(0,s.jsx)(d.td,{children:"1356"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T10:59:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"1"}),(0,s.jsx)(d.td,{children:"1357"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T11:49:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"59"}),(0,s.jsx)(d.td,{children:"1416"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T12:41:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"53"}),(0,s.jsx)(d.td,{children:"1469"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T12:58:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"28"}),(0,s.jsx)(d.td,{children:"1497"})]}),(0,s.jsxs)(d.tr,{children:[(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"2016-06-27T19:03:00.000Z"})}),(0,s.jsx)(d.td,{children:(0,s.jsx)(d.code,{children:"#lt.wikipedia"})}),(0,s.jsx)(d.td,{children:"4358"}),(0,s.jsx)(d.td,{children:"5855"})]})]})]})]}),"\n",(0,s.jsx)(d.h3,{id:"example-with-window-frames",children:"Example with window frames"}),"\n",(0,s.jsx)(d.p,{children:"The following query uses a few different window frames to calculate overall activity by channel:"}),"\n",(0,s.jsx)(d.pre,{children:(0,s.jsx)(d.code,{className:"language-sql",children:"SELECT\n    channel, \n    TIME_FLOOR(__time, 'PT1H')      AS time_hour, \n    SUM(delta)                      AS hourly_channel_changes,\n    SUM(SUM(delta)) OVER cumulative AS cumulative_activity_in_channel,\n    SUM(SUM(delta)) OVER moving5    AS csum5,\n    COUNT(1) OVER moving5           AS count5\nFROM \"wikipedia\"\nWHERE channel = '#en.wikipedia'\n  AND __time BETWEEN '2016-06-27' AND '2016-06-28'\nGROUP BY 1, TIME_FLOOR(__time, 'PT1H')\nWINDOW cumulative AS (   \n                         PARTITION BY channel \n                         ORDER BY TIME_FLOOR(__time, 'PT1H') \n                         ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW\n                     )\n                     ,\n        moving5 AS ( \n                    PARTITION BY channel \n                    ORDER BY TIME_FLOOR(__time, 'PT1H') \n                    ROWS BETWEEN 4 PRECEDING AND CURRENT ROW\n                  )\n"})}),"\n",(0,s.jsxs)(i,{children:[(0,s.jsx)("summary",{children:" View results "}),(0,s.jsxs)(d.p,{children:["| ",(0,s.jsx)(d.code,{children:"channel"})," | ",(0,s.jsx)(d.code,{children:"time_hour"})," | ",(0,s.jsx)(d.code,{children:"hourly_channel_changes"})," | ",(0,s.jsx)(d.code,{children:"cumulative_activity_in_channel"})," | ",(0,s.jsx)(d.code,{children:"csum5"})," | ",(0,s.jsx)(d.code,{children:"count5"})," |\n| --- | --- | --- | --- | --- | --- | --- | --- |\n| ",(0,s.jsx)(d.code,{children:"#en.wikipedia"})," | ",(0,s.jsx)(d.code,{children:"2016-06-27T00:00:00.000Z"})," | 74996 | 74996 | 74996 | 1 |\n| ",(0,s.jsx)(d.code,{children:"#en.wikipedia"})," | ",(0,s.jsx)(d.code,{children:"2016-06-27T01:00:00.000Z"})," | 24150 | 99146 | 99146 | 2 |\n| ",(0,s.jsx)(d.code,{children:"#en.wikipedia"})," | ",(0,s.jsx)(d.code,{children:"2016-06-27T02:00:00.000Z"})," | 102372 | 201518 | 201518 | 3 |\n| ",(0,s.jsx)(d.code,{children:"#en.wikipedia"})," | ",(0,s.jsx)(d.code,{children:"2016-06-27T03:00:00.000Z"})," | 61362 | 262880 | 262880 | 4 |\n| ",(0,s.jsx)(d.code,{children:"#en.wikipedia"})," | ",(0,s.jsx)(d.code,{children:"2016-06-27T04:00:00.000Z"})," | 61666 | 324546 | 324546 | 5 |\n| ",(0,s.jsx)(d.code,{children:"#en.wikipedia"})," | ",(0,s.jsx)(d.code,{children:"2016-06-27T05:00:00.000Z"})," | 144199 | 468745 | 393749 | 5 |\n| ",(0,s.jsx)(d.code,{children:"#en.wikipedia"})," | ",(0,s.jsx)(d.code,{children:"2016-06-27T06:00:00.000Z"})," | 33414 | 502159 | 403013 | 5 |\n| ",(0,s.jsx)(d.code,{children:"#en.wikipedia"})," | ",(0,s.jsx)(d.code,{children:"2016-06-27T07:00:00.000Z"})," | 79397 | 581556 | 380038 | 5 |\n| ",(0,s.jsx)(d.code,{children:"#en.wikipedia"})," | ",(0,s.jsx)(d.code,{children:"2016-06-27T08:00:00.000Z"})," | 104436 | 685992 | 423112 | 5 |\n| ",(0,s.jsx)(d.code,{children:"#en.wikipedia"})," | ",(0,s.jsx)(d.code,{children:"2016-06-27T09:00:00.000Z"})," | 58020 | 744012 | 419466 | 5 |\n| ",(0,s.jsx)(d.code,{children:"#en.wikipedia"})," | ",(0,s.jsx)(d.code,{children:"2016-06-27T10:00:00.000Z"})," | 93904 | 837916 | 369171 | 5 |\n| ",(0,s.jsx)(d.code,{children:"#en.wikipedia"})," | ",(0,s.jsx)(d.code,{children:"2016-06-27T11:00:00.000Z"})," | 74436 | 912352 | 410193 | 5 |\n| ",(0,s.jsx)(d.code,{children:"#en.wikipedia"})," | ",(0,s.jsx)(d.code,{children:"2016-06-27T12:00:00.000Z"})," | 83491 | 995843 | 414287 | 5 |\n| ",(0,s.jsx)(d.code,{children:"#en.wikipedia"})," | ",(0,s.jsx)(d.code,{children:"2016-06-27T13:00:00.000Z"})," | 103051 | 1098894 | 412902 | 5 |\n| ",(0,s.jsx)(d.code,{children:"#en.wikipedia"})," | ",(0,s.jsx)(d.code,{children:"2016-06-27T14:00:00.000Z"})," | 211411 | 1310305 | 566293 | 5 |\n| ",(0,s.jsx)(d.code,{children:"#en.wikipedia"})," | ",(0,s.jsx)(d.code,{children:"2016-06-27T15:00:00.000Z"})," | 101247 | 1411552 | 573636 | 5 |\n| ",(0,s.jsx)(d.code,{children:"#en.wikipedia"})," | ",(0,s.jsx)(d.code,{children:"2016-06-27T16:00:00.000Z"})," | 189765 | 1601317 | 688965 | 5 |\n| ",(0,s.jsx)(d.code,{children:"#en.wikipedia"})," | ",(0,s.jsx)(d.code,{children:"2016-06-27T17:00:00.000Z"})," | 74404 | 1675721 | 679878 | 5 |\n| ",(0,s.jsx)(d.code,{children:"#en.wikipedia"})," | ",(0,s.jsx)(d.code,{children:"2016-06-27T18:00:00.000Z"})," | 104824 | 1780545 | 681651 | 5 |\n| ",(0,s.jsx)(d.code,{children:"#en.wikipedia"})," | ",(0,s.jsx)(d.code,{children:"2016-06-27T19:00:00.000Z"})," | 71268 | 1851813 | 541508 | 5 |\n| ",(0,s.jsx)(d.code,{children:"#en.wikipedia"})," | ",(0,s.jsx)(d.code,{children:"2016-06-27T20:00:00.000Z"})," | 88185 | 1939998 | 528446 | 5 |\n| ",(0,s.jsx)(d.code,{children:"#en.wikipedia"})," | ",(0,s.jsx)(d.code,{children:"2016-06-27T21:00:00.000Z"})," | 42584 | 1982582 | 381265 | 5 |"]})]}),"\n",(0,s.jsx)(d.p,{children:"The example defines multiple window specifications in the WINDOW clause that you can use for various window function calculations."}),"\n",(0,s.jsx)(d.p,{children:"The query uses two windows:"}),"\n",(0,s.jsxs)(d.ul,{children:["\n",(0,s.jsxs)(d.li,{children:[(0,s.jsx)(d.code,{children:"cumulative"})," is partitioned by channel and includes all rows from the beginning of partition up to the current row as ordered by ",(0,s.jsx)(d.code,{children:"__time"})," to enable cumulative aggregation"]}),"\n",(0,s.jsxs)(d.li,{children:[(0,s.jsx)(d.code,{children:"moving5"})," is also partitioned by channel but only includes up to the last four rows and the current row as ordered by time"]}),"\n"]}),"\n",(0,s.jsxs)(d.p,{children:["The number of rows considered for the ",(0,s.jsx)(d.code,{children:"moving5"})," window for the ",(0,s.jsx)(d.code,{children:"count5"})," column:"]}),"\n",(0,s.jsxs)(d.ul,{children:["\n",(0,s.jsx)(d.li,{children:"starts at a single row because there are no rows before the current one"}),"\n",(0,s.jsxs)(d.li,{children:["grows up to five rows as defined by ",(0,s.jsx)(d.code,{children:"ROWS BETWEEN 4 ROWS PRECEDING AND CURRENT ROW"})]}),"\n"]}),"\n",(0,s.jsx)(d.h2,{id:"known-issues",children:"Known issues"}),"\n",(0,s.jsx)(d.p,{children:"The following are known issues with window functions:"}),"\n",(0,s.jsxs)(d.ul,{children:["\n",(0,s.jsx)(d.li,{children:"SELECT * queries without a WHERE clause are not supported. If you want to retrieve all columns in this case, specify the column names."}),"\n"]})]})}function j(e={}){const{wrapper:d}={...(0,r.R)(),...e.components};return d?(0,s.jsx)(d,{...e,children:(0,s.jsx)(x,{...e})}):x(e)}},28453:(e,d,i)=>{i.d(d,{R:()=>c,x:()=>l});var n=i(96540);const s={},r=n.createContext(s);function c(e){const d=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(d):{...d,...e}}),[d,e])}function l(e){let d;return d=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),n.createElement(r.Provider,{value:d},e.children)}}}]);