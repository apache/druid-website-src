"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[162],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>y});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),d=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(s.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=d(n),c=r,y=m["".concat(s,".").concat(c)]||m[c]||u[c]||i;return n?a.createElement(y,o(o({ref:t},p),{},{components:n})):a.createElement(y,o({ref:t},p))}));function y(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[m]="string"==typeof e?e:r,o[1]=l;for(var d=2;d<i;d++)o[d]=n[d];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},64089:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>y,frontMatter:()=>l,metadata:()=>d,toc:()=>m});var a=n(87462),r=n(63366),i=(n(67294),n(3905)),o=["components"],l={id:"mysql",title:"MySQL metadata store"},s=void 0,d={unversionedId:"development/extensions-core/mysql",id:"development/extensions-core/mysql",title:"MySQL metadata store",description:"\x3c!--",source:"@site/docs/32.0.0/development/extensions-core/mysql.md",sourceDirName:"development/extensions-core",slug:"/development/extensions-core/mysql",permalink:"/docs/32.0.0/development/extensions-core/mysql",draft:!1,tags:[],version:"current",frontMatter:{id:"mysql",title:"MySQL metadata store"}},p={},m=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Install MySQL Connector/J",id:"install-mysql-connectorj",level:3},{value:"Install MariaDB Connector/J",id:"install-mariadb-connectorj",level:3},{value:"Set up MySQL",id:"set-up-mysql",level:2},{value:"Encrypt MySQL connections",id:"encrypt-mysql-connections",level:2},{value:"Configuration properties",id:"configuration-properties",level:2},{value:"MySQL input source",id:"mysql-input-source",level:2}],u={toc:m},c="wrapper";function y(e){var t=e.components,n=(0,r.Z)(e,o);return(0,i.kt)(c,(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"To use this Apache Druid extension, ",(0,i.kt)("a",{parentName:"p",href:"/docs/32.0.0/configuration/extensions#loading-extensions"},"include")," ",(0,i.kt)("inlineCode",{parentName:"p"},"mysql-metadata-storage")," in the extensions load list."),(0,i.kt)("p",null,"With the MySQL extension, you can use MySQL as a metadata store or ingest from a MySQL database."),(0,i.kt)("p",null,"The extension requires a connector library that's not included with Druid.\nSee the ",(0,i.kt)("a",{parentName:"p",href:"#prerequisites"},"Prerequisites")," for installation instructions."),(0,i.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("p",null,"To use the MySQL extension, you need to install one of the following libraries:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#install-mysql-connectorj"},"MySQL Connector/J")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#install-mariadb-connectorj"},"MariaDB Connector/J"))),(0,i.kt)("h3",{id:"install-mysql-connectorj"},"Install MySQL Connector/J"),(0,i.kt)("p",null,"The MySQL extension uses Oracle's MySQL JDBC driver.\nThe current version of Druid uses version 8.2.0.\nOther versions may not work with this extension."),(0,i.kt)("p",null,"You can download the library from one of the following sources:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://dev.mysql.com/downloads/connector/j/"},"MySQL website"),(0,i.kt)("br",{parentName:"li"}),"Visit the archives page to access older product versions."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://repo1.maven.org/maven2/com/mysql/mysql-connector-j/8.2.0/mysql-connector-j-8.2.0.jar"},"Maven Central (direct download)")),(0,i.kt)("li",{parentName:"ul"},"Your package manager. For example, ",(0,i.kt)("inlineCode",{parentName:"li"},"libmysql-java")," on APT for a Debian-based OS.")),(0,i.kt)("p",null,"The download includes the MySQL connector JAR file with a name like ",(0,i.kt)("inlineCode",{parentName:"p"},"mysql-connector-j-8.2.0.jar"),".\nCopy or create a symbolic link to this file inside the ",(0,i.kt)("inlineCode",{parentName:"p"},"lib")," folder in the distribution root directory."),(0,i.kt)("h3",{id:"install-mariadb-connectorj"},"Install MariaDB Connector/J"),(0,i.kt)("p",null,"This extension also supports using the MariaDB connector jar.\nThe current version of Druid uses version 2.7.3.\nOther versions may not work with this extension."),(0,i.kt)("p",null,"You can download the library from one of the following sources:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://mariadb.com/downloads/connectors/connectors-data-access/java8-connector"},"MariaDB website"),(0,i.kt)("br",{parentName:"li"}),"Click ",(0,i.kt)("strong",{parentName:"li"},"Show All Files")," to access older product versions."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://repo1.maven.org/maven2/org/mariadb/jdbc/mariadb-java-client/2.7.3/mariadb-java-client-2.7.3.jar"},"Maven Central (direct download)"))),(0,i.kt)("p",null,"The download includes the MariaDB connector JAR file with a name like ",(0,i.kt)("inlineCode",{parentName:"p"},"maria-java-client-2.7.3.jar"),".\nCopy or create a symbolic link to this file inside the ",(0,i.kt)("inlineCode",{parentName:"p"},"lib")," folder in the distribution root directory."),(0,i.kt)("p",null,"To configure the ",(0,i.kt)("inlineCode",{parentName:"p"},"mysql-metadata-storage")," extension to use the MariaDB connector library instead of MySQL, set ",(0,i.kt)("inlineCode",{parentName:"p"},"druid.metadata.mysql.driver.driverClassName=org.mariadb.jdbc.Driver"),"."),(0,i.kt)("p",null,"The protocol of the connection string is ",(0,i.kt)("inlineCode",{parentName:"p"},"jdbc:mysql:")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"jdbc:mariadb:"),",\ndepending on your specific version of the MariaDB client library.\nFor more information on the parameters to configure a connection,\n",(0,i.kt)("a",{parentName:"p",href:"https://mariadb.com/kb/en/about-mariadb-connector-j/#connection-strings"},"see the MariaDB documentation"),"\nfor your connector version."),(0,i.kt)("h2",{id:"set-up-mysql"},"Set up MySQL"),(0,i.kt)("p",null,"To avoid issues with upgrades that require schema changes to a large metadata table, consider a MySQL version that supports instant ADD COLUMN semantics. For example, MySQL 8."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Install MySQL"),(0,i.kt)("p",{parentName:"li"},"Use your favorite package manager to install mysql, e.g.:"))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"on Ubuntu/Debian using apt ",(0,i.kt)("inlineCode",{parentName:"p"},"apt-get install mysql-server"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"on OS X, using ",(0,i.kt)("a",{parentName:"p",href:"http://brew.sh/"},"Homebrew")," ",(0,i.kt)("inlineCode",{parentName:"p"},"brew install mysql")),(0,i.kt)("p",{parentName:"li"},"Alternatively, download and follow installation instructions for MySQL\nCommunity Server here:\n",(0,i.kt)("a",{parentName:"p",href:"http://dev.mysql.com/downloads/mysql/"},"http://dev.mysql.com/downloads/mysql/"),"."))),(0,i.kt)("p",null,"This extension also supports using MariaDB server, ",(0,i.kt)("a",{parentName:"p",href:"https://mariadb.org/download/"},"https://mariadb.org/download/"),", substituting for MariaDB in the following instructions where appropriate."),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Create a druid database and user"),(0,i.kt)("p",{parentName:"li"},"Connect to MySQL from the machine where it is installed."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"mysql -u root\n")),(0,i.kt)("p",{parentName:"li"},"Paste the following snippet into the mysql prompt:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"-- create a druid database, make sure to use utf8mb4 as encoding\nCREATE DATABASE druid DEFAULT CHARACTER SET utf8mb4;\n\n-- create a druid user\nCREATE USER 'druid'@'localhost' IDENTIFIED BY 'password';\n\n-- grant the user all the permissions on the database we just created\nGRANT ALL PRIVILEGES ON druid.* TO 'druid'@'localhost';\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Configure your Druid metadata storage extension:"),(0,i.kt)("p",{parentName:"li"},"Add the following parameters to your Druid configuration, replacing ",(0,i.kt)("inlineCode",{parentName:"p"},"<host>"),"\nwith the location (host name and port) of the database."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-properties"},'druid.extensions.loadList=["mysql-metadata-storage"]\ndruid.metadata.storage.type=mysql\ndruid.metadata.storage.connector.connectURI=jdbc:mysql://<host>/druid\ndruid.metadata.storage.connector.user=druid\ndruid.metadata.storage.connector.password=diurd\n')))),(0,i.kt)("p",null,"If using the MariaDB connector library, set ",(0,i.kt)("inlineCode",{parentName:"p"},"druid.metadata.mysql.driver.driverClassName=org.mariadb.jdbc.Driver"),"."),(0,i.kt)("h2",{id:"encrypt-mysql-connections"},"Encrypt MySQL connections"),(0,i.kt)("p",null,"This extension provides support for encrypting MySQL connections. To get more information about encrypting MySQL connections using TLS/SSL in general, please refer to this ",(0,i.kt)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/5.7/en/using-encrypted-connections.html"},"guide"),"."),(0,i.kt)("h2",{id:"configuration-properties"},"Configuration properties"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Property"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"),(0,i.kt)("th",{parentName:"tr",align:null},"Default"),(0,i.kt)("th",{parentName:"tr",align:null},"Required"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"druid.metadata.mysql.ssl.useSSL")),(0,i.kt)("td",{parentName:"tr",align:null},"Enable SSL"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"false")),(0,i.kt)("td",{parentName:"tr",align:null},"no")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"druid.metadata.mysql.ssl.clientCertificateKeyStoreUrl")),(0,i.kt)("td",{parentName:"tr",align:null},"The file path URL to the client certificate key store."),(0,i.kt)("td",{parentName:"tr",align:null},"none"),(0,i.kt)("td",{parentName:"tr",align:null},"no")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"druid.metadata.mysql.ssl.clientCertificateKeyStoreType")),(0,i.kt)("td",{parentName:"tr",align:null},"The type of the key store where the client certificate is stored."),(0,i.kt)("td",{parentName:"tr",align:null},"none"),(0,i.kt)("td",{parentName:"tr",align:null},"no")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"druid.metadata.mysql.ssl.clientCertificateKeyStorePassword")),(0,i.kt)("td",{parentName:"tr",align:null},"The ",(0,i.kt)("a",{parentName:"td",href:"/docs/32.0.0/operations/password-provider"},"Password Provider")," or String password for the client key store."),(0,i.kt)("td",{parentName:"tr",align:null},"none"),(0,i.kt)("td",{parentName:"tr",align:null},"no")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"druid.metadata.mysql.ssl.verifyServerCertificate")),(0,i.kt)("td",{parentName:"tr",align:null},"Enables server certificate verification."),(0,i.kt)("td",{parentName:"tr",align:null},"false"),(0,i.kt)("td",{parentName:"tr",align:null},"no")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"druid.metadata.mysql.ssl.trustCertificateKeyStoreUrl")),(0,i.kt)("td",{parentName:"tr",align:null},"The file path to the trusted root certificate key store."),(0,i.kt)("td",{parentName:"tr",align:null},"Default trust store provided by MySQL"),(0,i.kt)("td",{parentName:"tr",align:null},"yes if ",(0,i.kt)("inlineCode",{parentName:"td"},"verifyServerCertificate")," is set to true and a custom trust store is used")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"druid.metadata.mysql.ssl.trustCertificateKeyStoreType")),(0,i.kt)("td",{parentName:"tr",align:null},"The type of the key store where trusted root certificates are stored."),(0,i.kt)("td",{parentName:"tr",align:null},"JKS"),(0,i.kt)("td",{parentName:"tr",align:null},"yes if ",(0,i.kt)("inlineCode",{parentName:"td"},"verifyServerCertificate")," is set to true and keystore type is not JKS")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"druid.metadata.mysql.ssl.trustCertificateKeyStorePassword")),(0,i.kt)("td",{parentName:"tr",align:null},"The ",(0,i.kt)("a",{parentName:"td",href:"/docs/32.0.0/operations/password-provider"},"Password Provider")," or String password for the trust store."),(0,i.kt)("td",{parentName:"tr",align:null},"none"),(0,i.kt)("td",{parentName:"tr",align:null},"yes if ",(0,i.kt)("inlineCode",{parentName:"td"},"verifyServerCertificate")," is set to true and password is not null")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"druid.metadata.mysql.ssl.enabledSSLCipherSuites")),(0,i.kt)("td",{parentName:"tr",align:null},"Overrides the existing cipher suites with these cipher suites."),(0,i.kt)("td",{parentName:"tr",align:null},"none"),(0,i.kt)("td",{parentName:"tr",align:null},"no")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"druid.metadata.mysql.ssl.enabledTLSProtocols")),(0,i.kt)("td",{parentName:"tr",align:null},"Overrides the TLS protocols with these protocols."),(0,i.kt)("td",{parentName:"tr",align:null},"none"),(0,i.kt)("td",{parentName:"tr",align:null},"no")))),(0,i.kt)("h2",{id:"mysql-input-source"},"MySQL input source"),(0,i.kt)("p",null,"The MySQL extension provides an implementation of an SQL input source to ingest data into Druid from a MySQL database.\nFor more information on the input source parameters, see ",(0,i.kt)("a",{parentName:"p",href:"/docs/32.0.0/ingestion/input-sources#sql-input-source"},"SQL input source"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "type": "index_parallel",\n  "spec": {\n    "dataSchema": {\n      "dataSource": "some_datasource",\n      "dimensionsSpec": {\n        "dimensionExclusions": [],\n        "dimensions": [\n          "dim1",\n          "dim2",\n          "dim3"\n        ]\n      },\n      "timestampSpec": {\n        "format": "auto",\n        "column": "ts"\n      },\n      "metricsSpec": [],\n      "granularitySpec": {\n        "type": "uniform",\n        "segmentGranularity": "DAY",\n        "queryGranularity": {\n          "type": "none"\n        },\n        "rollup": false,\n        "intervals": null\n      },\n      "transformSpec": {\n        "filter": null,\n        "transforms": []\n      }\n    },\n    "ioConfig": {\n      "type": "index_parallel",\n      "inputSource": {\n        "type": "sql",\n        "database": {\n          "type": "mysql",\n          "connectorConfig": {\n            "connectURI": "jdbc:mysql://some-rds-host.us-west-1.rds.amazonaws.com:3306/druid",\n            "user": "admin",\n            "password": "secret"\n          }\n        },\n        "sqls": [\n          "SELECT * FROM some_table"\n        ]\n      },\n      "inputFormat": {\n        "type": "json"\n      }\n    },\n    "tuningConfig": {\n      "type": "index_parallel"\n    }\n  }\n}\n')))}y.isMDXComponent=!0}}]);