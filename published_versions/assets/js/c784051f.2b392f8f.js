"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1659],{14137:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>h});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},d=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=p(a),c=i,h=u["".concat(s,".").concat(c)]||u[c]||m[c]||r;return a?n.createElement(h,o(o({ref:t},d),{},{components:a})):n.createElement(h,o({ref:t},d))}));function h(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,o=new Array(r);o[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:i,o[1]=l;for(var p=2;p<r;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},94129:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>p,toc:()=>u});var n=a(87462),i=a(63366),r=(a(67294),a(14137)),o=["components"],l={id:"release-notes",title:"Release notes"},s=void 0,p={unversionedId:"release-info/release-notes",id:"release-info/release-notes",title:"Release notes",description:"\x3c!--",source:"@site/docs/31.0.0/release-info/release-notes.md",sourceDirName:"release-info",slug:"/release-info/release-notes",permalink:"/docs/31.0.0/release-info/release-notes",draft:!1,tags:[],version:"current",frontMatter:{id:"release-notes",title:"Release notes"},sidebar:"docs",previous:{title:"Experimental features",permalink:"/docs/31.0.0/development/experimental"},next:{title:"Upgrade notes",permalink:"/docs/31.0.0/release-info/upgrade-notes"}},d={},u=[{value:"Important features, changes, and deprecations",id:"important-features-changes-and-deprecations",level:2},{value:"Compaction features",id:"compaction-features",level:3},{value:"Window functions are GA",id:"window-functions-are-ga",level:3},{value:"Concurrent append and replace GA",id:"concurrent-append-and-replace-ga",level:3},{value:"Delta Lake improvements",id:"delta-lake-improvements",level:3},{value:"Iceberg improvements",id:"iceberg-improvements",level:3},{value:"Projections (experimental)",id:"projections-experimental",level:3},{value:"Low latency high complexity queries using Dart (experimental)",id:"low-latency-high-complexity-queries-using-dart-experimental",level:3},{value:"Storage improvements",id:"storage-improvements",level:3},{value:"Upgrade-related changes",id:"upgrade-related-changes",level:3},{value:"Deprecations",id:"deprecations",level:3},{value:"Java 8 support",id:"java-8-support",level:4},{value:"Other deprecations",id:"other-deprecations",level:4},{value:"Functional areas and related changes",id:"functional-areas-and-related-changes",level:2},{value:"Web console",id:"web-console",level:3},{value:"Improvements to the stages display",id:"improvements-to-the-stages-display",level:4},{value:"Dart",id:"dart",level:4},{value:"Copy query results as SQL",id:"copy-query-results-as-sql",level:4},{value:"Explore view improvements",id:"explore-view-improvements",level:4},{value:"Support Delta lake ingestion in the data loaders",id:"support-delta-lake-ingestion-in-the-data-loaders",level:4},{value:"Support Kinesis input format",id:"support-kinesis-input-format",level:4},{value:"Other web console improvements",id:"other-web-console-improvements",level:4},{value:"Ingestion",id:"ingestion",level:3},{value:"Optimized the loading of broadcast data sources",id:"optimized-the-loading-of-broadcast-data-sources",level:4},{value:"General ingestion improvements",id:"general-ingestion-improvements",level:4},{value:"SQL-based ingestion",id:"sql-based-ingestion",level:4},{value:"Optimized S3 storage writing for MSQ durable storage",id:"optimized-s3-storage-writing-for-msq-durable-storage",level:5},{value:"Improved lookup performance",id:"improved-lookup-performance",level:5},{value:"Other SQL-based ingestion improvements",id:"other-sql-based-ingestion-improvements",level:4},{value:"Streaming ingestion",id:"streaming-ingestion",level:3},{value:"New Kinesis input format",id:"new-kinesis-input-format",level:4},{value:"Streaming ingestion improvements",id:"streaming-ingestion-improvements",level:4},{value:"Querying",id:"querying",level:3},{value:"Dart",id:"dart-1",level:4},{value:"Projections",id:"projections",level:4},{value:"Enabled querying cold datasources",id:"enabled-querying-cold-datasources",level:4},{value:"SQL DIV function",id:"sql-div-function",level:4},{value:"Modified equality and typed in filter behavior",id:"modified-equality-and-typed-in-filter-behavior",level:4},{value:"Window query guardrails",id:"window-query-guardrails",level:4},{value:"Updated query from deep storage API response",id:"updated-query-from-deep-storage-api-response",level:4},{value:"Other querying improvements",id:"other-querying-improvements",level:4},{value:"Cluster management",id:"cluster-management",level:3},{value:"Added cluster configuration for multivalue handling",id:"added-cluster-configuration-for-multivalue-handling",level:4},{value:"API for cluster-level compaction configuration",id:"api-for-cluster-level-compaction-configuration",level:4},{value:"Guardrail for task payload size",id:"guardrail-for-task-payload-size",level:4},{value:"Improved UX for Coordinator management",id:"improved-ux-for-coordinator-management",level:4},{value:"Other cluster management improvements",id:"other-cluster-management-improvements",level:4},{value:"Data management",id:"data-management",level:3},{value:"Compaction",id:"compaction",level:4},{value:"Compaction supervisors (experimental)",id:"compaction-supervisors-experimental",level:5},{value:"Kill tasks",id:"kill-tasks",level:4},{value:"Other data management improvements",id:"other-data-management-improvements",level:4},{value:"Storage improvements",id:"storage-improvements-1",level:3},{value:"Compression for complex columns",id:"compression-for-complex-columns",level:4},{value:"Flexible segment sorting",id:"flexible-segment-sorting",level:4},{value:"APIs",id:"apis",level:3},{value:"New API for exiting streaming task groups early",id:"new-api-for-exiting-streaming-task-groups-early",level:4},{value:"API to fetch conflicting task locks",id:"api-to-fetch-conflicting-task-locks",level:4},{value:"Metrics and monitoring",id:"metrics-and-monitoring",level:3},{value:"Cgroup usage",id:"cgroup-usage",level:4},{value:"Default Prometheus metrics",id:"default-prometheus-metrics",level:4},{value:"Configurable connection timeouts",id:"configurable-connection-timeouts",level:4},{value:"Added indexer metrics",id:"added-indexer-metrics",level:4},{value:"Added subquery metrics",id:"added-subquery-metrics",level:4},{value:"Added segment loading rate metrics",id:"added-segment-loading-rate-metrics",level:4},{value:"Extensions",id:"extensions",level:3},{value:"Kubernetes improvements",id:"kubernetes-improvements",level:4},{value:"<code>pac4j</code> OIDC context",id:"pac4j-oidc-context",level:4},{value:"Middle Manager-less Druid improvements",id:"middle-manager-less-druid-improvements",level:4},{value:"Improved Iceberg input source support",id:"improved-iceberg-input-source-support",level:4},{value:"Delta Lake complex types",id:"delta-lake-complex-types",level:4},{value:"Delta Lake snapshot versions",id:"delta-lake-snapshot-versions",level:4},{value:"Other extensions improvements",id:"other-extensions-improvements",level:4},{value:"Upgrade notes and incompatible changes",id:"upgrade-notes-and-incompatible-changes",level:2},{value:"Upgrade notes",id:"upgrade-notes",level:3},{value:"Array ingest mode now defaults to array",id:"array-ingest-mode-now-defaults-to-array",level:4},{value:"Removed task action audit logging",id:"removed-task-action-audit-logging",level:4},{value:"Removed Firehose and FirehoseFactory",id:"removed-firehose-and-firehosefactory",level:4},{value:"Front-coded dictionaries",id:"front-coded-dictionaries",level:4},{value:"Storage improvement features",id:"storage-improvement-features",level:4},{value:"Incompatible changes",id:"incompatible-changes",level:3},{value:"Removed the scan query legacy mode",id:"removed-the-scan-query-legacy-mode",level:4},{value:"ZK-based segment loading",id:"zk-based-segment-loading",level:4},{value:"Developer notes",id:"developer-notes",level:3},{value:"<code>StorageAdapter</code> changes",id:"storageadapter-changes",level:3},{value:"Dependency updates",id:"dependency-updates",level:4}],m={toc:u},c="wrapper";function h(e){var t=e.components,l=(0,i.Z)(e,o);return(0,r.kt)(c,(0,n.Z)({},m,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Apache Druid 31.0.0 contains over 589 new features, bug fixes, performance enhancements, documentation improvements, and additional test coverage from 64 contributors."),(0,r.kt)("p",null,"See the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/issues?q=is%3Aclosed+milestone%3A31.0.0+sort%3Aupdated-desc+"},"complete set of changes")," for additional details, including bug fixes."),(0,r.kt)("p",null,"Review the ",(0,r.kt)("a",{parentName:"p",href:"#upgrade-notes"},"upgrade notes")," and ",(0,r.kt)("a",{parentName:"p",href:"#incompatible-changes"},"incompatible changes")," before you upgrade to Druid 31.0.0.\nIf you are upgrading across multiple versions, see the ",(0,r.kt)("a",{parentName:"p",href:"https://druid.apache.org/docs/latest/release-info/upgrade-notes"},"Upgrade notes")," page, which lists upgrade notes for the most recent Druid versions."),(0,r.kt)("h2",{id:"important-features-changes-and-deprecations"},"Important features, changes, and deprecations"),(0,r.kt)("p",null,"This section contains important information about new and existing features."),(0,r.kt)("h3",{id:"compaction-features"},"Compaction features"),(0,r.kt)("p",null,"Druid now supports the following features:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Compaction scheduler with greater flexibility and control over when and what to compact."),(0,r.kt)("li",{parentName:"ul"},"MSQ task engine-based auto-compaction for more performant compaction jobs.")),(0,r.kt)("p",null,"For more information, see ",(0,r.kt)("a",{parentName:"p",href:"#compaction-supervisors-experimental"},"Compaction supervisors"),"."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16291"},"#16291")," ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16768"},"#16768")),(0,r.kt)("p",null,"Additionally, compaction tasks that take advantage of concurrent append and replace is now generally available as part of concurrent append and replace becoming GA."),(0,r.kt)("h3",{id:"window-functions-are-ga"},"Window functions are GA"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://druid.apache.org/docs/latest/querying/sql-window-functions"},"Window functions")," are now generally available in Druid's native engine and in the MSQ task engine."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"You no longer need to use the query context ",(0,r.kt)("inlineCode",{parentName:"li"},"enableWindowing")," to use window functions. ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17087"},"#17087"))),(0,r.kt)("h3",{id:"concurrent-append-and-replace-ga"},"Concurrent append and replace GA"),(0,r.kt)("p",null,"Concurrent append and replace is now GA. The feature safely replaces the existing data in an interval of a datasource while new data is being appended to that interval. One of the most common applications of this feature is appending new data (such as with streaming ingestion) to an interval while compaction of that interval is already in progress. "),(0,r.kt)("h3",{id:"delta-lake-improvements"},"Delta Lake improvements"),(0,r.kt)("p",null,"The community extension for Delta Lake has been improved to support ",(0,r.kt)("a",{parentName:"p",href:"#delta-lake-complex-types"},"complex types")," and ",(0,r.kt)("a",{parentName:"p",href:"#delta-lake-snapshot-versions"},"snapshot versions"),"."),(0,r.kt)("h3",{id:"iceberg-improvements"},"Iceberg improvements"),(0,r.kt)("p",null,"The community extension for Iceberg has been improved. For more information, see ",(0,r.kt)("a",{parentName:"p",href:"#iceberg-improvements"},"Iceberg improvements")),(0,r.kt)("h3",{id:"projections-experimental"},"Projections (experimental)"),(0,r.kt)("p",null,"Druid 31.0.0 includes experimental support for new feature called projections. Projections are grouped pre-aggregates of a segment that are automatically used at query time to optimize execution for any queries which 'fit' the shape of the projection by reducing both computation and i/o cost by reducing the number of rows which need to be processed. Projections are contained within segments of a datasource and do increase the segment size. But they can share data, such as value dictionaries of dictionary encoded columns, with the columns of the base segment."),(0,r.kt)("p",null,"Projections currently only support JSON-based ingestion, but they can be used by queries that use the MSQ task engine or the new Dart engine. Future development will allow projections to be created as part of SQL-based ingestion."),(0,r.kt)("p",null,"We have a lot of plans to continue to improve this feature in the coming releases, but are excited to get it out there so users can begin experimentation since projections can dramatically improve query performance."),(0,r.kt)("p",null,"For more information, see ",(0,r.kt)("a",{parentName:"p",href:"#projections"},"Projections"),"."),(0,r.kt)("h3",{id:"low-latency-high-complexity-queries-using-dart-experimental"},"Low latency high complexity queries using Dart (experimental)"),(0,r.kt)("p",null,"Distributed Asynchronous Runtime Topology (Dart) is designed to support high complexity queries, such as large joins, high cardinality group by, subqueries and common table expressions, commonly found in ad-hoc, data warehouse workloads. Instead of using data warehouse engines like Spark or Presto to execute high-complexity queries, you can use Dart, alleviating the need for additional infrastructure."),(0,r.kt)("p",null,"For more information, see ",(0,r.kt)("a",{parentName:"p",href:"#dart"},"Dart"),"."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/17140"},"#17140")),(0,r.kt)("h3",{id:"storage-improvements"},"Storage improvements"),(0,r.kt)("p",null,"Druid 31.0.0 includes several improvements to how data is stored by Druid, including compressed columns and flexible segment sorting. For more information, see ",(0,r.kt)("a",{parentName:"p",href:"#storage-improvements-1"},"Storage improvements"),"."),(0,r.kt)("h3",{id:"upgrade-related-changes"},"Upgrade-related changes"),(0,r.kt)("p",null,"See the ",(0,r.kt)("a",{parentName:"p",href:"#upgrade-notes"},"Upgrade notes")," for more information about the following upgrade-related changes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#array-ingest-mode-now-defaults-to-array"},"Array ingest mode now defaults to array")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#zk-based-segment-loading"},"Disabled ZK-based segment loading")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#removed-task-action-audit-logging"},"Removed task action audit logging")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#removed-firehose-and-firehosefactory"},"Removed Firehose and FirehoseFactory")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#removed-the-scan-query-legacy-mode"},"Removed the scan query legacy mode"))),(0,r.kt)("h3",{id:"deprecations"},"Deprecations"),(0,r.kt)("h4",{id:"java-8-support"},"Java 8 support"),(0,r.kt)("p",null,"Java 8 support is now deprecated and will be removed in 32.0.0. "),(0,r.kt)("h4",{id:"other-deprecations"},"Other deprecations"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Deprecated API ",(0,r.kt)("inlineCode",{parentName:"li"},"/lockedIntervals")," is now removed ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16799"},"#16799")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#api-for-cluster-level-compaction-configuration"},"Cluster-level compaction API")," deprecates task slots compaction API ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16803"},"#16803")),(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"arrayIngestMode")," context parameter is deprecated and will be removed. For more information, see ",(0,r.kt)("a",{parentName:"li",href:"#array-ingest-mode-now-defaults-to-array"},"Array ingest mode now defaults to array"),".")),(0,r.kt)("h2",{id:"functional-areas-and-related-changes"},"Functional areas and related changes"),(0,r.kt)("p",null,"This section contains detailed release notes separated by areas."),(0,r.kt)("h3",{id:"web-console"},"Web console"),(0,r.kt)("h4",{id:"improvements-to-the-stages-display"},"Improvements to the stages display"),(0,r.kt)("p",null,"A number of improvements have been made to the query stages visualization\n",(0,r.kt)("img",{alt:"new_stages.png",src:a(83903).Z,width:"2500",height:"1280"}),"\nThese changes include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Added a graph visualization to illustrate the flow of query stages ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17135"},"#17135")),(0,r.kt)("li",{parentName:"ul"},"Added a column for CPU counters in the query stages detail view when they are present. Also added tool tips to expose potentially hidden data like CPU time ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17132"},"#17132"))),(0,r.kt)("h4",{id:"dart"},"Dart"),(0,r.kt)("p",null,"Added the ability to detect the presence of the Dart engine and to run Dart queries from the console as well as to see currently running Dart queries.\n",(0,r.kt)("img",{alt:"dart.png",src:a(60851).Z,width:"2500",height:"1280"}),"\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/17147"},"#17147")),(0,r.kt)("h4",{id:"copy-query-results-as-sql"},"Copy query results as SQL"),(0,r.kt)("p",null,"You can now copy the results of a query as a Druid SQL statement:\n",(0,r.kt)("img",{src:a(52665).Z,width:"1636",height:"1292"}),"\nWhen you copy the results of the pictured query, you get the following query:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT\n  CAST(\"c1\" AS VARCHAR) AS \"channel\",\n  CAST(\"c2\" AS VARCHAR) AS \"cityName\",\n  DECODE_BASE64_COMPLEX('thetaSketch', \"c3\") AS \"user_theta\"\nFROM (\n  VALUES\n  ('ca', NULL, 'AQMDAAA6zJOcUskA1pEMGA=='),\n  ('de', NULL, 'AQMDAAA6zJP43ITYexvoEw=='),\n  ('de', NULL, 'AQMDAAA6zJNtue8WOvrJdA=='),\n  ('en', NULL, 'AQMDAAA6zJMruSUUqmzufg=='),\n  ('en', NULL, 'AQMDAAA6zJM6dC5sW2sTEg=='),\n  ('en', NULL, 'AQMDAAA6zJM6dC5sW2sTEg=='),\n  ('en', NULL, 'AQMDAAA6zJPqjEoIBIGtDw=='),\n  ('en', 'Caulfield', 'AQMDAAA6zJOOtGipKE6KIA=='),\n  ('fa', NULL, 'AQMDAAA6zJM8nxZkoGPlLw=='),\n  ('vi', NULL, 'AQMDAAA6zJMk4ZadSFqHJw==')\n) AS \"t\" (\"c1\", \"c2\", \"c3\")\n")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16458"},"#16458")),(0,r.kt)("h4",{id:"explore-view-improvements"},"Explore view improvements"),(0,r.kt)("p",null,"You can now configure the Explore view on top of a source query instead of only existing tables.\nYou can also point and click to edit the source query, store measures in the source query,\nand return to the state of your view using stateful URLs.\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/17180"},"#17180")),(0,r.kt)("p",null,"Other changes to the Explore view include the following:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Added the ability to define expressions and measures on the fly"),(0,r.kt)("li",{parentName:"ul"},"Added the ability to hide all null columns in the record table"),(0,r.kt)("li",{parentName:"ul"},"Added the ability to expand a nested column into is constituent paths\n",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17213"},"#17213")," ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17225"},"#17225")," ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17234"},"#17234")," ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17180"},"#17180"))),(0,r.kt)("h4",{id:"support-delta-lake-ingestion-in-the-data-loaders"},"Support Delta lake ingestion in the data loaders"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Added the Delta tile to the data loader for SQL-based batch and classic batch ingestion methods\n",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17160"},"#17160")," ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17023"},"#17023"))),(0,r.kt)("h4",{id:"support-kinesis-input-format"},"Support Kinesis input format"),(0,r.kt)("p",null,"The web console now supports the Kinesis input format.\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16850"},"#16850")),(0,r.kt)("h4",{id:"other-web-console-improvements"},"Other web console improvements"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"You can now search for datasources in the segment timeline visualization - previously you had to find them manually ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16371"},"#16371")),(0,r.kt)("li",{parentName:"ul"},"Showing JSON values (in query results) now display both raw and formatted JSON, making the data easier to read and troubleshoot ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16632"},"#16632")),(0,r.kt)("li",{parentName:"ul"},"Added the ability to submit a suspended supervisor from the data loader ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16696"},"#16696")),(0,r.kt)("li",{parentName:"ul"},"Added column mapping information to the explain plan ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16598"},"#16598")),(0,r.kt)("li",{parentName:"ul"},"Updated the Web Console to use array mode by default for schema discovery ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17133"},"#17133")),(0,r.kt)("li",{parentName:"ul"},"Fixed NPE due to null values in numeric columns ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16760"},"#16760"))),(0,r.kt)("h3",{id:"ingestion"},"Ingestion"),(0,r.kt)("h4",{id:"optimized-the-loading-of-broadcast-data-sources"},"Optimized the loading of broadcast data sources"),(0,r.kt)("p",null,"Previously all services and tasks downloaded all broadcast data sources.\nTo save task storage space and reduce task startup time, this modification prevents kill tasks and MSQ controller tasks from downloading unneeded broadcast data sources. All other tasks still load all broadcast data sources."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"CLIPeon")," command line option ",(0,r.kt)("inlineCode",{parentName:"p"},"--loadBroadcastSegments")," is deprecated in favor of ",(0,r.kt)("inlineCode",{parentName:"p"},"--loadBroadcastDatasourceMode"),"."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/17027"},"#17027")),(0,r.kt)("h4",{id:"general-ingestion-improvements"},"General ingestion improvements"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The default value for ",(0,r.kt)("inlineCode",{parentName:"li"},"druid.indexer.tasklock.batchAllocationWaitTime")," is now 0 ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16578"},"#16578")),(0,r.kt)("li",{parentName:"ul"},"Hadoop-based ingestion now works on Kubernetes deployments ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16726"},"#16726")),(0,r.kt)("li",{parentName:"ul"},"Hadoop-based ingestion now has a Boolean config ",(0,r.kt)("inlineCode",{parentName:"li"},"useMaxMemoryEstimates")," parameter, which controls how memory footprint gets estimated. The default is false, so that the behavior matches native JSON-based batch ingestion ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16280"},"#16280")),(0,r.kt)("li",{parentName:"ul"},"Added ",(0,r.kt)("inlineCode",{parentName:"li"},"druid-parquet-extensions")," to all example quickstart configurations ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16664"},"#16664")),(0,r.kt)("li",{parentName:"ul"},"Added support for ingesting CSV format data into Kafka records when Kafka ingestion is enabled with ",(0,r.kt)("inlineCode",{parentName:"li"},"ioConfig.type = kafka")," ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16630"},"#16630")),(0,r.kt)("li",{parentName:"ul"},"Added logging for sketches on workers ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16697"},"#16697")),(0,r.kt)("li",{parentName:"ul"},"Removed obsolete tasks ",(0,r.kt)("inlineCode",{parentName:"li"},"index_realtime")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"index_realtime_appenderator")," tasks","\u2014","you can no longer use these tasks to ingest data ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16602"},"#16602")),(0,r.kt)("li",{parentName:"ul"},"Renamed ",(0,r.kt)("inlineCode",{parentName:"li"},"TaskStorageQueryAdapter")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"TaskQueryTool")," and removed the ",(0,r.kt)("inlineCode",{parentName:"li"},"isAudited")," method ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16750"},"#16750")),(0,r.kt)("li",{parentName:"ul"},"Improved Overlord performance by reducing redundant calls in SQL statements ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16839"},"#16839")),(0,r.kt)("li",{parentName:"ul"},"Improved ",(0,r.kt)("inlineCode",{parentName:"li"},"CustomExceptionMapper")," so that it returns a correct failure message ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17016"},"#17016")),(0,r.kt)("li",{parentName:"ul"},"Improved time filtering in subqueries and non-table data sources ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17173"},"#17173")),(0,r.kt)("li",{parentName:"ul"},"Improved ",(0,r.kt)("inlineCode",{parentName:"li"},"WindowOperatorQueryFrameProcessor")," to avoid unnecessary re-runs ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17211"},"#17211")),(0,r.kt)("li",{parentName:"ul"},"Improved memory management by dividing the amount of ",(0,r.kt)("inlineCode",{parentName:"li"},"partitionStatsMemory")," by two to account for two simultaneous statistics collectors ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17216"},"#17216")),(0,r.kt)("li",{parentName:"ul"},"Fixed NPE in ",(0,r.kt)("inlineCode",{parentName:"li"},"CompactSegments")," ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16713"},"#16713")),(0,r.kt)("li",{parentName:"ul"},"Fixed Parquet reader to ensure that Druid reads the required columns for a filter from the Parquet data files ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16874"},"#16874")),(0,r.kt)("li",{parentName:"ul"},"Fixed a distinct sketches issue where Druid called ",(0,r.kt)("inlineCode",{parentName:"li"},"retainedKeys.firstKey()")," twice when adding another sketch ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17184"},"#17184")),(0,r.kt)("li",{parentName:"ul"},"Fixed a ",(0,r.kt)("inlineCode",{parentName:"li"},"WindowOperatorQueryFrameProcessor")," issue where larger queries could reach the frame writer's capacity preventing it from outputting all of the result rows ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17209"},"#17209")),(0,r.kt)("li",{parentName:"ul"},"Fixed native ingestion task failures during rolling upgrades from a version before Druid 30 ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17219"},"#17219"))),(0,r.kt)("h4",{id:"sql-based-ingestion"},"SQL-based ingestion"),(0,r.kt)("h5",{id:"optimized-s3-storage-writing-for-msq-durable-storage"},"Optimized S3 storage writing for MSQ durable storage"),(0,r.kt)("p",null,"For queries that use the MSQ task engine and write their output to S3 as durable storage, uploading chunks of data is now faster."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16481"},"#16481")),(0,r.kt)("h5",{id:"improved-lookup-performance"},"Improved lookup performance"),(0,r.kt)("p",null,"Improved lookup performance for queries that use the MSQ task engine by only loading required lookups. This applies to both ingestion and querying."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16358"},"#16358")),(0,r.kt)("h4",{id:"other-sql-based-ingestion-improvements"},"Other SQL-based ingestion improvements"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Added the ability to use ",(0,r.kt)("inlineCode",{parentName:"li"},"useConcurrentLocks")," in task context to determine task lock type ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17193"},"#17193")),(0,r.kt)("li",{parentName:"ul"},"Improved error handling when retrieving Avro schemas from registry ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16684"},"#16684")),(0,r.kt)("li",{parentName:"ul"},"Fixed issues related to partitioning boundaries in the MSQ task engine's window functions ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16729"},"#16729")),(0,r.kt)("li",{parentName:"ul"},"Fixed a boost column issue causing quantile sketches to incorrectly estimate the number of output partitions to create ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17141"},"#17141")),(0,r.kt)("li",{parentName:"ul"},"Fixed an issue with ",(0,r.kt)("inlineCode",{parentName:"li"},"ScanQueryFrameProcessor")," cursor build not adjusting intervals ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17168"},"#17168")),(0,r.kt)("li",{parentName:"ul"},"Improved worker cancellation for the MSQ task engine to prevent race conditions ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17046"},"#17046")),(0,r.kt)("li",{parentName:"ul"},"Improved memory management to better support multi-threaded workers ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17057"},"#17057")),(0,r.kt)("li",{parentName:"ul"},"Added new format for serialization of sketches between MSQ controller and worker to reduce memory usage ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16269"},"#16269")),(0,r.kt)("li",{parentName:"ul"},"Improved error handling when retrieving Avro schemas from registry ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16684"},"#16684")),(0,r.kt)("li",{parentName:"ul"},"Fixed issues related to partitioning boundaries in the MSQ task engine's window functions ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16729"},"#16729")),(0,r.kt)("li",{parentName:"ul"},'Fixed handling of null bytes that led to a runtime exception for "Invalid value start byte" ',(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17232"},"#17232")),(0,r.kt)("li",{parentName:"ul"},"Updated logic to fix incorrect query results for comparisons involving arrays ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16780"},"#16780")),(0,r.kt)("li",{parentName:"ul"},"You can now pass a custom ",(0,r.kt)("inlineCode",{parentName:"li"},"DimensionSchema")," map to MSQ query destination of type ",(0,r.kt)("inlineCode",{parentName:"li"},"DataSourceMSQDestination")," instead of using the default values ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16864"},"#16864")),(0,r.kt)("li",{parentName:"ul"},"Fixed the calculation of suggested memory in ",(0,r.kt)("inlineCode",{parentName:"li"},"WorkerMemoryParameters")," to account for ",(0,r.kt)("inlineCode",{parentName:"li"},"maxConcurrentStages")," which improves the accuracy of error messages ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17108"},"#17108")),(0,r.kt)("li",{parentName:"ul"},"Optimized the row-based frame writer to reduce failures when writing larger single rows to frames ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17094"},"#17094"))),(0,r.kt)("h3",{id:"streaming-ingestion"},"Streaming ingestion"),(0,r.kt)("h4",{id:"new-kinesis-input-format"},"New Kinesis input format"),(0,r.kt)("p",null,"Added a Kinesis input format and reader for timestamp and payload parsing.\nThe reader relies on a ",(0,r.kt)("inlineCode",{parentName:"p"},"ByteEntity")," type of ",(0,r.kt)("inlineCode",{parentName:"p"},"KinesisRecordEntity")," which includes the underlying Kinesis record."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16813"},"#16813")),(0,r.kt)("h4",{id:"streaming-ingestion-improvements"},"Streaming ingestion improvements"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Added a check for handing off upgraded real-time segments. This prevents data from being temporarily unavailable for queries during segment handoff ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16162"},"#16162")),(0,r.kt)("li",{parentName:"ul"},"Improved the user experience for autoscaling Kinesis. Switching to autoscaling based on max lag per shard from total lag for shard is now controlled by the ",(0,r.kt)("inlineCode",{parentName:"li"},"lagAggregate")," config, defaulting to sum ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16334"},"#16334")),(0,r.kt)("li",{parentName:"ul"},"Improved the Supervisor so that it doesn't change to a running state from idle if the Overlord restarts ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16844"},"#16844"))),(0,r.kt)("h3",{id:"querying"},"Querying"),(0,r.kt)("h4",{id:"dart-1"},"Dart"),(0,r.kt)("p",null,"Dart is a query engine with multi-threaded workers that conducts in-memory shuffles to provide tunable concurrency and infrastructure costs for low-latency high complexity queries."),(0,r.kt)("p",null,"To try out Dart, set ",(0,r.kt)("inlineCode",{parentName:"p"},"druid.msq.dart.enabled")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," in your common runtime properties. Then, you can select Dart as a query engine in the web console or through the API ",(0,r.kt)("inlineCode",{parentName:"p"},"/druid/v2/sql/dart"),", which accepts the same JSON payload as ",(0,r.kt)("inlineCode",{parentName:"p"},"/druid/v2/sql"),". Dart is fully compatible with current Druid query shapes and Druid's storage format. That means you can try Dart with your existing queries and datasources."),(0,r.kt)("h4",{id:"projections"},"Projections"),(0,r.kt)("p",null,"As an experimental feature, projections are not well documented yet, but can be defined for streaming ingestion and 'classic' batch ingestion as part of the ",(0,r.kt)("inlineCode",{parentName:"p"},"dataSchema"),". For an example ingestion spec, see the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/17214"},"the pull request description for #17214"),"."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"groupingColumns")," field in the spec defines the order which data is sorted in the projection. Instead of explicitly defining granularity like for the base table, you define it with a virtual column. During ingestion, the processing logic finds the \u2018finest\u2019 granularity virtual column that is a ",(0,r.kt)("inlineCode",{parentName:"p"},"timestamp_floor")," expression and uses it as the ",(0,r.kt)("inlineCode",{parentName:"p"},"__time")," column for the projection. Projections do not need to have a time column defined. In these cases, they can still match queries that are not grouping on time."),(0,r.kt)("p",null,"There are new query context flags that have been added to aid in experimentation with projections:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"useProjection")," accepts a specific projection name and instructs the query engine that it must use that projection, and will fail the query if the projection does not match the query")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"forceProjections")," accepts true or false and instructs the query engine that it must use a projection, and will fail the query if it cannot find a matching projection")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"noProjections")," accepts true or false and instructs the query engines to not use any projections"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/17214"},"#17214")))),(0,r.kt)("h4",{id:"enabled-querying-cold-datasources"},"Enabled querying cold datasources"),(0,r.kt)("p",null,"You can now query entirely cold datasources after you enable the ",(0,r.kt)("inlineCode",{parentName:"p"},"CentralizedDatasourceSchema")," feature. For information about how to use a centralized datasource schema, see ",(0,r.kt)("a",{parentName:"p",href:"https://druid.apache.org/docs/latest/configuration/#centralized-datasource-schema"},"Centralized datasource schema"),"."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16676"},"#16676")),(0,r.kt)("h4",{id:"sql-div-function"},"SQL DIV function"),(0,r.kt)("p",null,"You can now use the SQL DIV function."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16464"},"#16464")),(0,r.kt)("h4",{id:"modified-equality-and-typed-in-filter-behavior"},"Modified equality and typed in filter behavior"),(0,r.kt)("p",null,"Modified the behavior of using ",(0,r.kt)("inlineCode",{parentName:"p"},"EqualityFilter")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"TypedInFilter")," to match numeric values (particularly DOUBLE) against string columns by casting strings for numerical comparison. This ensures more consistent Druid behavior when the ",(0,r.kt)("inlineCode",{parentName:"p"},"sqlUseBoundAndSelectors")," context flag is set."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16593"},"#16593")),(0,r.kt)("h4",{id:"window-query-guardrails"},"Window query guardrails"),(0,r.kt)("p",null,"Druid blocks window queries that involve aggregation functions inside the window clause when the window is included in SELECT.\nThe error message provides details on updating your query syntax."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16801"},"#16801")),(0,r.kt)("h4",{id:"updated-query-from-deep-storage-api-response"},"Updated query from deep storage API response"),(0,r.kt)("p",null,"Added the following fields from the query-based ingestion task report to the response for API request ",(0,r.kt)("inlineCode",{parentName:"p"},"GET")," ",(0,r.kt)("inlineCode",{parentName:"p"},"/v2/sql/statements/query-id?detail=true"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"stages"),": Query stages"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"counters"),": Stage counters"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"warnings"),": Warning reports")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16808"},"#16808")),(0,r.kt)("h4",{id:"other-querying-improvements"},"Other querying improvements"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Improved window queries so that window queries without group by using the native engine don't return an empty response ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16658"},"#16658")),(0,r.kt)("li",{parentName:"ul"},"Window queries now support the guardrail ",(0,r.kt)("inlineCode",{parentName:"li"},"maxSubqueryBytes"),"  ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16800"},"#16800")),(0,r.kt)("li",{parentName:"ul"},"Window functions that use the MSQ task engine now reject MVDs when they're used as the PARTITION BY column. Previously, an exception occurred ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17036"},"#17036")),(0,r.kt)("li",{parentName:"ul"},"A query that references aggregators called with unsupported distinct values now fails ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16770"},"#16770")),(0,r.kt)("li",{parentName:"ul"},"Druid now validates that a complex type aligns with the supported types when used with an aggregator ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16682"},"#16682")),(0,r.kt)("li",{parentName:"ul"},"Druid prevents you from using DISTINCT or unsupported aggregations with window functions ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16738"},"#16738")),(0,r.kt)("li",{parentName:"ul"},"Druid now deduces type from aggregators when materializing subquery results ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16703"},"#16703")),(0,r.kt)("li",{parentName:"ul"},"Added the ability to define the segment granularity of a table in the catalog ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16680"},"#16680")),(0,r.kt)("li",{parentName:"ul"},"Added a way for columns to provide ",(0,r.kt)("inlineCode",{parentName:"li"},"GroupByVectorColumnSelectors"),", which controls how the groupBy engine operates on them ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16338"},"#16338")),(0,r.kt)("li",{parentName:"ul"},"Added ",(0,r.kt)("inlineCode",{parentName:"li"},"sqlPlannerBloat")," query context parameter to control whether two project operators get merged when inlining expressions ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16248"},"#16248")),(0,r.kt)("li",{parentName:"ul"},"Improved window function offsets for ",(0,r.kt)("inlineCode",{parentName:"li"},"ArrayListRowsAndColumns")," ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16718"},"#16718")),(0,r.kt)("li",{parentName:"ul"},"Improved the fallback strategy when the Broker is unable to materialize the subquery's results as frames for estimating the bytes ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16679"},"#16679")),(0,r.kt)("li",{parentName:"ul"},"Improved how Druid executes queries that contain a LIMIT clause ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16643"},"#16643")),(0,r.kt)("li",{parentName:"ul"},"Improved the code style of ",(0,r.kt)("inlineCode",{parentName:"li"},"NestedDataOperatorConversions")," to be consistent for each ",(0,r.kt)("inlineCode",{parentName:"li"},"SqlOperatorConversion")," ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16695"},"#16695")),(0,r.kt)("li",{parentName:"ul"},"Improved window functions so that they reject multi-value dimensions during processing instead of failing to process them ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17002"},"#17002")),(0,r.kt)("li",{parentName:"ul"},"Improved async query by increasing its timeout to 5 seconds ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16656"},"#16656")),(0,r.kt)("li",{parentName:"ul"},"Improved error message when the requested number of rows in a window exceeds the maximum ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16906"},"#16906")),(0,r.kt)("li",{parentName:"ul"},"Improved numeric aggregations so that Druid now coerces complex types to number when possible, such as for ",(0,r.kt)("inlineCode",{parentName:"li"},"SpectatorHistogram")," ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16564"},"#16564")),(0,r.kt)("li",{parentName:"ul"},"Improved query filtering to correctly process cases where both an IN expression and an equality (",(0,r.kt)("inlineCode",{parentName:"li"},"="),") filter are applied to the same string value ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16597"},"#16597")),(0,r.kt)("li",{parentName:"ul"},"Improved the speed of SQL IN queries that use the SCALAR_IN_ARRAY function ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16388"},"#16388")),(0,r.kt)("li",{parentName:"ul"},"Improved the ARRAY_TO_MV function to handle cases where an object selector encounters a multi-value string ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17162"},"#17162")),(0,r.kt)("li",{parentName:"ul"},"Improved query filtering so that Druid tries to arrange query filters based on the computational cost of bitmap indexes, prioritizing less expensive filters for computation first. Filters with high compute costs relative to the number of rows they can filter might be omitted. ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17055"},"#17055")," ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17125"},"#17125")),(0,r.kt)("li",{parentName:"ul"},"Updated the deserialization of dimensions in GROUP BY queries to operate on all dimensions at once rather than deserializing individual dimensions ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16740"},"#16740")),(0,r.kt)("li",{parentName:"ul"},"Fixed an issue that caused ",(0,r.kt)("inlineCode",{parentName:"li"},"maxSubqueryBytes")," to fail when segments had missing columns ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16619"},"#16619")),(0,r.kt)("li",{parentName:"ul"},"Fixed an issue with the array type selector that caused the array aggregation over window frame to fail ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16653"},"#16653")),(0,r.kt)("li",{parentName:"ul"},"Fixed support for native window queries without a group by clause ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16753"},"#16753")),(0,r.kt)("li",{parentName:"ul"},"Window functions now support ",(0,r.kt)("inlineCode",{parentName:"li"},"maxSubqueryBytes")," ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16800"},"#16800")),(0,r.kt)("li",{parentName:"ul"},"Fixed an issue with window functions and partitioning ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17141"},"#17141")),(0,r.kt)("li",{parentName:"ul"},"Updated window functions to disallow multi-value dimensions for partitioning ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17036"},"#17036")),(0,r.kt)("li",{parentName:"ul"},"Fixed an issue with casting objects to vector expressions ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17148"},"#17148")),(0,r.kt)("li",{parentName:"ul"},"Added several fixes and improvements to vectorization fallback ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17098"},"#17098"),", ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17162"},"#17162")),(0,r.kt)("li",{parentName:"ul"},"You can now configure encoding method for sketches at query time ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17086"},"#17086")),(0,r.kt)("li",{parentName:"ul"},"Fixed an issue with joins failing to time out on Historicals ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17099"},"#17099"))),(0,r.kt)("h3",{id:"cluster-management"},"Cluster management"),(0,r.kt)("h4",{id:"added-cluster-configuration-for-multivalue-handling"},"Added cluster configuration for multivalue handling"),(0,r.kt)("p",null,"Added an optional cluster configuration property ",(0,r.kt)("inlineCode",{parentName:"p"},"druid.indexing.formats.stringMultiValueHandlingMode")," which overrides the default mode ",(0,r.kt)("inlineCode",{parentName:"p"},"SORTED_SET")," used for string dimensions. Possible values are ",(0,r.kt)("inlineCode",{parentName:"p"},"SORTED_SET")," (default), ",(0,r.kt)("inlineCode",{parentName:"p"},"SORTED_ARRAY"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"ARRAY"),"."),(0,r.kt)("p",null,"Note that we recommend you use array types instead of MVDs where possible. For more information, see ",(0,r.kt)("a",{parentName:"p",href:"https://druid.apache.org/docs/latest/release-info/migr-mvd-array"},"Migration guide: MVD to arrays"),"."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16822"},"#16822")),(0,r.kt)("h4",{id:"api-for-cluster-level-compaction-configuration"},"API for cluster-level compaction configuration"),(0,r.kt)("p",null,"Druid now offers an API to update the cluster-level compaction dynamic configuration:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"POST /druid/coordinator/v1/config/compaction/cluster\n")),(0,r.kt)("p",null,"Example payload:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n     "compactionTaskSlotRatio": 0.5,\n     "maxCompactionTaskSlots": 10,\n     "engine": "msq"\n}\n')),(0,r.kt)("p",null,"This API deprecates the older API ",(0,r.kt)("inlineCode",{parentName:"p"},"/druid/coordinator/v1/config/compaction/taskslots"),"."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16803"},"#16803")),(0,r.kt)("h4",{id:"guardrail-for-task-payload-size"},"Guardrail for task payload size"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"druid.indexer.queue.maxTaskPayloadSize")," config defines the maximum size in bytes of a task payload accepted by the Overlord service. The default is 60 MB."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16512"},"#16512")),(0,r.kt)("h4",{id:"improved-ux-for-coordinator-management"},"Improved UX for Coordinator management"),(0,r.kt)("p",null,"Improve the user experience around Coordinator management as follows:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Added an API ",(0,r.kt)("inlineCode",{parentName:"li"},"GET /druid/coordinator/v1/duties")," that returns a status list of all duty groups currently running on the Coordinator"),(0,r.kt)("li",{parentName:"ul"},"The Coordinator now emits the following metrics: ",(0,r.kt)("inlineCode",{parentName:"li"},"segment/poll/time"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"segment/pollWithSchema/time"),", and ",(0,r.kt)("inlineCode",{parentName:"li"},"segment/buildSnapshot/time")),(0,r.kt)("li",{parentName:"ul"},"Remove redundant logs that indicate normal operation of well-tested aspects of the Coordinator")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16959"},"#16959")),(0,r.kt)("h4",{id:"other-cluster-management-improvements"},"Other cluster management improvements"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The startup script for Docker-based deployments now specifies the node type ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16282"},"#16282")),(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"druid.sh")," script now uses the canonical hostname for ",(0,r.kt)("inlineCode",{parentName:"li"},"druid.host")," by default. You can now set the following environment variable to use IP instead: ",(0,r.kt)("inlineCode",{parentName:"li"},"DRUID_SET_HOST_IP=1")," ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16386"},"#16386")),(0,r.kt)("li",{parentName:"ul"},"Fixed an issue with tombstone segments incorrectly appearing unavailable in the Web Console ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17025"},"#17025"))),(0,r.kt)("h3",{id:"data-management"},"Data management"),(0,r.kt)("h4",{id:"compaction"},"Compaction"),(0,r.kt)("h5",{id:"compaction-supervisors-experimental"},"Compaction supervisors (experimental)"),(0,r.kt)("p",null,"You can now configure automatic compaction to run as a supervisor rather than as a Coordinator duty. Compaction supervisors provide the following benefits over Coordinator duties:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Can use the supervisor framework to get information about the auto-compaction, such as status or state"),(0,r.kt)("li",{parentName:"ul"},"More easily suspend or resume compaction for a datasource"),(0,r.kt)("li",{parentName:"ul"},"Can use either the native compaction engine or the MSQ task engine"),(0,r.kt)("li",{parentName:"ul"},"More reactive and submits tasks as soon as a compaction slot is available"),(0,r.kt)("li",{parentName:"ul"},"Tracked compaction task status to avoid re-compacting an interval repeatedly")),(0,r.kt)("p",null,"You can submit your existing auto-compaction configs as part of the supervisor spec; the two auto-compaction options share the same syntax."),(0,r.kt)("p",null,"For more information, see ",(0,r.kt)("a",{parentName:"p",href:"https://druid.apache.org/docs/latest/data-management/automatic-compaction"},"Automatic compaction"),"."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16291"},"#16291")," ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16768"},"#16768")),(0,r.kt)("h4",{id:"kill-tasks"},"Kill tasks"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"KillUnusedSegments")," coordinator duty now selects datasources in a round-robin manner during each run, ensuring varied selection instead of repeatedly choosing the same set of datasources ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16719"},"#16719")),(0,r.kt)("li",{parentName:"ul"},"Kill tasks can now use different types of locks, such as APPEND or REPLACE. This change is experimental and not recommended for production use ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16362"},"#16362"))),(0,r.kt)("h4",{id:"other-data-management-improvements"},"Other data management improvements"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Improved the performance of the metadata query to fetch unused segments for a datasource returns results, which could cause issues with Overlord stability. Test queries that used to take over 30 seconds now complete in less than a second ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16623"},"#16623")),(0,r.kt)("li",{parentName:"ul"},"Fixed an issue in task bootstrapping that prevented tasks from accepting any segment assignments, including broadcast segments ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16475"},"#16475")),(0,r.kt)("li",{parentName:"ul"},"Improved the performance for writing segments ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16698"},"#16698")),(0,r.kt)("li",{parentName:"ul"},"Improved the logic so that unused segments and tombstones in the metadata cache don't get needlessly refreshed ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16990"},"#16990")," ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17025"},"17025")),(0,r.kt)("li",{parentName:"ul"},"Improved how segments are fetched so that they can be reused ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17021"},"#17021"))),(0,r.kt)("h3",{id:"storage-improvements-1"},"Storage improvements"),(0,r.kt)("h4",{id:"compression-for-complex-columns"},"Compression for complex columns"),(0,r.kt)("p",null,"Compression is now available for all complex metric columns which don't have specialized implementations. You can configure the ",(0,r.kt)("inlineCode",{parentName:"p"},"complexMetricCompression")," IndexSpec option to any compression strategy (",(0,r.kt)("inlineCode",{parentName:"p"},"lz4"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"zstd"),", etc). The default is uncompressed. This works for most complex columns except ",(0,r.kt)("inlineCode",{parentName:"p"},"compressed-big-decimal")," and columns stored by first/last aggregators."),(0,r.kt)("p",null,"Note that enabling compression is not backwards compatible with Druid versions older than 31. Only enable it after comprehensive testing to ensure no need for rollback."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16863"},"#16863")),(0,r.kt)("h4",{id:"flexible-segment-sorting"},"Flexible segment sorting"),(0,r.kt)("p",null,"Added the ability to sort segments by dimensions other than ",(0,r.kt)("inlineCode",{parentName:"p"},"__time")," - this provides a significant storage benefit. Control the sorting method using the ",(0,r.kt)("inlineCode",{parentName:"p"},"segmentSortOrder")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"forceSegmentSortByTime")," query context parameters. "),(0,r.kt)("p",null,"This feature is not backwards compatible. Only enable it after comprehensive testing to ensure no need for rollback."),(0,r.kt)("p",null,"For more information, see ",(0,r.kt)("a",{parentName:"p",href:"https://druid.apache.org/docs/latest/multi-stage-query/reference/#context-parameters"},"Context parameters"),"."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16849"},"#16849"),"\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16958"},"#16958")),(0,r.kt)("h3",{id:"apis"},"APIs"),(0,r.kt)("h4",{id:"new-api-for-exiting-streaming-task-groups-early"},"New API for exiting streaming task groups early"),(0,r.kt)("p",null,"This new API does a best effort attempt to trigger the handoff for specified task groups of a supervisor early:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"POST")," ",(0,r.kt)("inlineCode",{parentName:"p"},"/druid/indexer/v1/supervisor/{supervisorId}/taskGroups/handoff")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16310"},"#16310")),(0,r.kt)("h4",{id:"api-to-fetch-conflicting-task-locks"},"API to fetch conflicting task locks"),(0,r.kt)("p",null,"You can use the new ",(0,r.kt)("inlineCode",{parentName:"p"},"/activeLocks")," API to view task locks for the following attributes:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Datasource"),(0,r.kt)("li",{parentName:"ul"},"Priority"),(0,r.kt)("li",{parentName:"ul"},"Interval list")),(0,r.kt)("p",null,"Use this API for debugging, to view lock contention, and to observe any concurrent locks."),(0,r.kt)("h3",{id:"metrics-and-monitoring"},"Metrics and monitoring"),(0,r.kt)("h4",{id:"cgroup-usage"},"Cgroup usage"),(0,r.kt)("p",null,"The following Cgroup metrics are now available:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Metric"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Dimensions"),(0,r.kt)("th",{parentName:"tr",align:null},"Normal value"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"cgroup/cpu/usage/total/percentage")),(0,r.kt)("td",{parentName:"tr",align:null},"Total cpu percentage used by cgroup of process that is running"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"0-100")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"cgroup/cpu/usage/user/percentage")),(0,r.kt)("td",{parentName:"tr",align:null},"User cpu percentage used by cgroup of process that is running"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"0-100")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"cgroup/cpu/usage/sys/percentage")),(0,r.kt)("td",{parentName:"tr",align:null},"Sys cpu percentage used by cgroup of process that is running"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"0-100")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"cgroup/disk/read/size")),(0,r.kt)("td",{parentName:"tr",align:null},"Reports the number of bytes transferred to specific devices by a cgroup of process that is running."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"diskName")),(0,r.kt)("td",{parentName:"tr",align:null},"Varies")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"cgroup/disk/write/size")),(0,r.kt)("td",{parentName:"tr",align:null},"Reports the number of bytes transferred from specific devices by a cgroup of process that is running."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"diskName")),(0,r.kt)("td",{parentName:"tr",align:null},"Varies")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"cgroup/disk/read/count")),(0,r.kt)("td",{parentName:"tr",align:null},"Reports the number of read operations performed on specific devices by a cgroup of process that is running."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"diskName")),(0,r.kt)("td",{parentName:"tr",align:null},"Varies")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"cgroup/disk/write/count")),(0,r.kt)("td",{parentName:"tr",align:null},"Reports the number of write operations performed on specific devices by a cgroup of process that is running."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"diskName")),(0,r.kt)("td",{parentName:"tr",align:null},"Varies")))),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16472"},"#16472")),(0,r.kt)("h4",{id:"default-prometheus-metrics"},"Default Prometheus metrics"),(0,r.kt)("p",null,"The default Prometheus metrics have been expanded to cover more of the available metrics for Druid."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16340"},"#16340")),(0,r.kt)("h4",{id:"configurable-connection-timeouts"},"Configurable connection timeouts"),(0,r.kt)("p",null,"Added HTTP client property ",(0,r.kt)("inlineCode",{parentName:"p"},"clientConnectTimeout")," to enable configuration of connection timeouts for Druid HTTP client requests."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16831"},"#16831")),(0,r.kt)("h4",{id:"added-indexer-metrics"},"Added indexer metrics"),(0,r.kt)("p",null,"Added ",(0,r.kt)("inlineCode",{parentName:"p"},"indexer/task/failed/count")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"indexer/task/failed/count")," metrics."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16829"},"#16829")),(0,r.kt)("h4",{id:"added-subquery-metrics"},"Added subquery metrics"),(0,r.kt)("p",null,"Added ",(0,r.kt)("inlineCode",{parentName:"p"},"subquery/rows")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"subquery/bytes")," metrics, which indicate the size of the results materialized on the heap."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16835"},"#16835")),(0,r.kt)("h4",{id:"added-segment-loading-rate-metrics"},"Added segment loading rate metrics"),(0,r.kt)("p",null,"Made the following changes to segment loading rate metrics:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Added ",(0,r.kt)("inlineCode",{parentName:"li"},"LoadingRateTracker")," which computes a moving average load rate based on\nthe last few GBs of successful segment loads."),(0,r.kt)("li",{parentName:"ul"},"Added ",(0,r.kt)("inlineCode",{parentName:"li"},"expectedLoadTimeMillis")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"/druid/coordinator/v1/loadQueue?simple")," API response."),(0,r.kt)("li",{parentName:"ul"},"Updated the Coordinator to emit ",(0,r.kt)("inlineCode",{parentName:"li"},"segment/loading/rateKbps"),".")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16691"},"#16691")),(0,r.kt)("h3",{id:"extensions"},"Extensions"),(0,r.kt)("h4",{id:"kubernetes-improvements"},"Kubernetes improvements"),(0,r.kt)("p",null,"When the fabric client is unable to communicate with the Kubernetes server, the shutdown logic now proceeds without populating the task status location, ensuring all data structures are cleaned up."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16711"},"#16711")),(0,r.kt)("h4",{id:"pac4j-oidc-context"},(0,r.kt)("inlineCode",{parentName:"h4"},"pac4j")," OIDC context"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"pac4j")," extension now returns the OIDC context for ",(0,r.kt)("inlineCode",{parentName:"p"},"AuthenticationResult"),"."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16109"},"#16109")),(0,r.kt)("h4",{id:"middle-manager-less-druid-improvements"},"Middle Manager-less Druid improvements"),(0,r.kt)("p",null,"The Dynamic Pod Template Selection feature enhances the K8s extension by enabling more flexible and dynamic selection of pod templates based on task properties, which can optimize resource utilization and task execution efficiency."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16510"},"#16510")),(0,r.kt)("p",null,"In MiddleManager-less ingestion, Druid adds the pod template name as an annotation to the created job or pod."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16772"},"#16772")),(0,r.kt)("h4",{id:"improved-iceberg-input-source-support"},"Improved Iceberg input source support"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"You can now optionally use the ",(0,r.kt)("inlineCode",{parentName:"li"},"caseSensitive")," Boolean config to configure how Druid reads column names from Iceberg. Iceberg table scans are case sensitive by default ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16496"},"#16496")),(0,r.kt)("li",{parentName:"ul"},"Added support to the ",(0,r.kt)("inlineCode",{parentName:"li"},"iceberg")," input source to read from Iceberg REST catalogs ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17124"},"#17124"))),(0,r.kt)("h4",{id:"delta-lake-complex-types"},"Delta Lake complex types"),(0,r.kt)("p",null,"Added support for delta structs, arrays, and maps to the ",(0,r.kt)("inlineCode",{parentName:"p"},"delta")," input source. "),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16884"},"#16884")," "),(0,r.kt)("h4",{id:"delta-lake-snapshot-versions"},"Delta Lake snapshot versions"),(0,r.kt)("p",null,"Added the ability to optionally specify a ",(0,r.kt)("inlineCode",{parentName:"p"},"snapshotVersion")," in the delta input source payload to ingest versioned snapshots from a Delta Lake table. When not specified, Druid ingests the latest snapshot from the table. "),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/17004"},"#17004")),(0,r.kt)("h4",{id:"other-extensions-improvements"},"Other extensions improvements"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Added an informational entry to the streaming supervisor log when task count is greater than the number of partitions ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16948"},"#16948")),(0,r.kt)("li",{parentName:"ul"},"Reduced logging in S3 output stream extension ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16853"},"#16853")),(0,r.kt)("li",{parentName:"ul"},"Reduced logging in basic security extension ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16767"},"#16767"))),(0,r.kt)("h2",{id:"upgrade-notes-and-incompatible-changes"},"Upgrade notes and incompatible changes"),(0,r.kt)("h3",{id:"upgrade-notes"},"Upgrade notes"),(0,r.kt)("h4",{id:"array-ingest-mode-now-defaults-to-array"},"Array ingest mode now defaults to array"),(0,r.kt)("p",null,"The SQL-based ingestion context flag ",(0,r.kt)("inlineCode",{parentName:"p"},"arrayIngestMode")," now defaults to ",(0,r.kt)("inlineCode",{parentName:"p"},"array")," instead of ",(0,r.kt)("inlineCode",{parentName:"p"},"mvd"),". This means that SQL ",(0,r.kt)("inlineCode",{parentName:"p"},"VARCHAR ARRAY")," types is no longer implicitly translated and stored in ",(0,r.kt)("inlineCode",{parentName:"p"},"VARCHAR")," columns, but is instead stored as ",(0,r.kt)("inlineCode",{parentName:"p"},"VARCHAR ARRAY"),". This change permits other array types such as ",(0,r.kt)("inlineCode",{parentName:"p"},"BIGINT ARRAY")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"DOUBLE ARRAY")," to be inserted with MSQ into their respective array column types instead of failing as they do in ",(0,r.kt)("inlineCode",{parentName:"p"},"mvd")," mode."),(0,r.kt)("p",null,"To continue to store multi-value strings, modify any insert/replace queries to wrap the array types with the ",(0,r.kt)("inlineCode",{parentName:"p"},"ARRAY_TO_MV")," operator."),(0,r.kt)("p",null,"Validation is in place to prevent mixing ",(0,r.kt)("inlineCode",{parentName:"p"},"VARCHAR")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"VARCHAR ARRAY")," columns in the same table, so any ingestions affected by this change will fail and provide a descriptive error message instead of exhibiting unexpected behavior."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"arrayIngestMode")," option of ",(0,r.kt)("inlineCode",{parentName:"p"},"none")," has been removed. It was introduced prior to the table validation logic as a means for cluster operators to force query writers to explicitly set ",(0,r.kt)("inlineCode",{parentName:"p"},"array")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"mvd")," on their query contexts but provides little utility in Druid 31."),(0,r.kt)("p",null,"See the following topics for more information:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://druid.apache.org/docs/latest/querying/multi-value-dimensions#sql-based-ingestion"},"Ingest multi-value dimensions")," for how to ingest multi-value strings."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://druid.apache.org/docs/latest/querying/arrays#sql-based-ingestion"},"Ingest arrays")," for ingesting arrays.")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16789"},"#16789")),(0,r.kt)("h4",{id:"removed-task-action-audit-logging"},"Removed task action audit logging"),(0,r.kt)("p",null,"The deprecated task action audit logging has been removed. This change includes the following updates:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The endpoint ",(0,r.kt)("inlineCode",{parentName:"li"},"/indexer/v1/task/{taskId}/segments")," is no longer supported."),(0,r.kt)("li",{parentName:"ul"},"Druid doesn't write to or read from the metadata table ",(0,r.kt)("inlineCode",{parentName:"li"},"druid_taskLog"),"."),(0,r.kt)("li",{parentName:"ul"},"Druid ignores the property ",(0,r.kt)("inlineCode",{parentName:"li"},"druid.indexer.auditlog.enabled"),"."),(0,r.kt)("li",{parentName:"ul"},"Druid doesn't emit the metric ",(0,r.kt)("inlineCode",{parentName:"li"},"task/action/log/time"),".")),(0,r.kt)("p",null,"These changes are backward compatible with all existing metadata storage extensions."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16309"},"#16309")),(0,r.kt)("h4",{id:"removed-firehose-and-firehosefactory"},"Removed Firehose and FirehoseFactory"),(0,r.kt)("p",null,"Removed Firehose and FirehoseFactory and remaining implementations.\nApache deprecated support for Druid firehoses in version 0.17. Support for firehose ingestion was removed in version 26.0."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16758"},"#16758")),(0,r.kt)("h4",{id:"front-coded-dictionaries"},"Front-coded dictionaries"),(0,r.kt)("p",null,"In Druid 32.0.0, the front coded dictionaries feature will be turned on by default. Front-coded dictionaries reduce storage and improve performance by optimizing for strings where the front part looks similar."),(0,r.kt)("p",null,"Once this feature is on, you cannot easily downgrade to an earlier version that does not support the feature. "),(0,r.kt)("p",null,"For more information, see ",(0,r.kt)("a",{parentName:"p",href:"https://druid.apache.org/docs/latest/release-info/migr-front-coded-dict"},"Migration guide: front-coded dictionaries"),"."),(0,r.kt)("p",null,"If you're already using this feature, you don't need to take any action. "),(0,r.kt)("h4",{id:"storage-improvement-features"},"Storage improvement features"),(0,r.kt)("p",null,"Druid 31.0.0 includes storage improvements that are not backwards compatible. Once you enable ",(0,r.kt)("a",{parentName:"p",href:"#flexible-segment-sorting"},"flexible segment sorting")," or ",(0,r.kt)("a",{parentName:"p",href:"#compression-for-complex-columns"},"compression for complex columns"),", you cannot downgrade to a release earlier than 31.0.0. Thoroughly test these features before rolling them out to your production cluster."),(0,r.kt)("h3",{id:"incompatible-changes"},"Incompatible changes"),(0,r.kt)("h4",{id:"removed-the-scan-query-legacy-mode"},"Removed the scan query legacy mode"),(0,r.kt)("p",null,"The native scan query legacy mode has been removed. It was introduced in Druid 0.11 to maintain compatibility during an upgrade from older versions of Druid where the scan query was part of a ",(0,r.kt)("inlineCode",{parentName:"p"},"contrib")," extension."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16659"},"#16659")),(0,r.kt)("p",null,"Hard-coded ",(0,r.kt)("inlineCode",{parentName:"p"},'"legacy":false')," following removal of the legacy mode to prevent error during rolling upgrades or downgrades."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/druid/pull/16793"},"#16793")),(0,r.kt)("h4",{id:"zk-based-segment-loading"},"ZK-based segment loading"),(0,r.kt)("p",null,"ZK-based segment loading is now disabled. ZK ",(0,r.kt)("inlineCode",{parentName:"p"},"servedSegmentsPath")," was deprecated in Druid 0.7.1. This legacy path has been replaced by ",(0,r.kt)("inlineCode",{parentName:"p"},"liveSegmentsPath"),"."),(0,r.kt)("p",null,"Segment-serving processes such as Peons, Historicals and Indexers no longer create ZK ",(0,r.kt)("inlineCode",{parentName:"p"},"loadQueuePath")," entries. The ",(0,r.kt)("inlineCode",{parentName:"p"},"druid.zk.paths.loadQueuePath")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"druid.zk.paths.servedSegmentsPath")," properties are no longer used."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Move to HTTP-based segment loading first and then perform the version upgrade.")),(0,r.kt)("h3",{id:"developer-notes"},"Developer notes"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Fixed the ",(0,r.kt)("inlineCode",{parentName:"li"},"hibernate-validator")," warning displayed during maven build ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16746"},"#16746")),(0,r.kt)("li",{parentName:"ul"},"Replaced the ",(0,r.kt)("inlineCode",{parentName:"li"},"StorageAdapter")," interface with the ",(0,r.kt)("inlineCode",{parentName:"li"},"CursorHolder")," interface ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17024"},"#17024"))),(0,r.kt)("h3",{id:"storageadapter-changes"},(0,r.kt)("inlineCode",{parentName:"h3"},"StorageAdapter")," changes"),(0,r.kt)("p",null,"If you write custom extensions, specifically query engines or anything else involving the ",(0,r.kt)("inlineCode",{parentName:"p"},"StorageAdapter")," interface, 31.0.0 includes changes to low-level APIs that may impact you. All methods on ",(0,r.kt)("inlineCode",{parentName:"p"},"StorageAdapter")," now throw a Druid exception."),(0,r.kt)("p",null,"Prepare for these changes before upgrading to 31.0.0 or later. For more information, see the following pull requests:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16985"},"#16985")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16849"},"#16849")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16533"},"#16533"))),(0,r.kt)("h4",{id:"dependency-updates"},"Dependency updates"),(0,r.kt)("p",null,"Bumped the versions of the following dependencies:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Apache Avro to 1.11.4 ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17230"},"#17230")),(0,r.kt)("li",{parentName:"ul"},"Apache Calcite to 1.37.0 ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16621"},"#16621")),(0,r.kt)("li",{parentName:"ul"},"Delta Kernel from 3.1.0 to 3.2.1 ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16513"},"#16513")," ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/17179"},"#17179")),(0,r.kt)("li",{parentName:"ul"},"MySQL Java connector to 8.2.0 ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16024"},"#16024")),(0,r.kt)("li",{parentName:"ul"},"OpenRewrite maven plugin from 5.27.0 to 5.31.0  ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16477"},"#16477")),(0,r.kt)("li",{parentName:"ul"},"Scala library from 2.13.11 to 2.13.14 ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16364"},"#16364")),(0,r.kt)("li",{parentName:"ul"},"Apache Curator reverted to 5.3.0 from 5.5.0 ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16688"},"#16688")),(0,r.kt)("li",{parentName:"ul"},"Updated Blueprint dependencies from v4 to v5 in web console ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16756"},"#16756")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"io.grpc:grpc-netty-shaded")," from 1.57.2 to 1.65.1 ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16731"},"#16731")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"jclouds.version")," from 2.5.0 to 2.6.0 ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16796"},"#16796")),(0,r.kt)("li",{parentName:"ul"},"Axios to 1.7.4 ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/apache/druid/pull/16898"},"#16898"))))}h.isMDXComponent=!0},52665:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/web-console-31-rn-copy-results-as-sql-bab61feeacecc96592d9dd5273ad2d33.png"},60851:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/web-console-31-rn-dart-d6333d95a185b478c337655be773239b.png"},83903:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/web-console-31-rn-new_stages-94e447f2bdefa86c8733e946fa830014.png"}}]);