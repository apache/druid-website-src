"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1148],{25204:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"operations/request-logging","title":"Request logging","description":"\x3c!--","source":"@site/docs/33.0.0/operations/request-logging.md","sourceDirName":"operations","slug":"/operations/request-logging","permalink":"/docs/33.0.0/operations/request-logging","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"request-logging","title":"Request logging","sidebar_label":"Request logging"},"sidebar":"docs","previous":{"title":"Automated metadata cleanup","permalink":"/docs/33.0.0/operations/clean-metadata-store"},"next":{"title":"Metrics","permalink":"/docs/33.0.0/operations/metrics"}}');var r=t(74848),s=t(28453);const o={id:"request-logging",title:"Request logging",sidebar_label:"Request logging"},l=void 0,c={},d=[{value:"Configure request logging",id:"configure-request-logging",level:2},{value:"Configure metrics emission",id:"configure-metrics-emission",level:2},{value:"Example",id:"example",level:2},{value:"Learn more",id:"learn-more",level:2}];function a(e){const n={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"All Apache Druid services that can serve queries can also log the query requests they process.\nRequest logs contain information on query metrics, including execution time and memory usage.\nYou can use information in the request logs to monitor query performance, determine bottlenecks, and analyze and improve slow queries."}),"\n",(0,r.jsx)(n.p,{children:"Request logging is disabled by default.\nThis topic describes how to configure Druid to generate request logs to track query metrics."}),"\n",(0,r.jsx)(n.h2,{id:"configure-request-logging",children:"Configure request logging"}),"\n",(0,r.jsx)(n.p,{children:"To enable request logging, determine the type of request logger to use, then set the configurations specific to the request logger type."}),"\n",(0,r.jsx)(n.p,{children:"The following request logger types are available:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"noop"}),": Disables request logging, the default behavior."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/33.0.0/configuration/#file-request-logging",children:(0,r.jsx)(n.code,{children:"file"})}),": Stores logs to disk."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/33.0.0/configuration/#emitter-request-logging",children:(0,r.jsx)(n.code,{children:"emitter"})}),": Logs request to an external location, which is configured through an emitter."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/33.0.0/configuration/#slf4j-request-logging",children:(0,r.jsx)(n.code,{children:"slf4j"})}),": Logs queries via the SLF4J Java logging API."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/33.0.0/configuration/#filtered-request-logging",children:(0,r.jsx)(n.code,{children:"filtered"})}),": Filters requests by query type or execution time before logging the filtered queries by the delegated request logger."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/33.0.0/configuration/#composing-request-logging",children:(0,r.jsx)(n.code,{children:"composing"})}),": Logs all requests to multiple request loggers."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/33.0.0/configuration/#switching-request-logging",children:(0,r.jsx)(n.code,{children:"switching"})}),": Logs native queries and SQL queries to separate request loggers."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Define the type of request logger in ",(0,r.jsx)(n.code,{children:"druid.request.logging.type"}),".\nSee the ",(0,r.jsx)(n.a,{href:"/docs/33.0.0/configuration/#request-logging",children:"Request logging configuration"})," for properties to set for each type of request logger.\nSpecify these properties in the ",(0,r.jsx)(n.code,{children:"common.runtime.properties"})," file.\nYou must restart Druid for the changes to take effect."]}),"\n",(0,r.jsxs)(n.p,{children:["Druid stores the results in the Broker logs, unless the request logging type is ",(0,r.jsx)(n.code,{children:"emitter"}),".\nIf you use emitter request logging, you must also configure metrics emission."]}),"\n",(0,r.jsx)(n.h2,{id:"configure-metrics-emission",children:"Configure metrics emission"}),"\n",(0,r.jsxs)(n.p,{children:["Druid includes various emitters to send metrics and alerts.\nTo emit query metrics, set ",(0,r.jsx)(n.code,{children:"druid.request.logging.feed=emitter"}),", and define the emitter type in the ",(0,r.jsx)(n.code,{children:"druid.emitter"})," property."]}),"\n",(0,r.jsx)(n.p,{children:"You can use any of the following emitters in Druid:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"noop"}),": Disables metric emission, the default behavior."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/33.0.0/configuration/#logging-emitter-module",children:(0,r.jsx)(n.code,{children:"logging"})}),": Emits metrics to Log4j 2. See ",(0,r.jsx)(n.a,{href:"/docs/33.0.0/configuration/logging",children:"Logging"})," to configure Log4j 2 for use with Druid."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/33.0.0/configuration/#http-emitter-module",children:(0,r.jsx)(n.code,{children:"http"})}),": Sends HTTP ",(0,r.jsx)(n.code,{children:"POST"})," requests containing the metrics in JSON format to a user-defined endpoint."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/33.0.0/configuration/#parametrized-http-emitter-module",children:(0,r.jsx)(n.code,{children:"parametrized"})}),": Operates like the ",(0,r.jsx)(n.code,{children:"http"})," emitter but fine-tunes the recipient URL based on the event feed."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/33.0.0/configuration/#composing-emitter-module",children:(0,r.jsx)(n.code,{children:"composing"})}),": Emits metrics to multiple emitter types."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/33.0.0/configuration/#graphite-emitter",children:(0,r.jsx)(n.code,{children:"graphite"})}),": Emits metrics to a ",(0,r.jsx)(n.a,{href:"https://graphiteapp.org/",children:"Graphite"})," Carbon service."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Specify these properties in the ",(0,r.jsx)(n.code,{children:"common.runtime.properties"})," file.\nSee the ",(0,r.jsx)(n.a,{href:"/docs/33.0.0/configuration/#metrics-emitters",children:"Metrics emitters configuration"})," for properties to set for each type of metrics emitter.\nYou must restart Druid for the changes to take effect."]}),"\n",(0,r.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,r.jsxs)(n.p,{children:["The following configuration shows how to enable request logging and post query metrics to the endpoint ",(0,r.jsx)(n.code,{children:"http://example.com:8080/path"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# Enable request logging and configure the emitter request logger\ndruid.request.logging.type=emitter\ndruid.request.logging.feed=myRequestLogFeed\n\n# Enable metrics emission and tell Druid where to emit messages\ndruid.emitter=http\ndruid.emitter.http.recipientBaseUrl=http://example.com:8080/path\n\n# Authenticate to the base URL, if needed\ndruid.emitter.http.basicAuthentication=username:password\n"})}),"\n",(0,r.jsx)(n.p,{children:"The following shows an example log emitter output:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'[\n    {\n        "feed": "metrics",\n        "timestamp": "2022-01-06T20:32:06.628Z",\n        "service": "druid/broker",\n        "host": "localhost:8082",\n        "version": "2022.01.0-iap-SNAPSHOT",\n        "metric": "sqlQuery/bytes",\n        "value": 9351,\n        "dataSource": "[wikipedia]",\n        "id": "56e8317b-31cc-443d-b109-47f51b21d4c3",\n        "nativeQueryIds": "[2b9cbced-11fc-4d78-a58c-c42863dff3c8]",\n        "remoteAddress": "127.0.0.1",\n        "success": "true"\n    },\n    {\n        "feed": "myRequestLogFeed",\n        "timestamp": "2022-01-06T20:32:06.585Z",\n        "remoteAddr": "127.0.0.1",\n        "service": "druid/broker",\n        "sqlQueryContext":\n        {\n            "useApproximateCountDistinct": false,\n            "sqlQueryId": "56e8317b-31cc-443d-b109-47f51b21d4c3",\n            "useApproximateTopN": false,\n            "useCache": false,\n            "sqlOuterLimit": 101,\n            "populateCache": false,\n            "nativeQueryIds": "[2b9cbced-11fc-4d78-a58c-c42863dff3c8]"\n        },\n        "queryStats":\n        {\n            "sqlQuery/time": 43,\n            "sqlQuery/planningTimeMs": 5,\n            "sqlQuery/bytes": 9351,\n            "success": true,\n            "context":\n            {\n                "useApproximateCountDistinct": false,\n                "sqlQueryId": "56e8317b-31cc-443d-b109-47f51b21d4c3",\n                "useApproximateTopN": false,\n                "useCache": false,\n                "sqlOuterLimit": 101,\n                "populateCache": false,\n                "nativeQueryIds": "[2b9cbced-11fc-4d78-a58c-c42863dff3c8]"\n            },\n            "identity": "allowAll"\n        },\n        "query": null,\n        "host": "localhost:8082",\n        "sql": "SELECT * FROM wikipedia WHERE cityName = \'Buenos Aires\'"\n    },\n    {\n        "feed": "myRequestLogFeed",\n        "timestamp": "2022-01-06T20:32:07.652Z",\n        "remoteAddr": "",\n        "service": "druid/broker",\n        "sqlQueryContext":\n        {},\n        "queryStats":\n        {\n            "query/time": 16,\n            "query/bytes": -1,\n            "success": true,\n            "identity": "allowAll"\n        },\n        "query":\n        {\n            "queryType": "scan",\n            "dataSource":\n            {\n                "type": "table",\n                "name": "wikipedia"\n            },\n            "intervals":\n            {\n                "type": "intervals",\n                "intervals":\n                [\n                    "-146136543-09-08T08:23:32.096Z/146140482-04-24T15:36:27.903Z"\n                ]\n            },\n            "virtualColumns":\n            [\n                {\n                    "type": "expression",\n                    "name": "v0",\n                    "expression": "\'Buenos Aires\'",\n                    "outputType": "STRING"\n                }\n            ],\n            "resultFormat": "compactedList",\n            "batchSize": 20480,\n            "limit": 101,\n            "filter":\n            {\n                "type": "selector",\n                "dimension": "cityName",\n                "value": "Buenos Aires",\n                "extractionFn": null\n            },\n            "columns":\n            [\n                "__time",\n                "added",\n                "channel",\n                "comment",\n                "commentLength",\n                "countryIsoCode",\n                "countryName",\n                "deleted",\n                "delta",\n                "deltaBucket",\n                "diffUrl",\n                "flags",\n                "isAnonymous",\n                "isMinor",\n                "isNew",\n                "isRobot",\n                "isUnpatrolled",\n                "metroCode",\n                "namespace",\n                "page",\n                "regionIsoCode",\n                "regionName",\n                "user",\n                "v0"\n            ],\n            "context":\n            {\n                "populateCache": false,\n                "queryId": "62e3d373-6e50-41b4-873b-1e56347c2950",\n                "sqlOuterLimit": 101,\n                "sqlQueryId": "cbb3d519-aee9-4566-8920-dbbeab6269f5",\n                "useApproximateCountDistinct": false,\n                "useApproximateTopN": false,\n                "useCache": false\n            },\n            "descending": false,\n            "granularity":\n            {\n                "type": "all"\n            }\n        },\n        "host": "localhost:8082",\n        "sql": null\n    },\n    ...\n]\n'})}),"\n",(0,r.jsx)(n.h2,{id:"learn-more",children:"Learn more"}),"\n",(0,r.jsx)(n.p,{children:"See the following topics for more information."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/33.0.0/operations/metrics#query-metrics",children:"Query metrics"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/33.0.0/configuration/#request-logging",children:"Request logging configuration"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/33.0.0/configuration/#metrics-emitters",children:"Metrics emitters configuration"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>l});var i=t(96540);const r={},s=i.createContext(r);function o(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);